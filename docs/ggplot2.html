<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>第 9 章 ggplot2 | Cookbook for R 中文版</title>
  <meta name="description" content="第 9 章 ggplot2 | Cookbook for R 中文版本" />
  <meta name="generator" content="bookdown 0.23 and GitBook 2.6.7" />

  <meta property="og:title" content="第 9 章 ggplot2 | Cookbook for R 中文版" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="第 9 章 ggplot2 | Cookbook for R 中文版本" />
  <meta name="github-repo" content="openbiox/Cookbook-for-R-Chinese" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="第 9 章 ggplot2 | Cookbook for R 中文版" />
  
  <meta name="twitter:description" content="第 9 章 ggplot2 | Cookbook for R 中文版本" />
  

<meta name="author" content="Winston Chang（著）" />
<meta name="author" content="王诗翔 等（译）" />


<meta name="date" content="2021-08-18" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="标准绘图.html"/>
<link rel="next" href="图形混杂.html"/>
<script src="libs/header-attrs/header-attrs.js"></script>
<script src="libs/jquery/jquery-3.6.0.min.js"></script>
<link href="libs/gitbook/css/style.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="css/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><strong><a href="./">Cookbook for R 中文版</a></strong></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>前言</a>
<ul>
<li class="chapter" data-level="0.1" data-path="index.html"><a href="index.html#问题与反馈"><i class="fa fa-check"></i><b>0.1</b> 问题与反馈</a></li>
<li class="chapter" data-level="0.2" data-path="index.html"><a href="index.html#致谢"><i class="fa fa-check"></i><b>0.2</b> 致谢</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="author.html"><a href="author.html"><i class="fa fa-check"></i>作者简介</a></li>
<li class="chapter" data-level="1" data-path="chapter1.html"><a href="chapter1.html"><i class="fa fa-check"></i><b>1</b> 基础</a>
<ul>
<li class="chapter" data-level="1.1" data-path="chapter1.html"><a href="chapter1.html#r-pkg-installation"><i class="fa fa-check"></i><b>1.1</b> 安装和使用 R 包</a></li>
<li class="chapter" data-level="1.2" data-path="chapter1.html"><a href="chapter1.html#数据结构的索引"><i class="fa fa-check"></i><b>1.2</b> 数据结构的索引</a></li>
<li class="chapter" data-level="1.3" data-path="chapter1.html"><a href="chapter1.html#获取数据结构的子集"><i class="fa fa-check"></i><b>1.3</b> 获取数据结构的子集</a></li>
<li class="chapter" data-level="1.4" data-path="chapter1.html"><a href="chapter1.html#创建填满值的向量"><i class="fa fa-check"></i><b>1.4</b> 创建填满值的向量</a></li>
<li class="chapter" data-level="1.5" data-path="chapter1.html"><a href="chapter1.html#变量信息"><i class="fa fa-check"></i><b>1.5</b> 变量信息</a></li>
<li class="chapter" data-level="1.6" data-path="chapter1.html"><a href="chapter1.html#nullnanan-的处理"><i class="fa fa-check"></i><b>1.6</b> NULL、NA、NaN 的处理</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="数字.html"><a href="数字.html"><i class="fa fa-check"></i><b>2</b> 数字</a>
<ul>
<li class="chapter" data-level="2.1" data-path="数字.html"><a href="数字.html#生成随机数"><i class="fa fa-check"></i><b>2.1</b> 生成随机数</a></li>
<li class="chapter" data-level="2.2" data-path="数字.html"><a href="数字.html#生成可重复的随机序列"><i class="fa fa-check"></i><b>2.2</b> 生成可重复的随机序列</a></li>
<li class="chapter" data-level="2.3" data-path="数字.html"><a href="数字.html#保持随机数生成器的状态"><i class="fa fa-check"></i><b>2.3</b> 保持随机数生成器的状态</a></li>
<li class="chapter" data-level="2.4" data-path="数字.html"><a href="数字.html#对数值取整"><i class="fa fa-check"></i><b>2.4</b> 对数值取整</a></li>
<li class="chapter" data-level="2.5" data-path="数字.html"><a href="数字.html#比较浮点数"><i class="fa fa-check"></i><b>2.5</b> 比较浮点数</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="字符串.html"><a href="字符串.html"><i class="fa fa-check"></i><b>3</b> 字符串</a>
<ul>
<li class="chapter" data-level="3.1" data-path="字符串.html"><a href="字符串.html#使用-grepsubgsub-进行搜索和替换"><i class="fa fa-check"></i><b>3.1</b> 使用 grep、sub、gsub 进行搜索和替换</a></li>
<li class="chapter" data-level="3.2" data-path="字符串.html"><a href="字符串.html#通过变量创建字符串"><i class="fa fa-check"></i><b>3.2</b> 通过变量创建字符串</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="公式.html"><a href="公式.html"><i class="fa fa-check"></i><b>4</b> 公式</a>
<ul>
<li class="chapter" data-level="4.1" data-path="公式.html"><a href="公式.html#通过字符串创建公式"><i class="fa fa-check"></i><b>4.1</b> 通过字符串创建公式</a></li>
<li class="chapter" data-level="4.2" data-path="公式.html"><a href="公式.html#从公式中提取组分"><i class="fa fa-check"></i><b>4.2</b> 从公式中提取组分</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="数据的导入与导出.html"><a href="数据的导入与导出.html"><i class="fa fa-check"></i><b>5</b> 数据的导入与导出</a>
<ul>
<li class="chapter" data-level="5.1" data-path="数据的导入与导出.html"><a href="数据的导入与导出.html#r-import-data-from-file"><i class="fa fa-check"></i><b>5.1</b> R载入文件中的数据</a></li>
<li class="chapter" data-level="5.2" data-path="数据的导入与导出.html"><a href="数据的导入与导出.html#read-data-from-keyboard"><i class="fa fa-check"></i><b>5.2</b> 通过键盘和剪贴板把数据载入并保存到 R</a></li>
<li class="chapter" data-level="5.3" data-path="数据的导入与导出.html"><a href="数据的导入与导出.html#run-r-script"><i class="fa fa-check"></i><b>5.3</b> 运行 R 脚本</a></li>
<li class="chapter" data-level="5.4" data-path="数据的导入与导出.html"><a href="数据的导入与导出.html#r-write-data-into-file"><i class="fa fa-check"></i><b>5.4</b> 用 R 把数据写入文件</a></li>
<li class="chapter" data-level="5.5" data-path="数据的导入与导出.html"><a href="数据的导入与导出.html#r-output-analysis"><i class="fa fa-check"></i><b>5.5</b> 用 R 写入文本，分析输出到文件</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="数据操作.html"><a href="数据操作.html"><i class="fa fa-check"></i><b>6</b> 数据操作</a>
<ul>
<li class="chapter" data-level="6.1" data-path="数据操作.html"><a href="数据操作.html#排序"><i class="fa fa-check"></i><b>6.1</b> 排序</a></li>
<li class="chapter" data-level="6.2" data-path="数据操作.html"><a href="数据操作.html#随机排序"><i class="fa fa-check"></i><b>6.2</b> 随机排序</a></li>
<li class="chapter" data-level="6.3" data-path="数据操作.html"><a href="数据操作.html#转换向量类型"><i class="fa fa-check"></i><b>6.3</b> 转换向量类型</a></li>
<li class="chapter" data-level="6.4" data-path="数据操作.html"><a href="数据操作.html#查找并移除重复记录"><i class="fa fa-check"></i><b>6.4</b> 查找并移除重复记录</a></li>
<li class="chapter" data-level="6.5" data-path="数据操作.html"><a href="数据操作.html#compare-with-nas"><i class="fa fa-check"></i><b>6.5</b> NA 存在时进行向量或因子比较</a></li>
<li class="chapter" data-level="6.6" data-path="数据操作.html"><a href="数据操作.html#数据重新编码"><i class="fa fa-check"></i><b>6.6</b> 数据重新编码</a></li>
<li class="chapter" data-level="6.7" data-path="数据操作.html"><a href="数据操作.html#映射向量值"><i class="fa fa-check"></i><b>6.7</b> 映射向量值</a></li>
<li class="chapter" data-level="6.8" data-path="数据操作.html"><a href="数据操作.html#重命名因子水平"><i class="fa fa-check"></i><b>6.8</b> 重命名因子水平</a></li>
<li class="chapter" data-level="6.9" data-path="数据操作.html"><a href="数据操作.html#重计算因子水平"><i class="fa fa-check"></i><b>6.9</b> 重计算因子水平</a></li>
<li class="chapter" data-level="6.10" data-path="数据操作.html"><a href="数据操作.html#改变因子水平次序"><i class="fa fa-check"></i><b>6.10</b> 改变因子水平次序</a></li>
<li class="chapter" data-level="6.11" data-path="数据操作.html"><a href="数据操作.html#重命名数据框的列"><i class="fa fa-check"></i><b>6.11</b> 重命名数据框的列</a></li>
<li class="chapter" data-level="6.12" data-path="数据操作.html"><a href="数据操作.html#添加和移除数据框的列"><i class="fa fa-check"></i><b>6.12</b> 添加和移除数据框的列</a></li>
<li class="chapter" data-level="6.13" data-path="数据操作.html"><a href="数据操作.html#对数据框的列重新排序"><i class="fa fa-check"></i><b>6.13</b> 对数据框的列重新排序</a></li>
<li class="chapter" data-level="6.14" data-path="数据操作.html"><a href="数据操作.html#合并数据框"><i class="fa fa-check"></i><b>6.14</b> 合并数据框</a></li>
<li class="chapter" data-level="6.15" data-path="数据操作.html"><a href="数据操作.html#比较数据框"><i class="fa fa-check"></i><b>6.15</b> 比较数据框</a></li>
<li class="chapter" data-level="6.16" data-path="数据操作.html"><a href="数据操作.html#重计算数据框所有因子列的水平"><i class="fa fa-check"></i><b>6.16</b> 重计算数据框所有因子列的水平</a></li>
<li class="chapter" data-level="6.17" data-path="数据操作.html"><a href="数据操作.html#长宽格式数据互换"><i class="fa fa-check"></i><b>6.17</b> 长宽格式数据互换</a></li>
<li class="chapter" data-level="6.18" data-path="数据操作.html"><a href="数据操作.html#汇总数据"><i class="fa fa-check"></i><b>6.18</b> 汇总数据</a></li>
<li class="chapter" data-level="6.19" data-path="数据操作.html"><a href="数据操作.html#数据框与列联表互换"><i class="fa fa-check"></i><b>6.19</b> 数据框与列联表互换</a></li>
<li class="chapter" data-level="6.20" data-path="数据操作.html"><a href="数据操作.html#计算移动平均数"><i class="fa fa-check"></i><b>6.20</b> 计算移动平均数</a></li>
<li class="chapter" data-level="6.21" data-path="数据操作.html"><a href="数据操作.html#窗口平滑"><i class="fa fa-check"></i><b>6.21</b> 窗口平滑</a></li>
<li class="chapter" data-level="6.22" data-path="数据操作.html"><a href="数据操作.html#寻找唯一值序列"><i class="fa fa-check"></i><b>6.22</b> 寻找唯一值序列</a></li>
<li class="chapter" data-level="6.23" data-path="数据操作.html"><a href="数据操作.html#fill-na-with-last-value"><i class="fa fa-check"></i><b>6.23</b> 用最后一个非 NA 值填充 NA</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="统计分析.html"><a href="统计分析.html"><i class="fa fa-check"></i><b>7</b> 统计分析</a>
<ul>
<li class="chapter" data-level="7.1" data-path="统计分析.html"><a href="统计分析.html#回归和相关分析"><i class="fa fa-check"></i><b>7.1</b> 回归和相关分析</a></li>
<li class="chapter" data-level="7.2" data-path="统计分析.html"><a href="统计分析.html#t-检验"><i class="fa fa-check"></i><b>7.2</b> t 检验</a></li>
<li class="chapter" data-level="7.3" data-path="统计分析.html"><a href="统计分析.html#频率检验"><i class="fa fa-check"></i><b>7.3</b> 频率检验</a></li>
<li class="chapter" data-level="7.4" data-path="统计分析.html"><a href="统计分析.html#anova"><i class="fa fa-check"></i><b>7.4</b> ANOVA</a></li>
<li class="chapter" data-level="7.5" data-path="统计分析.html"><a href="统计分析.html#逻辑回归"><i class="fa fa-check"></i><b>7.5</b> 逻辑回归</a></li>
<li class="chapter" data-level="7.6" data-path="统计分析.html"><a href="统计分析.html#变量同质性"><i class="fa fa-check"></i><b>7.6</b> 变量同质性</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="标准绘图.html"><a href="标准绘图.html"><i class="fa fa-check"></i><b>8</b> 标准绘图</a>
<ul>
<li class="chapter" data-level="8.1" data-path="标准绘图.html"><a href="标准绘图.html#直方图和密度图"><i class="fa fa-check"></i><b>8.1</b> 直方图和密度图</a></li>
<li class="chapter" data-level="8.2" data-path="标准绘图.html"><a href="标准绘图.html#散点图"><i class="fa fa-check"></i><b>8.2</b> 散点图</a></li>
<li class="chapter" data-level="8.3" data-path="标准绘图.html"><a href="标准绘图.html#箱线图"><i class="fa fa-check"></i><b>8.3</b> 箱线图</a></li>
<li class="chapter" data-level="8.4" data-path="标准绘图.html"><a href="标准绘图.html#qq-plot"><i class="fa fa-check"></i><b>8.4</b> QQ 图</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="ggplot2.html"><a href="ggplot2.html"><i class="fa fa-check"></i><b>9</b> ggplot2</a>
<ul>
<li class="chapter" data-level="9.1" data-path="ggplot2.html"><a href="ggplot2.html#条形图与线图"><i class="fa fa-check"></i><b>9.1</b> 条形图与线图</a></li>
<li class="chapter" data-level="9.2" data-path="ggplot2.html"><a href="ggplot2.html#绘制均值和误差线"><i class="fa fa-check"></i><b>9.2</b> 绘制均值和误差线</a></li>
<li class="chapter" data-level="9.3" data-path="ggplot2.html"><a href="ggplot2.html#分布图"><i class="fa fa-check"></i><b>9.3</b> 分布图</a></li>
<li class="chapter" data-level="9.4" data-path="ggplot2.html"><a href="ggplot2.html#散点图-1"><i class="fa fa-check"></i><b>9.4</b> 散点图</a></li>
<li class="chapter" data-level="9.5" data-path="ggplot2.html"><a href="ggplot2.html#标题"><i class="fa fa-check"></i><b>9.5</b> 标题</a></li>
<li class="chapter" data-level="9.6" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-axes"><i class="fa fa-check"></i><b>9.6</b> 坐标轴</a></li>
<li class="chapter" data-level="9.7" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-legends"><i class="fa fa-check"></i><b>9.7</b> 图例</a></li>
<li class="chapter" data-level="9.8" data-path="ggplot2.html"><a href="ggplot2.html#线条"><i class="fa fa-check"></i><b>9.8</b> 线条</a></li>
<li class="chapter" data-level="9.9" data-path="ggplot2.html"><a href="ggplot2.html#ggplot-facet"><i class="fa fa-check"></i><b>9.9</b> 分面</a></li>
<li class="chapter" data-level="9.10" data-path="ggplot2.html"><a href="ggplot2.html#多图"><i class="fa fa-check"></i><b>9.10</b> 多图</a></li>
<li class="chapter" data-level="9.11" data-path="ggplot2.html"><a href="ggplot2.html#ggplot2-colors"><i class="fa fa-check"></i><b>9.11</b> 颜色</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="图形混杂.html"><a href="图形混杂.html"><i class="fa fa-check"></i><b>10</b> 图形混杂</a>
<ul>
<li class="chapter" data-level="10.1" data-path="图形混杂.html"><a href="图形混杂.html#输出到文件-pdf-png-tiff-svg"><i class="fa fa-check"></i><b>10.1</b> 输出到文件 PDF-PNG-TIFF-SVG</a></li>
<li class="chapter" data-level="10.2" data-path="图形混杂.html"><a href="图形混杂.html#shape-and-linetype"><i class="fa fa-check"></i><b>10.2</b> 形状和线形</a></li>
<li class="chapter" data-level="10.3" data-path="图形混杂.html"><a href="图形混杂.html#字体"><i class="fa fa-check"></i><b>10.3</b> 字体</a></li>
<li class="chapter" data-level="10.4" data-path="图形混杂.html"><a href="图形混杂.html#抗混淆位图输出"><i class="fa fa-check"></i><b>10.4</b> 抗混淆位图输出</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="其他有趣图形.html"><a href="其他有趣图形.html"><i class="fa fa-check"></i><b>11</b> 其他有趣图形</a>
<ul>
<li class="chapter" data-level="11.1" data-path="其他有趣图形.html"><a href="其他有趣图形.html#corr-mat"><i class="fa fa-check"></i><b>11.1</b> 相关矩阵</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="脚本与函数.html"><a href="脚本与函数.html"><i class="fa fa-check"></i><b>12</b> 脚本与函数</a>
<ul>
<li class="chapter" data-level="12.1" data-path="脚本与函数.html"><a href="脚本与函数.html#创建和运行一个脚本"><i class="fa fa-check"></i><b>12.1</b> 创建和运行一个脚本</a></li>
<li class="chapter" data-level="12.2" data-path="脚本与函数.html"><a href="脚本与函数.html#调试脚本或函数"><i class="fa fa-check"></i><b>12.2</b> 调试脚本或函数</a></li>
<li class="chapter" data-level="12.3" data-path="脚本与函数.html"><a href="脚本与函数.html#测量运行的时间"><i class="fa fa-check"></i><b>12.3</b> 测量运行的时间</a></li>
<li class="chapter" data-level="12.4" data-path="脚本与函数.html"><a href="脚本与函数.html#获取包中的函数和对象列表"><i class="fa fa-check"></i><b>12.4</b> 获取包中的函数和对象列表</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="工具.html"><a href="工具.html"><i class="fa fa-check"></i><b>13</b> 工具</a>
<ul>
<li class="chapter" data-level="13.1" data-path="工具.html"><a href="工具.html#生成拉丁方"><i class="fa fa-check"></i><b>13.1</b> 生成拉丁方</a></li>
</ul></li>
<li class="appendix"><span><b>附录</b></span></li>
<li class="chapter" data-level="A" data-path="materials.html"><a href="materials.html"><i class="fa fa-check"></i><b>A</b> 资料推荐</a>
<ul>
<li class="chapter" data-level="A.1" data-path="materials.html"><a href="materials.html#书籍"><i class="fa fa-check"></i><b>A.1</b> 书籍</a></li>
<li class="chapter" data-level="A.2" data-path="materials.html"><a href="materials.html#r-包"><i class="fa fa-check"></i><b>A.2</b> R 包</a></li>
<li class="chapter" data-level="A.3" data-path="materials.html"><a href="materials.html#网站"><i class="fa fa-check"></i><b>A.3</b> 网站</a></li>
<li class="chapter" data-level="A.4" data-path="materials.html"><a href="materials.html#列表-2"><i class="fa fa-check"></i><b>A.4</b> 列表</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>参考文献</a></li>
<li class="divider"></li>
<li><a href="https://bookdown.org" target="blank">本书由 bookdown 强力驱动</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Cookbook for R 中文版</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="ggplot2" class="section level1" number="9">
<h1><span class="header-section-number">第 9 章</span> ggplot2</h1>
<div id="条形图与线图" class="section level2" number="9.1">
<h2><span class="header-section-number">9.1</span> 条形图与线图</h2>
<div id="问题-53" class="section level3" number="9.1.1">
<h3><span class="header-section-number">9.1.1</span> 问题</h3>
<p>你想要创建基本的条形图与线图</p>
</div>
<div id="方案-52" class="section level3" number="9.1.2">
<h3><span class="header-section-number">9.1.2</span> 方案</h3>
<p>想要使用 <strong>ggplot2</strong> 绘制图形，数据必须是一个数据框，而且必须是长格式。</p>
<div id="基本图形离散-x-axis" class="section level4" number="9.1.2.1">
<h4><span class="header-section-number">9.1.2.1</span> 基本图形，离散 x-axis</h4>
<p>使用条形图，条形的高度通常代表这种不同的东西：</p>
<ul>
<li>每一组事件的<strong>计数</strong>，通过 <code>stat_bin()</code> 指定，<strong>ggplot2</strong> 默认使用该选项</li>
<li>数据集中某一列的<strong>值</strong>，通过 <code>stat_identity()</code> 指定</li>
</ul>
<table>
<thead>
<tr class="header">
<th align="center">x 轴</th>
<th align="center">高度含义</th>
<th align="center">名称</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center"><strong>连续</strong></td>
<td align="center"><strong>计数</strong></td>
<td align="center">直方图</td>
</tr>
<tr class="even">
<td align="center"><strong>离散</strong></td>
<td align="center"><strong>计数</strong></td>
<td align="center">条形图</td>
</tr>
<tr class="odd">
<td align="center"><strong>连续</strong></td>
<td align="center"><strong>数值</strong></td>
<td align="center">条形图</td>
</tr>
<tr class="even">
<td align="center"><strong>离散</strong></td>
<td align="center"><strong>数值</strong></td>
<td align="center">条形图</td>
</tr>
</tbody>
</table>
<div id="有值的条形图" class="section level5" number="9.1.2.1.1">
<h5><span class="header-section-number">9.1.2.1.1</span> 有值的条形图</h5>
<p>这里有一些样例数据 (抽自 <strong>reshape2</strong> 包的 <code>tips</code> 数据集):</p>
<div class="sourceCode" id="cb263"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb263-1"><a href="ggplot2.html#cb263-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">time =</span> <span class="fu">factor</span>(<span class="fu">c</span>(<span class="st">&quot;Lunch&quot;</span>, <span class="st">&quot;Dinner&quot;</span>), <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;Lunch&quot;</span>,</span>
<span id="cb263-2"><a href="ggplot2.html#cb263-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Dinner&quot;</span>)), <span class="at">total_bill =</span> <span class="fu">c</span>(<span class="fl">14.89</span>, <span class="fl">17.23</span>))</span>
<span id="cb263-3"><a href="ggplot2.html#cb263-3" aria-hidden="true" tabindex="-1"></a>dat</span>
<span id="cb263-4"><a href="ggplot2.html#cb263-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     time total_bill</span></span>
<span id="cb263-5"><a href="ggplot2.html#cb263-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1  Lunch      14.89</span></span>
<span id="cb263-6"><a href="ggplot2.html#cb263-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 Dinner      17.23</span></span>
<span id="cb263-7"><a href="ggplot2.html#cb263-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb263-8"><a href="ggplot2.html#cb263-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 导入 ggplot2 分析包</span></span>
<span id="cb263-9"><a href="ggplot2.html#cb263-9" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span></code></pre></div>
<p>在这些例子中，条形的高度代表数据框某一列的<strong>值</strong>，所以使用 <code>stat="identity"</code> 而不是默认的 <code>stat="bin"</code>。</p>
<p>这里使用的映射变量为：</p>
<ul>
<li><code>time</code>: x-axis 和填充颜色</li>
<li><code>total_bill</code>: y-axis</li>
</ul>
<div class="sourceCode" id="cb264"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb264-1"><a href="ggplot2.html#cb264-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 非常基本的条形图</span></span>
<span id="cb264-2"><a href="ggplot2.html#cb264-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> dat, <span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> total_bill)) <span class="sc">+</span> <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>)</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-242-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb265"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb265-1"><a href="ggplot2.html#cb265-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 按时间填充颜色</span></span>
<span id="cb265-2"><a href="ggplot2.html#cb265-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> dat, <span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> total_bill, <span class="at">fill =</span> time)) <span class="sc">+</span></span>
<span id="cb265-3"><a href="ggplot2.html#cb265-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>)</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-242-2.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb266"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb266-1"><a href="ggplot2.html#cb266-1" aria-hidden="true" tabindex="-1"></a><span class="do">## 这和上面是一样的结果 ggplot(data=dat, aes(x=time,</span></span>
<span id="cb266-2"><a href="ggplot2.html#cb266-2" aria-hidden="true" tabindex="-1"></a><span class="do">## y=total_bill)) + geom_bar(aes(fill=time),</span></span>
<span id="cb266-3"><a href="ggplot2.html#cb266-3" aria-hidden="true" tabindex="-1"></a><span class="do">## stat=&#39;identity&#39;) 添加黑色的边框线</span></span>
<span id="cb266-4"><a href="ggplot2.html#cb266-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> dat, <span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> total_bill, <span class="at">fill =</span> time)) <span class="sc">+</span></span>
<span id="cb266-5"><a href="ggplot2.html#cb266-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">colour =</span> <span class="st">&quot;black&quot;</span>, <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>)</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-242-3.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb267"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb267-1"><a href="ggplot2.html#cb267-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 没有图例，因为这个信息是多余的</span></span>
<span id="cb267-2"><a href="ggplot2.html#cb267-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> dat, <span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> total_bill, <span class="at">fill =</span> time)) <span class="sc">+</span></span>
<span id="cb267-3"><a href="ggplot2.html#cb267-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">colour =</span> <span class="st">&quot;black&quot;</span>, <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="sc">+</span> <span class="fu">guides</span>(<span class="at">fill =</span> <span class="cn">FALSE</span>)</span>
<span id="cb267-4"><a href="ggplot2.html#cb267-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning: `guides(&lt;scale&gt; = FALSE)` is deprecated.</span></span>
<span id="cb267-5"><a href="ggplot2.html#cb267-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Please use `guides(&lt;scale&gt; = &quot;none&quot;)` instead.</span></span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-242-4.png" width="672" style="display: block; margin: auto;" /></p>
<p>一个理想的条形图可能是下面这样的：</p>
<div class="sourceCode" id="cb268"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb268-1"><a href="ggplot2.html#cb268-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 添加题目，缩小箱宽，填充颜色，改变轴标签</span></span>
<span id="cb268-2"><a href="ggplot2.html#cb268-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> dat, <span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> total_bill, <span class="at">fill =</span> time)) <span class="sc">+</span></span>
<span id="cb268-3"><a href="ggplot2.html#cb268-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">colour =</span> <span class="st">&quot;black&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;#DD8888&quot;</span>, <span class="at">width =</span> <span class="fl">0.8</span>,</span>
<span id="cb268-4"><a href="ggplot2.html#cb268-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="sc">+</span> <span class="fu">guides</span>(<span class="at">fill =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> <span class="fu">xlab</span>(<span class="st">&quot;Time of day&quot;</span>) <span class="sc">+</span></span>
<span id="cb268-5"><a href="ggplot2.html#cb268-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ylab</span>(<span class="st">&quot;Total bill&quot;</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">&quot;Average bill for 2 people&quot;</span>)</span>
<span id="cb268-6"><a href="ggplot2.html#cb268-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning: `guides(&lt;scale&gt; = FALSE)` is deprecated.</span></span>
<span id="cb268-7"><a href="ggplot2.html#cb268-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Please use `guides(&lt;scale&gt; = &quot;none&quot;)` instead.</span></span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-243-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>查看<a href="ggplot2.html#ggplot2-colors">颜色</a>获取更多关于颜色的信息。</p>
</div>
<div id="计数的条形图" class="section level5" number="9.1.2.1.2">
<h5><span class="header-section-number">9.1.2.1.2</span> 计数的条形图</h5>
<p>在下面例子中，条形高度代表事件的计数。</p>
<p>我们直接使用 <strong>reshape2</strong> 的 <code>tips</code> 数据集。</p>
<div class="sourceCode" id="cb269"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb269-1"><a href="ggplot2.html#cb269-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reshape2)</span>
<span id="cb269-2"><a href="ggplot2.html#cb269-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 查看头几行</span></span>
<span id="cb269-3"><a href="ggplot2.html#cb269-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(tips)</span>
<span id="cb269-4"><a href="ggplot2.html#cb269-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   total_bill  tip    sex smoker day   time size</span></span>
<span id="cb269-5"><a href="ggplot2.html#cb269-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1      16.99 1.01 Female     No Sun Dinner    2</span></span>
<span id="cb269-6"><a href="ggplot2.html#cb269-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2      10.34 1.66   Male     No Sun Dinner    3</span></span>
<span id="cb269-7"><a href="ggplot2.html#cb269-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3      21.01 3.50   Male     No Sun Dinner    3</span></span>
<span id="cb269-8"><a href="ggplot2.html#cb269-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4      23.68 3.31   Male     No Sun Dinner    2</span></span>
<span id="cb269-9"><a href="ggplot2.html#cb269-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5      24.59 3.61 Female     No Sun Dinner    4</span></span>
<span id="cb269-10"><a href="ggplot2.html#cb269-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6      25.29 4.71   Male     No Sun Dinner    4</span></span></code></pre></div>
<p>想要得到一个计数的条形图，不要映射变量到 <code>y</code>，使用 <code>stat="bin"</code> (默认就是这个) 而不是 <code>stat="identity"</code>:</p>
<div class="sourceCode" id="cb270"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb270-1"><a href="ggplot2.html#cb270-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 计数的条形图</span></span>
<span id="cb270-2"><a href="ggplot2.html#cb270-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> tips, <span class="fu">aes</span>(<span class="at">x =</span> day)) <span class="sc">+</span> <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;count&quot;</span>)</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-245-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb271"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb271-1"><a href="ggplot2.html#cb271-1" aria-hidden="true" tabindex="-1"></a><span class="do">## 和上面等同, 因为 stat=&#39;bin&#39; 是默认</span></span>
<span id="cb271-2"><a href="ggplot2.html#cb271-2" aria-hidden="true" tabindex="-1"></a><span class="do">## ggplot(data=tips, aes(x=day)) + geom_bar()</span></span></code></pre></div>
</div>
</div>
<div id="线图" class="section level4" number="9.1.2.2">
<h4><span class="header-section-number">9.1.2.2</span> 线图</h4>
<p>对于线图，数据点必须分组从而 R 知道怎么连接这些点。如果只有一组的话，非常简单，设定 <code>group=1</code> 即可，如果是多组，需要设定分组变量。</p>
<p>下面是使用的映射变量：</p>
<ul>
<li><code>time</code>: x 轴</li>
<li><code>total_bill</code>: y 轴</li>
</ul>
<div class="sourceCode" id="cb272"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb272-1"><a href="ggplot2.html#cb272-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 基本的线图</span></span>
<span id="cb272-2"><a href="ggplot2.html#cb272-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> dat, <span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> total_bill, <span class="at">group =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb272-3"><a href="ggplot2.html#cb272-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>()</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-246-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb273"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb273-1"><a href="ggplot2.html#cb273-1" aria-hidden="true" tabindex="-1"></a><span class="do">## 与上面结果一致 ggplot(data=dat, aes(x=time,</span></span>
<span id="cb273-2"><a href="ggplot2.html#cb273-2" aria-hidden="true" tabindex="-1"></a><span class="do">## y=total_bill)) + geom_line(aes(group=1)) 添加点</span></span>
<span id="cb273-3"><a href="ggplot2.html#cb273-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> dat, <span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> total_bill, <span class="at">group =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb273-4"><a href="ggplot2.html#cb273-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> <span class="fu">geom_point</span>()</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-246-2.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb274"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb274-1"><a href="ggplot2.html#cb274-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 改变线和点的颜色</span></span>
<span id="cb274-2"><a href="ggplot2.html#cb274-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 改变线的类型和点的类型，用更粗的线、更大的点</span></span>
<span id="cb274-3"><a href="ggplot2.html#cb274-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 用红色填充点</span></span>
<span id="cb274-4"><a href="ggplot2.html#cb274-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> dat, <span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> total_bill, <span class="at">group =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb274-5"><a href="ggplot2.html#cb274-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">colour =</span> <span class="st">&quot;red&quot;</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>, <span class="at">size =</span> <span class="fl">1.5</span>) <span class="sc">+</span></span>
<span id="cb274-6"><a href="ggplot2.html#cb274-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">colour =</span> <span class="st">&quot;red&quot;</span>, <span class="at">size =</span> <span class="dv">4</span>, <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">fill =</span> <span class="st">&quot;white&quot;</span>)</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-246-3.png" width="672" style="display: block; margin: auto;" /></p>
<p>理想的线图可能像下面这样：</p>
<div class="sourceCode" id="cb275"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb275-1"><a href="ggplot2.html#cb275-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 设定 y 轴的范围 改变轴标签</span></span>
<span id="cb275-2"><a href="ggplot2.html#cb275-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> dat, <span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> total_bill, <span class="at">group =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb275-3"><a href="ggplot2.html#cb275-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span> <span class="fu">expand_limits</span>(<span class="at">y =</span> <span class="dv">0</span>) <span class="sc">+</span></span>
<span id="cb275-4"><a href="ggplot2.html#cb275-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">xlab</span>(<span class="st">&quot;Time of day&quot;</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">&quot;Total bill&quot;</span>) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">&quot;Average bill for 2 people&quot;</span>)</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-247-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>查看<a href="ggplot2.html#ggplot2-colors">颜色</a>获取更多关于颜色的信息。查看<a href="图形混杂.html#shape-and-linetype">形状与线形</a> 获取更多相关内容。</p>
</div>
</div>
<div id="有更多变量的图" class="section level3" number="9.1.3">
<h3><span class="header-section-number">9.1.3</span> 有更多变量的图</h3>
<p>下面这个数据将用于接下来的例子</p>
<div class="sourceCode" id="cb276"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb276-1"><a href="ggplot2.html#cb276-1" aria-hidden="true" tabindex="-1"></a>dat1 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">sex =</span> <span class="fu">factor</span>(<span class="fu">c</span>(<span class="st">&quot;Female&quot;</span>, <span class="st">&quot;Female&quot;</span>, <span class="st">&quot;Male&quot;</span>,</span>
<span id="cb276-2"><a href="ggplot2.html#cb276-2" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Male&quot;</span>)), <span class="at">time =</span> <span class="fu">factor</span>(<span class="fu">c</span>(<span class="st">&quot;Lunch&quot;</span>, <span class="st">&quot;Dinner&quot;</span>, <span class="st">&quot;Lunch&quot;</span>,</span>
<span id="cb276-3"><a href="ggplot2.html#cb276-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Dinner&quot;</span>), <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;Lunch&quot;</span>, <span class="st">&quot;Dinner&quot;</span>)), <span class="at">total_bill =</span> <span class="fu">c</span>(<span class="fl">13.53</span>,</span>
<span id="cb276-4"><a href="ggplot2.html#cb276-4" aria-hidden="true" tabindex="-1"></a>  <span class="fl">16.81</span>, <span class="fl">16.24</span>, <span class="fl">17.42</span>))</span>
<span id="cb276-5"><a href="ggplot2.html#cb276-5" aria-hidden="true" tabindex="-1"></a>dat1</span>
<span id="cb276-6"><a href="ggplot2.html#cb276-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;      sex   time total_bill</span></span>
<span id="cb276-7"><a href="ggplot2.html#cb276-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 Female  Lunch      13.53</span></span>
<span id="cb276-8"><a href="ggplot2.html#cb276-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 Female Dinner      16.81</span></span>
<span id="cb276-9"><a href="ggplot2.html#cb276-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3   Male  Lunch      16.24</span></span>
<span id="cb276-10"><a href="ggplot2.html#cb276-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4   Male Dinner      17.42</span></span></code></pre></div>
<div id="条形图" class="section level4" number="9.1.3.1">
<h4><span class="header-section-number">9.1.3.1</span> 条形图</h4>
<p>变量映射：</p>
<ul>
<li><code>time</code>: x 轴</li>
<li><code>sex</code>: 颜色填充</li>
<li><code>total_bill</code>: y 轴</li>
</ul>
<div class="sourceCode" id="cb277"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb277-1"><a href="ggplot2.html#cb277-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 堆积条形图 -- 不常用</span></span>
<span id="cb277-2"><a href="ggplot2.html#cb277-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> dat1, <span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> total_bill, <span class="at">fill =</span> sex)) <span class="sc">+</span></span>
<span id="cb277-3"><a href="ggplot2.html#cb277-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>)</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-249-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb278"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb278-1"><a href="ggplot2.html#cb278-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 条形图，x 轴是 time, 颜色填充是 sex</span></span>
<span id="cb278-2"><a href="ggplot2.html#cb278-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> dat1, <span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> total_bill, <span class="at">fill =</span> sex)) <span class="sc">+</span></span>
<span id="cb278-3"><a href="ggplot2.html#cb278-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="at">position =</span> <span class="fu">position_dodge</span>())</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-249-2.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb279"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb279-1"><a href="ggplot2.html#cb279-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> dat1, <span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> total_bill, <span class="at">fill =</span> sex)) <span class="sc">+</span></span>
<span id="cb279-2"><a href="ggplot2.html#cb279-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="at">position =</span> <span class="fu">position_dodge</span>(),</span>
<span id="cb279-3"><a href="ggplot2.html#cb279-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">colour =</span> <span class="st">&quot;black&quot;</span>)</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-249-3.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb280"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb280-1"><a href="ggplot2.html#cb280-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 改变颜色</span></span>
<span id="cb280-2"><a href="ggplot2.html#cb280-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> dat1, <span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> total_bill, <span class="at">fill =</span> sex)) <span class="sc">+</span></span>
<span id="cb280-3"><a href="ggplot2.html#cb280-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="at">position =</span> <span class="fu">position_dodge</span>(),</span>
<span id="cb280-4"><a href="ggplot2.html#cb280-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">colour =</span> <span class="st">&quot;black&quot;</span>) <span class="sc">+</span> <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;#999999&quot;</span>,</span>
<span id="cb280-5"><a href="ggplot2.html#cb280-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;#E69F00&quot;</span>))</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-249-4.png" width="672" style="display: block; margin: auto;" /></p>
<p>改变映射是非常容易的：</p>
<div class="sourceCode" id="cb281"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb281-1"><a href="ggplot2.html#cb281-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 条形图，x 轴是性别，颜色是时间</span></span>
<span id="cb281-2"><a href="ggplot2.html#cb281-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> dat1, <span class="fu">aes</span>(<span class="at">x =</span> sex, <span class="at">y =</span> total_bill, <span class="at">fill =</span> time)) <span class="sc">+</span></span>
<span id="cb281-3"><a href="ggplot2.html#cb281-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="at">position =</span> <span class="fu">position_dodge</span>(),</span>
<span id="cb281-4"><a href="ggplot2.html#cb281-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">colour =</span> <span class="st">&quot;black&quot;</span>)</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-250-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>查看<a href="ggplot2.html#ggplot2-colors">颜色</a>获取更多关于颜色的信息。</p>
</div>
<div id="线图-1" class="section level4" number="9.1.3.2">
<h4><span class="header-section-number">9.1.3.2</span> 线图</h4>
<p>变量映射：</p>
<ul>
<li><code>time</code>: x 轴</li>
<li><code>sex</code>: 线的颜色</li>
<li><code>total_bill</code>: y 轴</li>
</ul>
<p>想要绘制多条线，必须指定分组变量，否则所有点都将通过一条线进行连接。在这个例子中，我们希望通过性别来进行分组。</p>
<div class="sourceCode" id="cb282"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb282-1"><a href="ggplot2.html#cb282-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 基本的带点线图</span></span>
<span id="cb282-2"><a href="ggplot2.html#cb282-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> dat1, <span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> total_bill, <span class="at">group =</span> sex)) <span class="sc">+</span></span>
<span id="cb282-3"><a href="ggplot2.html#cb282-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> <span class="fu">geom_point</span>()</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-251-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb283"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb283-1"><a href="ggplot2.html#cb283-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 将性别映射到颜色</span></span>
<span id="cb283-2"><a href="ggplot2.html#cb283-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> dat1, <span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> total_bill, <span class="at">group =</span> sex,</span>
<span id="cb283-3"><a href="ggplot2.html#cb283-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">colour =</span> sex)) <span class="sc">+</span> <span class="fu">geom_line</span>() <span class="sc">+</span> <span class="fu">geom_point</span>()</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-251-2.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb284"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb284-1"><a href="ggplot2.html#cb284-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 映射性别到不同的点类型</span></span>
<span id="cb284-2"><a href="ggplot2.html#cb284-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> dat1, <span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> total_bill, <span class="at">group =</span> sex,</span>
<span id="cb284-3"><a href="ggplot2.html#cb284-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">shape =</span> sex)) <span class="sc">+</span> <span class="fu">geom_line</span>() <span class="sc">+</span> <span class="fu">geom_point</span>()</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-251-3.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb285"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb285-1"><a href="ggplot2.html#cb285-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 使用更粗的线、更大的点</span></span>
<span id="cb285-2"><a href="ggplot2.html#cb285-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> dat1, <span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> total_bill, <span class="at">group =</span> sex,</span>
<span id="cb285-3"><a href="ggplot2.html#cb285-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">shape =</span> sex)) <span class="sc">+</span> <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="fl">1.5</span>) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">3</span>,</span>
<span id="cb285-4"><a href="ggplot2.html#cb285-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">fill =</span> <span class="st">&quot;white&quot;</span>) <span class="sc">+</span> <span class="fu">scale_shape_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="dv">22</span>,</span>
<span id="cb285-5"><a href="ggplot2.html#cb285-5" aria-hidden="true" tabindex="-1"></a>  <span class="dv">21</span>))</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-251-4.png" width="672" style="display: block; margin: auto;" /></p>
<p>更改颜色和线型变量的映射非常容易：</p>
<div class="sourceCode" id="cb286"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb286-1"><a href="ggplot2.html#cb286-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> dat1, <span class="fu">aes</span>(<span class="at">x =</span> sex, <span class="at">y =</span> total_bill, <span class="at">group =</span> time,</span>
<span id="cb286-2"><a href="ggplot2.html#cb286-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">shape =</span> time, <span class="at">color =</span> time)) <span class="sc">+</span> <span class="fu">geom_line</span>() <span class="sc">+</span> <span class="fu">geom_point</span>()</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-252-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>查看<a href="ggplot2.html#ggplot2-colors">颜色</a>获取更多关于颜色的信息。查看<a href="图形混杂.html#shape-and-linetype">形状与线形</a>获取更多相关内容。</p>
</div>
<div id="完成的例子" class="section level4" number="9.1.3.3">
<h4><span class="header-section-number">9.1.3.3</span> 完成的例子</h4>
<p>完成的例子可能像下面这样：</p>
<div class="sourceCode" id="cb287"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb287-1"><a href="ggplot2.html#cb287-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 一个条形图</span></span>
<span id="cb287-2"><a href="ggplot2.html#cb287-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>dat1, <span class="fu">aes</span>(<span class="at">x=</span>time, <span class="at">y=</span>total_bill, <span class="at">fill=</span>sex)) <span class="sc">+</span> </span>
<span id="cb287-3"><a href="ggplot2.html#cb287-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">colour=</span><span class="st">&quot;black&quot;</span>, <span class="at">stat=</span><span class="st">&quot;identity&quot;</span>,</span>
<span id="cb287-4"><a href="ggplot2.html#cb287-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">position=</span><span class="fu">position_dodge</span>(),</span>
<span id="cb287-5"><a href="ggplot2.html#cb287-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">size=</span>.<span class="dv">3</span>) <span class="sc">+</span>                        <span class="co"># 更粗的线</span></span>
<span id="cb287-6"><a href="ggplot2.html#cb287-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_hue</span>(<span class="at">name=</span><span class="st">&quot;Sex of payer&quot;</span>) <span class="sc">+</span>      <span class="co"># 设定图例标题</span></span>
<span id="cb287-7"><a href="ggplot2.html#cb287-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">&quot;Time of day&quot;</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">&quot;Total bill&quot;</span>) <span class="sc">+</span> <span class="co"># 设定轴标签</span></span>
<span id="cb287-8"><a href="ggplot2.html#cb287-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">&quot;Average bill for 2 people&quot;</span>) <span class="sc">+</span>     <span class="co"># 设定题目</span></span>
<span id="cb287-9"><a href="ggplot2.html#cb287-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-253-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb288"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb288-1"><a href="ggplot2.html#cb288-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 一个线图</span></span>
<span id="cb288-2"><a href="ggplot2.html#cb288-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data=</span>dat1, <span class="fu">aes</span>(<span class="at">x=</span>time, <span class="at">y=</span>total_bill, <span class="at">group=</span>sex, <span class="at">shape=</span>sex, <span class="at">colour=</span>sex)) <span class="sc">+</span> </span>
<span id="cb288-3"><a href="ggplot2.html#cb288-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">linetype=</span>sex), <span class="at">size=</span><span class="dv">1</span>) <span class="sc">+</span>     <span class="co"># 按性别设定线型</span></span>
<span id="cb288-4"><a href="ggplot2.html#cb288-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">size=</span><span class="dv">3</span>, <span class="at">fill=</span><span class="st">&quot;white&quot;</span>) <span class="sc">+</span>         <span class="co"># 使用更大的点，并用颜色填充</span></span>
<span id="cb288-5"><a href="ggplot2.html#cb288-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">expand_limits</span>(<span class="at">y=</span><span class="dv">0</span>) <span class="sc">+</span>                       <span class="co"># 将 0 包含仅 y 轴</span></span>
<span id="cb288-6"><a href="ggplot2.html#cb288-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_colour_hue</span>(<span class="at">name=</span><span class="st">&quot;Sex of payer&quot;</span>,      <span class="co"># 设定图例标题</span></span>
<span id="cb288-7"><a href="ggplot2.html#cb288-7" aria-hidden="true" tabindex="-1"></a>                     <span class="at">l=</span><span class="dv">30</span>)  <span class="sc">+</span>                  <span class="co"># 使用更深的颜色 (lightness=30)</span></span>
<span id="cb288-8"><a href="ggplot2.html#cb288-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_shape_manual</span>(<span class="at">name=</span><span class="st">&quot;Sex of payer&quot;</span>,</span>
<span id="cb288-9"><a href="ggplot2.html#cb288-9" aria-hidden="true" tabindex="-1"></a>                       <span class="at">values=</span><span class="fu">c</span>(<span class="dv">22</span>,<span class="dv">21</span>)) <span class="sc">+</span>      <span class="co"># </span></span>
<span id="cb288-10"><a href="ggplot2.html#cb288-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_linetype_discrete</span>(<span class="at">name=</span><span class="st">&quot;Sex of payer&quot;</span>) <span class="sc">+</span></span>
<span id="cb288-11"><a href="ggplot2.html#cb288-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">&quot;Time of day&quot;</span>) <span class="sc">+</span> <span class="fu">ylab</span>(<span class="st">&quot;Total bill&quot;</span>) <span class="sc">+</span> <span class="co"># 设定轴标签</span></span>
<span id="cb288-12"><a href="ggplot2.html#cb288-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">&quot;Average bill for 2 people&quot;</span>) <span class="sc">+</span>     <span class="co"># 设定标题</span></span>
<span id="cb288-13"><a href="ggplot2.html#cb288-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb288-14"><a href="ggplot2.html#cb288-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.position=</span><span class="fu">c</span>(.<span class="dv">7</span>, .<span class="dv">4</span>))           <span class="co"># 图例的位置</span></span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-253-2.png" width="672" style="display: block; margin: auto;" /></p>
<p>为了保证上图的图例一致，必须指定 3 次。至于为何如此，查看<a href="ggplot2.html#ggplot2-legends">图例</a>。</p>
</div>
</div>
<div id="使用数值-x-axis" class="section level3" number="9.1.4">
<h3><span class="header-section-number">9.1.4</span> 使用数值 x-axis</h3>
<p>当 x 轴上的变量是数字时，有时需要将其视为连续变量，有时需要将其视为分类变量。在该数据集中，剂量应该是值为 <code>0.5</code>, <code>1.0</code> 和 <code>2.0</code> 的数值变量。作图时，将这些值视为相同类别可能很有用。</p>
<div class="sourceCode" id="cb289"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb289-1"><a href="ggplot2.html#cb289-1" aria-hidden="true" tabindex="-1"></a>datn <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="at">header =</span> <span class="cn">TRUE</span>, <span class="at">text =</span> <span class="st">&quot;</span></span>
<span id="cb289-2"><a href="ggplot2.html#cb289-2" aria-hidden="true" tabindex="-1"></a><span class="st">supp dose length</span></span>
<span id="cb289-3"><a href="ggplot2.html#cb289-3" aria-hidden="true" tabindex="-1"></a><span class="st">  OJ  0.5  13.23</span></span>
<span id="cb289-4"><a href="ggplot2.html#cb289-4" aria-hidden="true" tabindex="-1"></a><span class="st">  OJ  1.0  22.70</span></span>
<span id="cb289-5"><a href="ggplot2.html#cb289-5" aria-hidden="true" tabindex="-1"></a><span class="st">  OJ  2.0  26.06</span></span>
<span id="cb289-6"><a href="ggplot2.html#cb289-6" aria-hidden="true" tabindex="-1"></a><span class="st">  VC  0.5   7.98</span></span>
<span id="cb289-7"><a href="ggplot2.html#cb289-7" aria-hidden="true" tabindex="-1"></a><span class="st">  VC  1.0  16.77</span></span>
<span id="cb289-8"><a href="ggplot2.html#cb289-8" aria-hidden="true" tabindex="-1"></a><span class="st">  VC  2.0  26.14</span></span>
<span id="cb289-9"><a href="ggplot2.html#cb289-9" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span>)</span></code></pre></div>
<p>来自 <code>ToothGrowth</code> 数据集。</p>
<div id="x-axis-作为连续变量" class="section level4" number="9.1.4.1">
<h4><span class="header-section-number">9.1.4.1</span> x-axis 作为连续变量</h4>
<p>一个简单的图形可能会将剂量放在 x 轴，这种方式可以绘制一个线图。</p>
<div class="sourceCode" id="cb290"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb290-1"><a href="ggplot2.html#cb290-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> datn, <span class="fu">aes</span>(<span class="at">x =</span> dose, <span class="at">y =</span> length, <span class="at">group =</span> supp,</span>
<span id="cb290-2"><a href="ggplot2.html#cb290-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">colour =</span> supp)) <span class="sc">+</span> <span class="fu">geom_line</span>() <span class="sc">+</span> <span class="fu">geom_point</span>()</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-255-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="x-axis-作为分类变量" class="section level4" number="9.1.4.2">
<h4><span class="header-section-number">9.1.4.2</span> x-axis 作为分类变量</h4>
<p>首先，我们要将该变量转换为因子。</p>
<div class="sourceCode" id="cb291"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb291-1"><a href="ggplot2.html#cb291-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 拷贝数据框并将它转换为因子</span></span>
<span id="cb291-2"><a href="ggplot2.html#cb291-2" aria-hidden="true" tabindex="-1"></a>datn2 <span class="ot">&lt;-</span> datn</span>
<span id="cb291-3"><a href="ggplot2.html#cb291-3" aria-hidden="true" tabindex="-1"></a>datn2<span class="sc">$</span>dose <span class="ot">&lt;-</span> <span class="fu">factor</span>(datn2<span class="sc">$</span>dose)</span>
<span id="cb291-4"><a href="ggplot2.html#cb291-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> datn2, <span class="fu">aes</span>(<span class="at">x =</span> dose, <span class="at">y =</span> length, <span class="at">group =</span> supp,</span>
<span id="cb291-5"><a href="ggplot2.html#cb291-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">colour =</span> supp)) <span class="sc">+</span> <span class="fu">geom_line</span>() <span class="sc">+</span> <span class="fu">geom_point</span>()</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-256-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb292"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb292-1"><a href="ggplot2.html#cb292-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 使用原始的数据框，但使用 factor 函数在绘图时转换</span></span>
<span id="cb292-2"><a href="ggplot2.html#cb292-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> datn, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">factor</span>(dose), <span class="at">y =</span> length, <span class="at">group =</span> supp,</span>
<span id="cb292-3"><a href="ggplot2.html#cb292-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">colour =</span> supp)) <span class="sc">+</span> <span class="fu">geom_line</span>() <span class="sc">+</span> <span class="fu">geom_point</span>()</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-256-2.png" width="672" style="display: block; margin: auto;" /></p>
<p>当连续值作为分类变量使用时，也可以绘制条形图。</p>
<div class="sourceCode" id="cb293"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb293-1"><a href="ggplot2.html#cb293-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> datn2, <span class="fu">aes</span>(<span class="at">x =</span> dose, <span class="at">y =</span> length, <span class="at">fill =</span> supp)) <span class="sc">+</span></span>
<span id="cb293-2"><a href="ggplot2.html#cb293-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="at">position =</span> <span class="fu">position_dodge</span>())</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-257-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb294"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb294-1"><a href="ggplot2.html#cb294-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb294-2"><a href="ggplot2.html#cb294-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> datn, <span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">factor</span>(dose), <span class="at">y =</span> length, <span class="at">fill =</span> supp)) <span class="sc">+</span></span>
<span id="cb294-3"><a href="ggplot2.html#cb294-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>, <span class="at">position =</span> <span class="fu">position_dodge</span>())</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-257-2.png" width="672" style="display: block; margin: auto;" /></p>
</div>
</div>
</div>
<div id="绘制均值和误差线" class="section level2" number="9.2">
<h2><span class="header-section-number">9.2</span> 绘制均值和误差线</h2>
<div id="问题-54" class="section level3" number="9.2.1">
<h3><span class="header-section-number">9.2.1</span> 问题</h3>
<p>你想要为一个数据集绘制均值的误差线。</p>
</div>
<div id="方案-53" class="section level3" number="9.2.2">
<h3><span class="header-section-number">9.2.2</span> 方案</h3>
<p>想要用 <strong>ggplot2</strong> 绘制图形，数据必须是数据框形式，而且是长格式（相对于宽格式）。如果你的数据需要重构，请参考<a href="#section-6.17">长宽格式转换</a>获取更多信息。</p>
<div id="助手函数" class="section level4" number="9.2.2.1">
<h4><span class="header-section-number">9.2.2.1</span> 助手函数</h4>
<p>如果你处理的仅仅是组间变量，那么 <code>summarySE()</code> 是你代码中唯一需要使用的函数。如果你的数据里有组内变量，<strong>并且</strong>你想要矫正误差线使得组间的变异被移除，就像 Loftus and Masson (1994) 里的那样，那么 <code>normDataWithin()</code> 和 <code>summarySEwithin()</code> 这两个函数必须加入你的代码中，然后调用 <code>summarySEwithin()</code> 函数进行计算。</p>
<div class="sourceCode" id="cb295"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb295-1"><a href="ggplot2.html#cb295-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Gives count, mean, standard deviation, standard</span></span>
<span id="cb295-2"><a href="ggplot2.html#cb295-2" aria-hidden="true" tabindex="-1"></a><span class="do">## error of the mean, and confidence interval (default</span></span>
<span id="cb295-3"><a href="ggplot2.html#cb295-3" aria-hidden="true" tabindex="-1"></a><span class="do">## 95%).  data: a data frame.  measurevar: the name of</span></span>
<span id="cb295-4"><a href="ggplot2.html#cb295-4" aria-hidden="true" tabindex="-1"></a><span class="do">## a column that contains the variable to be</span></span>
<span id="cb295-5"><a href="ggplot2.html#cb295-5" aria-hidden="true" tabindex="-1"></a><span class="do">## summariezed groupvars: a vector containing names of</span></span>
<span id="cb295-6"><a href="ggplot2.html#cb295-6" aria-hidden="true" tabindex="-1"></a><span class="do">## columns that contain grouping variables na.rm: a</span></span>
<span id="cb295-7"><a href="ggplot2.html#cb295-7" aria-hidden="true" tabindex="-1"></a><span class="do">## boolean that indicates whether to ignore NA&#39;s</span></span>
<span id="cb295-8"><a href="ggplot2.html#cb295-8" aria-hidden="true" tabindex="-1"></a><span class="do">## conf.interval: the percent range of the confidence</span></span>
<span id="cb295-9"><a href="ggplot2.html#cb295-9" aria-hidden="true" tabindex="-1"></a><span class="do">## interval (default is 95%)</span></span>
<span id="cb295-10"><a href="ggplot2.html#cb295-10" aria-hidden="true" tabindex="-1"></a>summarySE <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">data =</span> <span class="cn">NULL</span>, measurevar, <span class="at">groupvars =</span> <span class="cn">NULL</span>,</span>
<span id="cb295-11"><a href="ggplot2.html#cb295-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">na.rm =</span> <span class="cn">FALSE</span>, <span class="at">conf.interval =</span> <span class="fl">0.95</span>, <span class="at">.drop =</span> <span class="cn">TRUE</span>) {</span>
<span id="cb295-12"><a href="ggplot2.html#cb295-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(plyr)</span>
<span id="cb295-13"><a href="ggplot2.html#cb295-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb295-14"><a href="ggplot2.html#cb295-14" aria-hidden="true" tabindex="-1"></a>  <span class="co"># New version of length which can handle NA&#39;s: if</span></span>
<span id="cb295-15"><a href="ggplot2.html#cb295-15" aria-hidden="true" tabindex="-1"></a>  <span class="co"># na.rm==T, don&#39;t count them</span></span>
<span id="cb295-16"><a href="ggplot2.html#cb295-16" aria-hidden="true" tabindex="-1"></a>  length2 <span class="ot">&lt;-</span> <span class="cf">function</span>(x, <span class="at">na.rm =</span> <span class="cn">FALSE</span>) {</span>
<span id="cb295-17"><a href="ggplot2.html#cb295-17" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (na.rm)</span>
<span id="cb295-18"><a href="ggplot2.html#cb295-18" aria-hidden="true" tabindex="-1"></a>      <span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(x)) <span class="cf">else</span> <span class="fu">length</span>(x)</span>
<span id="cb295-19"><a href="ggplot2.html#cb295-19" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb295-20"><a href="ggplot2.html#cb295-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb295-21"><a href="ggplot2.html#cb295-21" aria-hidden="true" tabindex="-1"></a>  <span class="co"># This does the summary. For each group&#39;s data</span></span>
<span id="cb295-22"><a href="ggplot2.html#cb295-22" aria-hidden="true" tabindex="-1"></a>  <span class="co"># frame, return a vector with N, mean, and sd</span></span>
<span id="cb295-23"><a href="ggplot2.html#cb295-23" aria-hidden="true" tabindex="-1"></a>  datac <span class="ot">&lt;-</span> <span class="fu">ddply</span>(data, groupvars, <span class="at">.drop =</span> .drop, <span class="at">.fun =</span> <span class="cf">function</span>(xx,</span>
<span id="cb295-24"><a href="ggplot2.html#cb295-24" aria-hidden="true" tabindex="-1"></a>    col) {</span>
<span id="cb295-25"><a href="ggplot2.html#cb295-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(<span class="at">N =</span> <span class="fu">length2</span>(xx[[col]], <span class="at">na.rm =</span> na.rm), <span class="at">mean =</span> <span class="fu">mean</span>(xx[[col]],</span>
<span id="cb295-26"><a href="ggplot2.html#cb295-26" aria-hidden="true" tabindex="-1"></a>      <span class="at">na.rm =</span> na.rm), <span class="at">sd =</span> <span class="fu">sd</span>(xx[[col]], <span class="at">na.rm =</span> na.rm))</span>
<span id="cb295-27"><a href="ggplot2.html#cb295-27" aria-hidden="true" tabindex="-1"></a>  }, measurevar)</span>
<span id="cb295-28"><a href="ggplot2.html#cb295-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb295-29"><a href="ggplot2.html#cb295-29" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Rename the &#39;mean&#39; column</span></span>
<span id="cb295-30"><a href="ggplot2.html#cb295-30" aria-hidden="true" tabindex="-1"></a>  datac <span class="ot">&lt;-</span> <span class="fu">rename</span>(datac, <span class="fu">c</span>(<span class="at">mean =</span> measurevar))</span>
<span id="cb295-31"><a href="ggplot2.html#cb295-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb295-32"><a href="ggplot2.html#cb295-32" aria-hidden="true" tabindex="-1"></a>  datac<span class="sc">$</span>se <span class="ot">&lt;-</span> datac<span class="sc">$</span>sd<span class="sc">/</span><span class="fu">sqrt</span>(datac<span class="sc">$</span>N)  <span class="co"># Calculate standard error of the mean</span></span>
<span id="cb295-33"><a href="ggplot2.html#cb295-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb295-34"><a href="ggplot2.html#cb295-34" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Confidence interval multiplier for standard error</span></span>
<span id="cb295-35"><a href="ggplot2.html#cb295-35" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Calculate t-statistic for confidence interval:</span></span>
<span id="cb295-36"><a href="ggplot2.html#cb295-36" aria-hidden="true" tabindex="-1"></a>  <span class="co"># e.g., if conf.interval is .95, use .975</span></span>
<span id="cb295-37"><a href="ggplot2.html#cb295-37" aria-hidden="true" tabindex="-1"></a>  <span class="co"># (above/below), and use df=N-1</span></span>
<span id="cb295-38"><a href="ggplot2.html#cb295-38" aria-hidden="true" tabindex="-1"></a>  ciMult <span class="ot">&lt;-</span> <span class="fu">qt</span>(conf.interval<span class="sc">/</span><span class="dv">2</span> <span class="sc">+</span> <span class="fl">0.5</span>, datac<span class="sc">$</span>N <span class="sc">-</span> <span class="dv">1</span>)</span>
<span id="cb295-39"><a href="ggplot2.html#cb295-39" aria-hidden="true" tabindex="-1"></a>  datac<span class="sc">$</span>ci <span class="ot">&lt;-</span> datac<span class="sc">$</span>se <span class="sc">*</span> ciMult</span>
<span id="cb295-40"><a href="ggplot2.html#cb295-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb295-41"><a href="ggplot2.html#cb295-41" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(datac)</span>
<span id="cb295-42"><a href="ggplot2.html#cb295-42" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb295-43"><a href="ggplot2.html#cb295-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb295-44"><a href="ggplot2.html#cb295-44" aria-hidden="true" tabindex="-1"></a><span class="do">## Norms the data within specified groups in a data</span></span>
<span id="cb295-45"><a href="ggplot2.html#cb295-45" aria-hidden="true" tabindex="-1"></a><span class="do">## frame; it normalizes each subject (identified by</span></span>
<span id="cb295-46"><a href="ggplot2.html#cb295-46" aria-hidden="true" tabindex="-1"></a><span class="do">## idvar) so that they have the same mean, within each</span></span>
<span id="cb295-47"><a href="ggplot2.html#cb295-47" aria-hidden="true" tabindex="-1"></a><span class="do">## group specified by betweenvars.  data: a data</span></span>
<span id="cb295-48"><a href="ggplot2.html#cb295-48" aria-hidden="true" tabindex="-1"></a><span class="do">## frame.  idvar: the name of a column that identifies</span></span>
<span id="cb295-49"><a href="ggplot2.html#cb295-49" aria-hidden="true" tabindex="-1"></a><span class="do">## each subject (or matched subjects) measurevar: the</span></span>
<span id="cb295-50"><a href="ggplot2.html#cb295-50" aria-hidden="true" tabindex="-1"></a><span class="do">## name of a column that contains the variable to be</span></span>
<span id="cb295-51"><a href="ggplot2.html#cb295-51" aria-hidden="true" tabindex="-1"></a><span class="do">## summariezed betweenvars: a vector containing names</span></span>
<span id="cb295-52"><a href="ggplot2.html#cb295-52" aria-hidden="true" tabindex="-1"></a><span class="do">## of columns that are between-subjects variables</span></span>
<span id="cb295-53"><a href="ggplot2.html#cb295-53" aria-hidden="true" tabindex="-1"></a><span class="do">## na.rm: a boolean that indicates whether to ignore</span></span>
<span id="cb295-54"><a href="ggplot2.html#cb295-54" aria-hidden="true" tabindex="-1"></a><span class="do">## NA&#39;s</span></span>
<span id="cb295-55"><a href="ggplot2.html#cb295-55" aria-hidden="true" tabindex="-1"></a>normDataWithin <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">data =</span> <span class="cn">NULL</span>, idvar, measurevar,</span>
<span id="cb295-56"><a href="ggplot2.html#cb295-56" aria-hidden="true" tabindex="-1"></a>  <span class="at">betweenvars =</span> <span class="cn">NULL</span>, <span class="at">na.rm =</span> <span class="cn">FALSE</span>, <span class="at">.drop =</span> <span class="cn">TRUE</span>) {</span>
<span id="cb295-57"><a href="ggplot2.html#cb295-57" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(plyr)</span>
<span id="cb295-58"><a href="ggplot2.html#cb295-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb295-59"><a href="ggplot2.html#cb295-59" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Measure var on left, idvar + between vars on right</span></span>
<span id="cb295-60"><a href="ggplot2.html#cb295-60" aria-hidden="true" tabindex="-1"></a>  <span class="co"># of formula.</span></span>
<span id="cb295-61"><a href="ggplot2.html#cb295-61" aria-hidden="true" tabindex="-1"></a>  data.subjMean <span class="ot">&lt;-</span> <span class="fu">ddply</span>(data, <span class="fu">c</span>(idvar, betweenvars),</span>
<span id="cb295-62"><a href="ggplot2.html#cb295-62" aria-hidden="true" tabindex="-1"></a>    <span class="at">.drop =</span> .drop, <span class="at">.fun =</span> <span class="cf">function</span>(xx, col, na.rm) {</span>
<span id="cb295-63"><a href="ggplot2.html#cb295-63" aria-hidden="true" tabindex="-1"></a>      <span class="fu">c</span>(<span class="at">subjMean =</span> <span class="fu">mean</span>(xx[, col], <span class="at">na.rm =</span> na.rm))</span>
<span id="cb295-64"><a href="ggplot2.html#cb295-64" aria-hidden="true" tabindex="-1"></a>    }, measurevar, na.rm)</span>
<span id="cb295-65"><a href="ggplot2.html#cb295-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb295-66"><a href="ggplot2.html#cb295-66" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Put the subject means with original data</span></span>
<span id="cb295-67"><a href="ggplot2.html#cb295-67" aria-hidden="true" tabindex="-1"></a>  data <span class="ot">&lt;-</span> <span class="fu">merge</span>(data, data.subjMean)</span>
<span id="cb295-68"><a href="ggplot2.html#cb295-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb295-69"><a href="ggplot2.html#cb295-69" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get the normalized data in a new column</span></span>
<span id="cb295-70"><a href="ggplot2.html#cb295-70" aria-hidden="true" tabindex="-1"></a>  measureNormedVar <span class="ot">&lt;-</span> <span class="fu">paste</span>(measurevar, <span class="st">&quot;_norm&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb295-71"><a href="ggplot2.html#cb295-71" aria-hidden="true" tabindex="-1"></a>  data[, measureNormedVar] <span class="ot">&lt;-</span> data[, measurevar] <span class="sc">-</span> data[,</span>
<span id="cb295-72"><a href="ggplot2.html#cb295-72" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;subjMean&quot;</span>] <span class="sc">+</span> <span class="fu">mean</span>(data[, measurevar], <span class="at">na.rm =</span> na.rm)</span>
<span id="cb295-73"><a href="ggplot2.html#cb295-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb295-74"><a href="ggplot2.html#cb295-74" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Remove this subject mean column</span></span>
<span id="cb295-75"><a href="ggplot2.html#cb295-75" aria-hidden="true" tabindex="-1"></a>  data<span class="sc">$</span>subjMean <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb295-76"><a href="ggplot2.html#cb295-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb295-77"><a href="ggplot2.html#cb295-77" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(data)</span>
<span id="cb295-78"><a href="ggplot2.html#cb295-78" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb295-79"><a href="ggplot2.html#cb295-79" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb295-80"><a href="ggplot2.html#cb295-80" aria-hidden="true" tabindex="-1"></a><span class="do">## Summarizes data, handling within-subjects variables</span></span>
<span id="cb295-81"><a href="ggplot2.html#cb295-81" aria-hidden="true" tabindex="-1"></a><span class="do">## by removing inter-subject variability.  It will</span></span>
<span id="cb295-82"><a href="ggplot2.html#cb295-82" aria-hidden="true" tabindex="-1"></a><span class="do">## still work if there are no within-S variables.</span></span>
<span id="cb295-83"><a href="ggplot2.html#cb295-83" aria-hidden="true" tabindex="-1"></a><span class="do">## Gives count, un-normed mean, normed mean (with same</span></span>
<span id="cb295-84"><a href="ggplot2.html#cb295-84" aria-hidden="true" tabindex="-1"></a><span class="do">## between-group mean), standard deviation, standard</span></span>
<span id="cb295-85"><a href="ggplot2.html#cb295-85" aria-hidden="true" tabindex="-1"></a><span class="do">## error of the mean, and confidence interval.  If</span></span>
<span id="cb295-86"><a href="ggplot2.html#cb295-86" aria-hidden="true" tabindex="-1"></a><span class="do">## there are within-subject variables, calculate</span></span>
<span id="cb295-87"><a href="ggplot2.html#cb295-87" aria-hidden="true" tabindex="-1"></a><span class="do">## adjusted values using method from Morey (2008).</span></span>
<span id="cb295-88"><a href="ggplot2.html#cb295-88" aria-hidden="true" tabindex="-1"></a><span class="do">## data: a data frame.  measurevar: the name of a</span></span>
<span id="cb295-89"><a href="ggplot2.html#cb295-89" aria-hidden="true" tabindex="-1"></a><span class="do">## column that contains the variable to be summariezed</span></span>
<span id="cb295-90"><a href="ggplot2.html#cb295-90" aria-hidden="true" tabindex="-1"></a><span class="do">## betweenvars: a vector containing names of columns</span></span>
<span id="cb295-91"><a href="ggplot2.html#cb295-91" aria-hidden="true" tabindex="-1"></a><span class="do">## that are between-subjects variables withinvars: a</span></span>
<span id="cb295-92"><a href="ggplot2.html#cb295-92" aria-hidden="true" tabindex="-1"></a><span class="do">## vector containing names of columns that are</span></span>
<span id="cb295-93"><a href="ggplot2.html#cb295-93" aria-hidden="true" tabindex="-1"></a><span class="do">## within-subjects variables idvar: the name of a</span></span>
<span id="cb295-94"><a href="ggplot2.html#cb295-94" aria-hidden="true" tabindex="-1"></a><span class="do">## column that identifies each subject (or matched</span></span>
<span id="cb295-95"><a href="ggplot2.html#cb295-95" aria-hidden="true" tabindex="-1"></a><span class="do">## subjects) na.rm: a boolean that indicates whether</span></span>
<span id="cb295-96"><a href="ggplot2.html#cb295-96" aria-hidden="true" tabindex="-1"></a><span class="do">## to ignore NA&#39;s conf.interval: the percent range of</span></span>
<span id="cb295-97"><a href="ggplot2.html#cb295-97" aria-hidden="true" tabindex="-1"></a><span class="do">## the confidence interval (default is 95%)</span></span>
<span id="cb295-98"><a href="ggplot2.html#cb295-98" aria-hidden="true" tabindex="-1"></a>summarySEwithin <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">data =</span> <span class="cn">NULL</span>, measurevar, <span class="at">betweenvars =</span> <span class="cn">NULL</span>,</span>
<span id="cb295-99"><a href="ggplot2.html#cb295-99" aria-hidden="true" tabindex="-1"></a>  <span class="at">withinvars =</span> <span class="cn">NULL</span>, <span class="at">idvar =</span> <span class="cn">NULL</span>, <span class="at">na.rm =</span> <span class="cn">FALSE</span>, <span class="at">conf.interval =</span> <span class="fl">0.95</span>,</span>
<span id="cb295-100"><a href="ggplot2.html#cb295-100" aria-hidden="true" tabindex="-1"></a>  <span class="at">.drop =</span> <span class="cn">TRUE</span>) {</span>
<span id="cb295-101"><a href="ggplot2.html#cb295-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb295-102"><a href="ggplot2.html#cb295-102" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Ensure that the betweenvars and withinvars are</span></span>
<span id="cb295-103"><a href="ggplot2.html#cb295-103" aria-hidden="true" tabindex="-1"></a>  <span class="co"># factors</span></span>
<span id="cb295-104"><a href="ggplot2.html#cb295-104" aria-hidden="true" tabindex="-1"></a>  factorvars <span class="ot">&lt;-</span> <span class="fu">vapply</span>(data[, <span class="fu">c</span>(betweenvars, withinvars),</span>
<span id="cb295-105"><a href="ggplot2.html#cb295-105" aria-hidden="true" tabindex="-1"></a>    <span class="at">drop =</span> <span class="cn">FALSE</span>], <span class="at">FUN =</span> is.factor, <span class="at">FUN.VALUE =</span> <span class="fu">logical</span>(<span class="dv">1</span>))</span>
<span id="cb295-106"><a href="ggplot2.html#cb295-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb295-107"><a href="ggplot2.html#cb295-107" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">all</span>(factorvars)) {</span>
<span id="cb295-108"><a href="ggplot2.html#cb295-108" aria-hidden="true" tabindex="-1"></a>    nonfactorvars <span class="ot">&lt;-</span> <span class="fu">names</span>(factorvars)[<span class="sc">!</span>factorvars]</span>
<span id="cb295-109"><a href="ggplot2.html#cb295-109" aria-hidden="true" tabindex="-1"></a>    <span class="fu">message</span>(<span class="st">&quot;Automatically converting the following non-factors to factors: &quot;</span>,</span>
<span id="cb295-110"><a href="ggplot2.html#cb295-110" aria-hidden="true" tabindex="-1"></a>      <span class="fu">paste</span>(nonfactorvars, <span class="at">collapse =</span> <span class="st">&quot;, &quot;</span>))</span>
<span id="cb295-111"><a href="ggplot2.html#cb295-111" aria-hidden="true" tabindex="-1"></a>    data[nonfactorvars] <span class="ot">&lt;-</span> <span class="fu">lapply</span>(data[nonfactorvars],</span>
<span id="cb295-112"><a href="ggplot2.html#cb295-112" aria-hidden="true" tabindex="-1"></a>      factor)</span>
<span id="cb295-113"><a href="ggplot2.html#cb295-113" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb295-114"><a href="ggplot2.html#cb295-114" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb295-115"><a href="ggplot2.html#cb295-115" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Get the means from the un-normed data</span></span>
<span id="cb295-116"><a href="ggplot2.html#cb295-116" aria-hidden="true" tabindex="-1"></a>  datac <span class="ot">&lt;-</span> <span class="fu">summarySE</span>(data, measurevar, <span class="at">groupvars =</span> <span class="fu">c</span>(betweenvars,</span>
<span id="cb295-117"><a href="ggplot2.html#cb295-117" aria-hidden="true" tabindex="-1"></a>    withinvars), <span class="at">na.rm =</span> na.rm, <span class="at">conf.interval =</span> conf.interval,</span>
<span id="cb295-118"><a href="ggplot2.html#cb295-118" aria-hidden="true" tabindex="-1"></a>    <span class="at">.drop =</span> .drop)</span>
<span id="cb295-119"><a href="ggplot2.html#cb295-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb295-120"><a href="ggplot2.html#cb295-120" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Drop all the unused columns (these will be</span></span>
<span id="cb295-121"><a href="ggplot2.html#cb295-121" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculated with normed data)</span></span>
<span id="cb295-122"><a href="ggplot2.html#cb295-122" aria-hidden="true" tabindex="-1"></a>  datac<span class="sc">$</span>sd <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb295-123"><a href="ggplot2.html#cb295-123" aria-hidden="true" tabindex="-1"></a>  datac<span class="sc">$</span>se <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb295-124"><a href="ggplot2.html#cb295-124" aria-hidden="true" tabindex="-1"></a>  datac<span class="sc">$</span>ci <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb295-125"><a href="ggplot2.html#cb295-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb295-126"><a href="ggplot2.html#cb295-126" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Norm each subject&#39;s data</span></span>
<span id="cb295-127"><a href="ggplot2.html#cb295-127" aria-hidden="true" tabindex="-1"></a>  ndata <span class="ot">&lt;-</span> <span class="fu">normDataWithin</span>(data, idvar, measurevar, betweenvars,</span>
<span id="cb295-128"><a href="ggplot2.html#cb295-128" aria-hidden="true" tabindex="-1"></a>    na.rm, <span class="at">.drop =</span> .drop)</span>
<span id="cb295-129"><a href="ggplot2.html#cb295-129" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb295-130"><a href="ggplot2.html#cb295-130" aria-hidden="true" tabindex="-1"></a>  <span class="co"># This is the name of the new column</span></span>
<span id="cb295-131"><a href="ggplot2.html#cb295-131" aria-hidden="true" tabindex="-1"></a>  measurevar_n <span class="ot">&lt;-</span> <span class="fu">paste</span>(measurevar, <span class="st">&quot;_norm&quot;</span>, <span class="at">sep =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb295-132"><a href="ggplot2.html#cb295-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb295-133"><a href="ggplot2.html#cb295-133" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Collapse the normed data - now we can treat</span></span>
<span id="cb295-134"><a href="ggplot2.html#cb295-134" aria-hidden="true" tabindex="-1"></a>  <span class="co"># between and within vars the same</span></span>
<span id="cb295-135"><a href="ggplot2.html#cb295-135" aria-hidden="true" tabindex="-1"></a>  ndatac <span class="ot">&lt;-</span> <span class="fu">summarySE</span>(ndata, measurevar_n, <span class="at">groupvars =</span> <span class="fu">c</span>(betweenvars,</span>
<span id="cb295-136"><a href="ggplot2.html#cb295-136" aria-hidden="true" tabindex="-1"></a>    withinvars), <span class="at">na.rm =</span> na.rm, <span class="at">conf.interval =</span> conf.interval,</span>
<span id="cb295-137"><a href="ggplot2.html#cb295-137" aria-hidden="true" tabindex="-1"></a>    <span class="at">.drop =</span> .drop)</span>
<span id="cb295-138"><a href="ggplot2.html#cb295-138" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb295-139"><a href="ggplot2.html#cb295-139" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Apply correction from Morey (2008) to the standard</span></span>
<span id="cb295-140"><a href="ggplot2.html#cb295-140" aria-hidden="true" tabindex="-1"></a>  <span class="co"># error and confidence interval Get the product of</span></span>
<span id="cb295-141"><a href="ggplot2.html#cb295-141" aria-hidden="true" tabindex="-1"></a>  <span class="co"># the number of conditions of within-S variables</span></span>
<span id="cb295-142"><a href="ggplot2.html#cb295-142" aria-hidden="true" tabindex="-1"></a>  nWithinGroups <span class="ot">&lt;-</span> <span class="fu">prod</span>(<span class="fu">vapply</span>(ndatac[, withinvars, <span class="at">drop =</span> <span class="cn">FALSE</span>],</span>
<span id="cb295-143"><a href="ggplot2.html#cb295-143" aria-hidden="true" tabindex="-1"></a>    <span class="at">FUN =</span> nlevels, <span class="at">FUN.VALUE =</span> <span class="fu">numeric</span>(<span class="dv">1</span>)))</span>
<span id="cb295-144"><a href="ggplot2.html#cb295-144" aria-hidden="true" tabindex="-1"></a>  correctionFactor <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(nWithinGroups<span class="sc">/</span>(nWithinGroups <span class="sc">-</span></span>
<span id="cb295-145"><a href="ggplot2.html#cb295-145" aria-hidden="true" tabindex="-1"></a>    <span class="dv">1</span>))</span>
<span id="cb295-146"><a href="ggplot2.html#cb295-146" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb295-147"><a href="ggplot2.html#cb295-147" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Apply the correction factor</span></span>
<span id="cb295-148"><a href="ggplot2.html#cb295-148" aria-hidden="true" tabindex="-1"></a>  ndatac<span class="sc">$</span>sd <span class="ot">&lt;-</span> ndatac<span class="sc">$</span>sd <span class="sc">*</span> correctionFactor</span>
<span id="cb295-149"><a href="ggplot2.html#cb295-149" aria-hidden="true" tabindex="-1"></a>  ndatac<span class="sc">$</span>se <span class="ot">&lt;-</span> ndatac<span class="sc">$</span>se <span class="sc">*</span> correctionFactor</span>
<span id="cb295-150"><a href="ggplot2.html#cb295-150" aria-hidden="true" tabindex="-1"></a>  ndatac<span class="sc">$</span>ci <span class="ot">&lt;-</span> ndatac<span class="sc">$</span>ci <span class="sc">*</span> correctionFactor</span>
<span id="cb295-151"><a href="ggplot2.html#cb295-151" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb295-152"><a href="ggplot2.html#cb295-152" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Combine the un-normed means with the normed</span></span>
<span id="cb295-153"><a href="ggplot2.html#cb295-153" aria-hidden="true" tabindex="-1"></a>  <span class="co"># results</span></span>
<span id="cb295-154"><a href="ggplot2.html#cb295-154" aria-hidden="true" tabindex="-1"></a>  <span class="fu">merge</span>(datac, ndatac)</span>
<span id="cb295-155"><a href="ggplot2.html#cb295-155" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="示例数据" class="section level4" number="9.2.2.2">
<h4><span class="header-section-number">9.2.2.2</span> 示例数据</h4>
<p>下面的示例将使用 <code>ToothGrowth</code> 数据集。注意 <code>dose</code> 在这里是一个数值列，一些情况下我们将它转换为因子变量将会更加有用。</p>
<div class="sourceCode" id="cb296"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb296-1"><a href="ggplot2.html#cb296-1" aria-hidden="true" tabindex="-1"></a>tg <span class="ot">&lt;-</span> ToothGrowth</span>
<span id="cb296-2"><a href="ggplot2.html#cb296-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(tg)</span>
<span id="cb296-3"><a href="ggplot2.html#cb296-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    len supp dose</span></span>
<span id="cb296-4"><a href="ggplot2.html#cb296-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1  4.2   VC  0.5</span></span>
<span id="cb296-5"><a href="ggplot2.html#cb296-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 11.5   VC  0.5</span></span>
<span id="cb296-6"><a href="ggplot2.html#cb296-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3  7.3   VC  0.5</span></span>
<span id="cb296-7"><a href="ggplot2.html#cb296-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4  5.8   VC  0.5</span></span>
<span id="cb296-8"><a href="ggplot2.html#cb296-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5  6.4   VC  0.5</span></span>
<span id="cb296-9"><a href="ggplot2.html#cb296-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6 10.0   VC  0.5</span></span>
<span id="cb296-10"><a href="ggplot2.html#cb296-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span></code></pre></div>
<p>首先，我们必须对数据进行统计汇总。 这可以通过多种方式实现，参阅<a href="#section-6.18">汇总数据</a>。在这个案例中，我们将使用 <code>summarySE()</code> 函数( 确保<code>summarySE()</code> 函数的代码在使用前已经键入)。</p>
<div class="sourceCode" id="cb297"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb297-1"><a href="ggplot2.html#cb297-1" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages(&#39;Rmisc&#39;)</span></span>
<span id="cb297-2"><a href="ggplot2.html#cb297-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(Rmisc)</span>
<span id="cb297-3"><a href="ggplot2.html#cb297-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 载入需要的程辑包：lattice</span></span>
<span id="cb297-4"><a href="ggplot2.html#cb297-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 载入需要的程辑包：plyr</span></span>
<span id="cb297-5"><a href="ggplot2.html#cb297-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb297-6"><a href="ggplot2.html#cb297-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 载入程辑包：&#39;Rmisc&#39;</span></span>
<span id="cb297-7"><a href="ggplot2.html#cb297-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; The following objects are masked _by_ &#39;.GlobalEnv&#39;:</span></span>
<span id="cb297-8"><a href="ggplot2.html#cb297-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb297-9"><a href="ggplot2.html#cb297-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     normDataWithin, summarySE, summarySEwithin</span></span>
<span id="cb297-10"><a href="ggplot2.html#cb297-10" aria-hidden="true" tabindex="-1"></a><span class="co"># summarySE 函数提供了标准差、标准误以及 95%</span></span>
<span id="cb297-11"><a href="ggplot2.html#cb297-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 的置信区间</span></span>
<span id="cb297-12"><a href="ggplot2.html#cb297-12" aria-hidden="true" tabindex="-1"></a>tgc <span class="ot">&lt;-</span> <span class="fu">summarySE</span>(tg, <span class="at">measurevar =</span> <span class="st">&quot;len&quot;</span>, <span class="at">groupvars =</span> <span class="fu">c</span>(<span class="st">&quot;supp&quot;</span>,</span>
<span id="cb297-13"><a href="ggplot2.html#cb297-13" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;dose&quot;</span>))</span>
<span id="cb297-14"><a href="ggplot2.html#cb297-14" aria-hidden="true" tabindex="-1"></a>tgc</span>
<span id="cb297-15"><a href="ggplot2.html#cb297-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   supp dose  N   len    sd     se    ci</span></span>
<span id="cb297-16"><a href="ggplot2.html#cb297-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1   OJ  0.5 10 13.23 4.460 1.4103 3.190</span></span>
<span id="cb297-17"><a href="ggplot2.html#cb297-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2   OJ  1.0 10 22.70 3.911 1.2368 2.798</span></span>
<span id="cb297-18"><a href="ggplot2.html#cb297-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3   OJ  2.0 10 26.06 2.655 0.8396 1.899</span></span>
<span id="cb297-19"><a href="ggplot2.html#cb297-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4   VC  0.5 10  7.98 2.747 0.8686 1.965</span></span>
<span id="cb297-20"><a href="ggplot2.html#cb297-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5   VC  1.0 10 16.77 2.515 0.7954 1.799</span></span>
<span id="cb297-21"><a href="ggplot2.html#cb297-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6   VC  2.0 10 26.14 4.798 1.5172 3.432</span></span></code></pre></div>
</div>
<div id="线图-2" class="section level4" number="9.2.2.3">
<h4><span class="header-section-number">9.2.2.3</span> 线图</h4>
<p>数据统计总结后，我们就可以开始绘制图形了。这里是一些带误差线的线图和点图，误差线代表标准差、标准误或者是 95% 的置信区间。</p>
<div class="sourceCode" id="cb298"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb298-1"><a href="ggplot2.html#cb298-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 均值的标准误</span></span>
<span id="cb298-2"><a href="ggplot2.html#cb298-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(tgc, <span class="fu">aes</span>(<span class="at">x =</span> dose, <span class="at">y =</span> len, <span class="at">colour =</span> supp)) <span class="sc">+</span> <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> len <span class="sc">-</span></span>
<span id="cb298-3"><a href="ggplot2.html#cb298-3" aria-hidden="true" tabindex="-1"></a>  se, <span class="at">ymax =</span> len <span class="sc">+</span> se), <span class="at">width =</span> <span class="fl">0.1</span>) <span class="sc">+</span> <span class="fu">geom_line</span>() <span class="sc">+</span> <span class="fu">geom_point</span>()</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-261-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb299"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb299-1"><a href="ggplot2.html#cb299-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb299-2"><a href="ggplot2.html#cb299-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 发现误差线重叠（dose=2.0），我们使用 position_dodge</span></span>
<span id="cb299-3"><a href="ggplot2.html#cb299-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 将它们进行水平移动</span></span>
<span id="cb299-4"><a href="ggplot2.html#cb299-4" aria-hidden="true" tabindex="-1"></a>pd <span class="ot">&lt;-</span> <span class="fu">position_dodge</span>(<span class="fl">0.1</span>)  <span class="co"># move them .05 to the left and right</span></span>
<span id="cb299-5"><a href="ggplot2.html#cb299-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb299-6"><a href="ggplot2.html#cb299-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(tgc, <span class="fu">aes</span>(<span class="at">x =</span> dose, <span class="at">y =</span> len, <span class="at">colour =</span> supp)) <span class="sc">+</span> <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> len <span class="sc">-</span></span>
<span id="cb299-7"><a href="ggplot2.html#cb299-7" aria-hidden="true" tabindex="-1"></a>  se, <span class="at">ymax =</span> len <span class="sc">+</span> se), <span class="at">width =</span> <span class="fl">0.1</span>, <span class="at">position =</span> pd) <span class="sc">+</span></span>
<span id="cb299-8"><a href="ggplot2.html#cb299-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">position =</span> pd) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">position =</span> pd)</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-261-2.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb300"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb300-1"><a href="ggplot2.html#cb300-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb300-2"><a href="ggplot2.html#cb300-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 使用 95% 置信区间替换标准误</span></span>
<span id="cb300-3"><a href="ggplot2.html#cb300-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(tgc, <span class="fu">aes</span>(<span class="at">x =</span> dose, <span class="at">y =</span> len, <span class="at">colour =</span> supp)) <span class="sc">+</span> <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> len <span class="sc">-</span></span>
<span id="cb300-4"><a href="ggplot2.html#cb300-4" aria-hidden="true" tabindex="-1"></a>  ci, <span class="at">ymax =</span> len <span class="sc">+</span> ci), <span class="at">width =</span> <span class="fl">0.1</span>, <span class="at">position =</span> pd) <span class="sc">+</span></span>
<span id="cb300-5"><a href="ggplot2.html#cb300-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">position =</span> pd) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">position =</span> pd)</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-261-3.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb301"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb301-1"><a href="ggplot2.html#cb301-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb301-2"><a href="ggplot2.html#cb301-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 黑色的误差线 - 注意 &#39;group=supp&#39; 的映射 --</span></span>
<span id="cb301-3"><a href="ggplot2.html#cb301-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 没有它，误差线将不会避开（就是会重叠）。</span></span>
<span id="cb301-4"><a href="ggplot2.html#cb301-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(tgc, <span class="fu">aes</span>(<span class="at">x =</span> dose, <span class="at">y =</span> len, <span class="at">colour =</span> supp, <span class="at">group =</span> supp)) <span class="sc">+</span></span>
<span id="cb301-5"><a href="ggplot2.html#cb301-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin =</span> len <span class="sc">-</span> ci, <span class="at">ymax =</span> len <span class="sc">+</span> ci),</span>
<span id="cb301-6"><a href="ggplot2.html#cb301-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">colour =</span> <span class="st">&quot;black&quot;</span>, <span class="at">width =</span> <span class="fl">0.1</span>, <span class="at">position =</span> pd) <span class="sc">+</span></span>
<span id="cb301-7"><a href="ggplot2.html#cb301-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">position =</span> pd) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">position =</span> pd,</span>
<span id="cb301-8"><a href="ggplot2.html#cb301-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">size =</span> <span class="dv">3</span>)</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-261-4.png" width="672" style="display: block; margin: auto;" /></p>
<p>一张完成的带误差线（代表均值的标准误）的图形可能像下面显示的那样。最后画点，这样白色将会在线和误差线的上面（这个需要理解图层概念，顺序不同展示的效果是不一样的）。</p>
<div class="sourceCode" id="cb302"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb302-1"><a href="ggplot2.html#cb302-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(tgc, <span class="fu">aes</span>(<span class="at">x=</span>dose, <span class="at">y=</span>len, <span class="at">colour=</span>supp, <span class="at">group=</span>supp)) <span class="sc">+</span> </span>
<span id="cb302-2"><a href="ggplot2.html#cb302-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin=</span>len<span class="sc">-</span>se, <span class="at">ymax=</span>len<span class="sc">+</span>se), <span class="at">colour=</span><span class="st">&quot;black&quot;</span>, <span class="at">width=</span>.<span class="dv">1</span>, <span class="at">position=</span>pd) <span class="sc">+</span></span>
<span id="cb302-3"><a href="ggplot2.html#cb302-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="at">position=</span>pd) <span class="sc">+</span></span>
<span id="cb302-4"><a href="ggplot2.html#cb302-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">position=</span>pd, <span class="at">size=</span><span class="dv">3</span>, <span class="at">shape=</span><span class="dv">21</span>, <span class="at">fill=</span><span class="st">&quot;white&quot;</span>) <span class="sc">+</span> <span class="co"># 21的填充的圆</span></span>
<span id="cb302-5"><a href="ggplot2.html#cb302-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">&quot;Dose (mg)&quot;</span>) <span class="sc">+</span></span>
<span id="cb302-6"><a href="ggplot2.html#cb302-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">&quot;Tooth length&quot;</span>) <span class="sc">+</span></span>
<span id="cb302-7"><a href="ggplot2.html#cb302-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_colour_hue</span>(<span class="at">name=</span><span class="st">&quot;Supplement type&quot;</span>,    <span class="co"># 图例标签使用暗色</span></span>
<span id="cb302-8"><a href="ggplot2.html#cb302-8" aria-hidden="true" tabindex="-1"></a>                     <span class="at">breaks=</span><span class="fu">c</span>(<span class="st">&quot;OJ&quot;</span>, <span class="st">&quot;VC&quot;</span>),</span>
<span id="cb302-9"><a href="ggplot2.html#cb302-9" aria-hidden="true" tabindex="-1"></a>                     <span class="at">labels=</span><span class="fu">c</span>(<span class="st">&quot;Orange juice&quot;</span>, <span class="st">&quot;Ascorbic acid&quot;</span>),</span>
<span id="cb302-10"><a href="ggplot2.html#cb302-10" aria-hidden="true" tabindex="-1"></a>                     <span class="at">l=</span><span class="dv">40</span>) <span class="sc">+</span>                    <span class="co"># 使用暗色，亮度为40</span></span>
<span id="cb302-11"><a href="ggplot2.html#cb302-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">&quot;The Effect of Vitamin C on</span><span class="sc">\n</span><span class="st">Tooth Growth in Guinea Pigs&quot;</span>) <span class="sc">+</span></span>
<span id="cb302-12"><a href="ggplot2.html#cb302-12" aria-hidden="true" tabindex="-1"></a>    <span class="fu">expand_limits</span>(<span class="at">y=</span><span class="dv">0</span>) <span class="sc">+</span>                        <span class="co"># 扩展范围</span></span>
<span id="cb302-13"><a href="ggplot2.html#cb302-13" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">breaks=</span><span class="dv">0</span><span class="sc">:</span><span class="dv">20</span><span class="sc">*</span><span class="dv">4</span>) <span class="sc">+</span>         <span class="co"># 每4个单位设置标记（y轴）</span></span>
<span id="cb302-14"><a href="ggplot2.html#cb302-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb302-15"><a href="ggplot2.html#cb302-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">legend.justification=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">0</span>),</span>
<span id="cb302-16"><a href="ggplot2.html#cb302-16" aria-hidden="true" tabindex="-1"></a>          <span class="at">legend.position=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">0</span>))               <span class="co"># 右下方放置图例</span></span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-262-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="条形图-1" class="section level4" number="9.2.2.4">
<h4><span class="header-section-number">9.2.2.4</span> 条形图</h4>
<p>条形图绘制误差线也非常相似。 注意 <code>tgc$dose</code> 必须是一个因子。如果它是一个数值向量，将会不起作用。</p>
<div class="sourceCode" id="cb303"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb303-1"><a href="ggplot2.html#cb303-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 将dose转换为因子变量</span></span>
<span id="cb303-2"><a href="ggplot2.html#cb303-2" aria-hidden="true" tabindex="-1"></a>tgc2 <span class="ot">&lt;-</span> tgc</span>
<span id="cb303-3"><a href="ggplot2.html#cb303-3" aria-hidden="true" tabindex="-1"></a>tgc2<span class="sc">$</span>dose <span class="ot">&lt;-</span> <span class="fu">factor</span>(tgc2<span class="sc">$</span>dose)</span>
<span id="cb303-4"><a href="ggplot2.html#cb303-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb303-5"><a href="ggplot2.html#cb303-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 误差线代表了均值的标准误</span></span>
<span id="cb303-6"><a href="ggplot2.html#cb303-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(tgc2, <span class="fu">aes</span>(<span class="at">x=</span>dose, <span class="at">y=</span>len, <span class="at">fill=</span>supp)) <span class="sc">+</span> </span>
<span id="cb303-7"><a href="ggplot2.html#cb303-7" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">position=</span><span class="fu">position_dodge</span>(), <span class="at">stat=</span><span class="st">&quot;identity&quot;</span>) <span class="sc">+</span></span>
<span id="cb303-8"><a href="ggplot2.html#cb303-8" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin=</span>len<span class="sc">-</span>se, <span class="at">ymax=</span>len<span class="sc">+</span>se),</span>
<span id="cb303-9"><a href="ggplot2.html#cb303-9" aria-hidden="true" tabindex="-1"></a>                  <span class="at">width=</span>.<span class="dv">2</span>,                    <span class="co"># 误差线的宽度</span></span>
<span id="cb303-10"><a href="ggplot2.html#cb303-10" aria-hidden="true" tabindex="-1"></a>                  <span class="at">position=</span><span class="fu">position_dodge</span>(.<span class="dv">9</span>))</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-263-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb304"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb304-1"><a href="ggplot2.html#cb304-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 使用95%的置信区间替换标准误</span></span>
<span id="cb304-2"><a href="ggplot2.html#cb304-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(tgc2, <span class="fu">aes</span>(<span class="at">x=</span>dose, <span class="at">y=</span>len, <span class="at">fill=</span>supp)) <span class="sc">+</span> </span>
<span id="cb304-3"><a href="ggplot2.html#cb304-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">position=</span><span class="fu">position_dodge</span>(), <span class="at">stat=</span><span class="st">&quot;identity&quot;</span>) <span class="sc">+</span></span>
<span id="cb304-4"><a href="ggplot2.html#cb304-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin=</span>len<span class="sc">-</span>ci, <span class="at">ymax=</span>len<span class="sc">+</span>ci),</span>
<span id="cb304-5"><a href="ggplot2.html#cb304-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">width=</span>.<span class="dv">2</span>,                    <span class="co"># 误差线的宽度</span></span>
<span id="cb304-6"><a href="ggplot2.html#cb304-6" aria-hidden="true" tabindex="-1"></a>                  <span class="at">position=</span><span class="fu">position_dodge</span>(.<span class="dv">9</span>))</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-263-2.png" width="672" style="display: block; margin: auto;" /></p>
<p>一张绘制完成的图片像下面这样：</p>
<div class="sourceCode" id="cb305"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb305-1"><a href="ggplot2.html#cb305-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(tgc2, <span class="fu">aes</span>(<span class="at">x=</span>dose, <span class="at">y=</span>len, <span class="at">fill=</span>supp)) <span class="sc">+</span> </span>
<span id="cb305-2"><a href="ggplot2.html#cb305-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="at">position=</span><span class="fu">position_dodge</span>(), <span class="at">stat=</span><span class="st">&quot;identity&quot;</span>,</span>
<span id="cb305-3"><a href="ggplot2.html#cb305-3" aria-hidden="true" tabindex="-1"></a>             <span class="at">colour=</span><span class="st">&quot;black&quot;</span>, <span class="co"># 使用黑色边框,</span></span>
<span id="cb305-4"><a href="ggplot2.html#cb305-4" aria-hidden="true" tabindex="-1"></a>             <span class="at">size=</span>.<span class="dv">3</span>) <span class="sc">+</span>      <span class="co"># 将线变细</span></span>
<span id="cb305-5"><a href="ggplot2.html#cb305-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymin=</span>len<span class="sc">-</span>se, <span class="at">ymax=</span>len<span class="sc">+</span>se),</span>
<span id="cb305-6"><a href="ggplot2.html#cb305-6" aria-hidden="true" tabindex="-1"></a>                  <span class="at">size=</span>.<span class="dv">3</span>,    <span class="co"># 将线变细</span></span>
<span id="cb305-7"><a href="ggplot2.html#cb305-7" aria-hidden="true" tabindex="-1"></a>                  <span class="at">width=</span>.<span class="dv">2</span>,</span>
<span id="cb305-8"><a href="ggplot2.html#cb305-8" aria-hidden="true" tabindex="-1"></a>                  <span class="at">position=</span><span class="fu">position_dodge</span>(.<span class="dv">9</span>)) <span class="sc">+</span></span>
<span id="cb305-9"><a href="ggplot2.html#cb305-9" aria-hidden="true" tabindex="-1"></a>    <span class="fu">xlab</span>(<span class="st">&quot;Dose (mg)&quot;</span>) <span class="sc">+</span></span>
<span id="cb305-10"><a href="ggplot2.html#cb305-10" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ylab</span>(<span class="st">&quot;Tooth length&quot;</span>) <span class="sc">+</span></span>
<span id="cb305-11"><a href="ggplot2.html#cb305-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_fill_hue</span>(<span class="at">name=</span><span class="st">&quot;Supplement type&quot;</span>, <span class="co"># Legend label, use darker colors</span></span>
<span id="cb305-12"><a href="ggplot2.html#cb305-12" aria-hidden="true" tabindex="-1"></a>                   <span class="at">breaks=</span><span class="fu">c</span>(<span class="st">&quot;OJ&quot;</span>, <span class="st">&quot;VC&quot;</span>),</span>
<span id="cb305-13"><a href="ggplot2.html#cb305-13" aria-hidden="true" tabindex="-1"></a>                   <span class="at">labels=</span><span class="fu">c</span>(<span class="st">&quot;Orange juice&quot;</span>, <span class="st">&quot;Ascorbic acid&quot;</span>)) <span class="sc">+</span></span>
<span id="cb305-14"><a href="ggplot2.html#cb305-14" aria-hidden="true" tabindex="-1"></a>    <span class="fu">ggtitle</span>(<span class="st">&quot;The Effect of Vitamin C on</span><span class="sc">\n</span><span class="st">Tooth Growth in Guinea Pigs&quot;</span>) <span class="sc">+</span></span>
<span id="cb305-15"><a href="ggplot2.html#cb305-15" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">breaks=</span><span class="dv">0</span><span class="sc">:</span><span class="dv">20</span><span class="sc">*</span><span class="dv">4</span>) <span class="sc">+</span></span>
<span id="cb305-16"><a href="ggplot2.html#cb305-16" aria-hidden="true" tabindex="-1"></a>    <span class="fu">theme_bw</span>()</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-264-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="为组内变量添加误差线" class="section level4" number="9.2.2.5">
<h4><span class="header-section-number">9.2.2.5</span> 为组内变量添加误差线</h4>
<p>当所有的变量都属于不同组别时，我们画标准误或者置信区间会显得非常简单直观。然而，当我们描绘的是组内变量（重复测量），那么添加标准误或者通常的置信区间可能会对不同条件下差异的推断产生误导作用。</p>
<p>下面的方法来自 <a href="http://tqmp.org/Content/vol04-2/p061/p061.html">Morey (2008)</a>，它是对 <a href="http://tqmp.org/Content/vol01-1/p042/p042.html">Cousineau (2005)</a>的矫正，而它所做的就是 提供比 <a href="http://www.springerlink.com/content/n2r2t04244246k68/">Loftus and Masson (1994)</a>更简单的方法。 你可以查看这些文章，以获得更多对组内变量误差线问题的详细探讨和方案。</p>
<p>这里有一个组内变量的数据集 (来自 Morey 2008)，包含 <code>pre/post-test</code>。</p>
<div class="sourceCode" id="cb306"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb306-1"><a href="ggplot2.html#cb306-1" aria-hidden="true" tabindex="-1"></a>dfw <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="at">header =</span> <span class="cn">TRUE</span>, <span class="at">text =</span> <span class="st">&quot;</span></span>
<span id="cb306-2"><a href="ggplot2.html#cb306-2" aria-hidden="true" tabindex="-1"></a><span class="st"> subject pretest posttest</span></span>
<span id="cb306-3"><a href="ggplot2.html#cb306-3" aria-hidden="true" tabindex="-1"></a><span class="st">       1    59.4     64.5</span></span>
<span id="cb306-4"><a href="ggplot2.html#cb306-4" aria-hidden="true" tabindex="-1"></a><span class="st">       2    46.4     52.4</span></span>
<span id="cb306-5"><a href="ggplot2.html#cb306-5" aria-hidden="true" tabindex="-1"></a><span class="st">       3    46.0     49.7</span></span>
<span id="cb306-6"><a href="ggplot2.html#cb306-6" aria-hidden="true" tabindex="-1"></a><span class="st">       4    49.0     48.7</span></span>
<span id="cb306-7"><a href="ggplot2.html#cb306-7" aria-hidden="true" tabindex="-1"></a><span class="st">       5    32.5     37.4</span></span>
<span id="cb306-8"><a href="ggplot2.html#cb306-8" aria-hidden="true" tabindex="-1"></a><span class="st">       6    45.2     49.5</span></span>
<span id="cb306-9"><a href="ggplot2.html#cb306-9" aria-hidden="true" tabindex="-1"></a><span class="st">       7    60.3     59.9</span></span>
<span id="cb306-10"><a href="ggplot2.html#cb306-10" aria-hidden="true" tabindex="-1"></a><span class="st">       8    54.3     54.1</span></span>
<span id="cb306-11"><a href="ggplot2.html#cb306-11" aria-hidden="true" tabindex="-1"></a><span class="st">       9    45.4     49.6</span></span>
<span id="cb306-12"><a href="ggplot2.html#cb306-12" aria-hidden="true" tabindex="-1"></a><span class="st">      10    38.9     48.5</span></span>
<span id="cb306-13"><a href="ggplot2.html#cb306-13" aria-hidden="true" tabindex="-1"></a><span class="st"> &quot;</span>)</span>
<span id="cb306-14"><a href="ggplot2.html#cb306-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb306-15"><a href="ggplot2.html#cb306-15" aria-hidden="true" tabindex="-1"></a><span class="co"># 将物体的 ID 作为因子变量对待</span></span>
<span id="cb306-16"><a href="ggplot2.html#cb306-16" aria-hidden="true" tabindex="-1"></a>dfw<span class="sc">$</span>subject <span class="ot">&lt;-</span> <span class="fu">factor</span>(dfw<span class="sc">$</span>subject)</span></code></pre></div>
<p>第一步是将该数据集转换为长格式，参见<a href="#section-6.17">长宽格式数据互换</a>获取更多信息。</p>
<div class="sourceCode" id="cb307"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb307-1"><a href="ggplot2.html#cb307-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 转换为长格式</span></span>
<span id="cb307-2"><a href="ggplot2.html#cb307-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reshape2)</span>
<span id="cb307-3"><a href="ggplot2.html#cb307-3" aria-hidden="true" tabindex="-1"></a>dfw_long <span class="ot">&lt;-</span> <span class="fu">melt</span>(dfw, <span class="at">id.vars =</span> <span class="st">&quot;subject&quot;</span>, <span class="at">measure.vars =</span> <span class="fu">c</span>(<span class="st">&quot;pretest&quot;</span>,</span>
<span id="cb307-4"><a href="ggplot2.html#cb307-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;posttest&quot;</span>), <span class="at">variable.name =</span> <span class="st">&quot;condition&quot;</span>)</span>
<span id="cb307-5"><a href="ggplot2.html#cb307-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb307-6"><a href="ggplot2.html#cb307-6" aria-hidden="true" tabindex="-1"></a>dfw_long</span>
<span id="cb307-7"><a href="ggplot2.html#cb307-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    subject condition value</span></span>
<span id="cb307-8"><a href="ggplot2.html#cb307-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1        1   pretest  59.4</span></span>
<span id="cb307-9"><a href="ggplot2.html#cb307-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2        2   pretest  46.4</span></span>
<span id="cb307-10"><a href="ggplot2.html#cb307-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3        3   pretest  46.0</span></span>
<span id="cb307-11"><a href="ggplot2.html#cb307-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4        4   pretest  49.0</span></span>
<span id="cb307-12"><a href="ggplot2.html#cb307-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5        5   pretest  32.5</span></span>
<span id="cb307-13"><a href="ggplot2.html#cb307-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6        6   pretest  45.2</span></span>
<span id="cb307-14"><a href="ggplot2.html#cb307-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 7        7   pretest  60.3</span></span>
<span id="cb307-15"><a href="ggplot2.html#cb307-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 8        8   pretest  54.3</span></span>
<span id="cb307-16"><a href="ggplot2.html#cb307-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 9        9   pretest  45.4</span></span>
<span id="cb307-17"><a href="ggplot2.html#cb307-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 10      10   pretest  38.9</span></span>
<span id="cb307-18"><a href="ggplot2.html#cb307-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 11       1  posttest  64.5</span></span>
<span id="cb307-19"><a href="ggplot2.html#cb307-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 12       2  posttest  52.4</span></span>
<span id="cb307-20"><a href="ggplot2.html#cb307-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 13       3  posttest  49.7</span></span>
<span id="cb307-21"><a href="ggplot2.html#cb307-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 14       4  posttest  48.7</span></span>
<span id="cb307-22"><a href="ggplot2.html#cb307-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 15       5  posttest  37.4</span></span>
<span id="cb307-23"><a href="ggplot2.html#cb307-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 16       6  posttest  49.5</span></span>
<span id="cb307-24"><a href="ggplot2.html#cb307-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 17       7  posttest  59.9</span></span>
<span id="cb307-25"><a href="ggplot2.html#cb307-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 18       8  posttest  54.1</span></span>
<span id="cb307-26"><a href="ggplot2.html#cb307-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 19       9  posttest  49.6</span></span>
<span id="cb307-27"><a href="ggplot2.html#cb307-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 20      10  posttest  48.5</span></span></code></pre></div>
<p>使用 <code>summarySEwithin()</code> 函数拆解数据。</p>
<div class="sourceCode" id="cb308"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb308-1"><a href="ggplot2.html#cb308-1" aria-hidden="true" tabindex="-1"></a>dfwc <span class="ot">&lt;-</span> <span class="fu">summarySEwithin</span>(dfw_long, <span class="at">measurevar =</span> <span class="st">&quot;value&quot;</span>,</span>
<span id="cb308-2"><a href="ggplot2.html#cb308-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">withinvars =</span> <span class="st">&quot;condition&quot;</span>, <span class="at">idvar =</span> <span class="st">&quot;subject&quot;</span>, <span class="at">na.rm =</span> <span class="cn">FALSE</span>,</span>
<span id="cb308-3"><a href="ggplot2.html#cb308-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">conf.interval =</span> <span class="fl">0.95</span>)</span>
<span id="cb308-4"><a href="ggplot2.html#cb308-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb308-5"><a href="ggplot2.html#cb308-5" aria-hidden="true" tabindex="-1"></a>dfwc</span>
<span id="cb308-6"><a href="ggplot2.html#cb308-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   condition  N value value_norm    sd     se    ci</span></span>
<span id="cb308-7"><a href="ggplot2.html#cb308-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1  posttest 10 51.43      51.43 2.262 0.7154 1.618</span></span>
<span id="cb308-8"><a href="ggplot2.html#cb308-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2   pretest 10 47.74      47.74 2.262 0.7154 1.618</span></span>
<span id="cb308-9"><a href="ggplot2.html#cb308-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb308-10"><a href="ggplot2.html#cb308-10" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb308-11"><a href="ggplot2.html#cb308-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 创建带 95% 置信区间的图形</span></span>
<span id="cb308-12"><a href="ggplot2.html#cb308-12" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dfwc, <span class="fu">aes</span>(<span class="at">x =</span> condition, <span class="at">y =</span> value, <span class="at">group =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb308-13"><a href="ggplot2.html#cb308-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> <span class="fu">geom_errorbar</span>(<span class="at">width =</span> <span class="fl">0.1</span>, <span class="fu">aes</span>(<span class="at">ymin =</span> value <span class="sc">-</span></span>
<span id="cb308-14"><a href="ggplot2.html#cb308-14" aria-hidden="true" tabindex="-1"></a>  ci, <span class="at">ymax =</span> value <span class="sc">+</span> ci)) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">21</span>, <span class="at">size =</span> <span class="dv">3</span>,</span>
<span id="cb308-15"><a href="ggplot2.html#cb308-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">fill =</span> <span class="st">&quot;white&quot;</span>) <span class="sc">+</span> <span class="fu">ylim</span>(<span class="dv">40</span>, <span class="dv">60</span>)</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-267-1.png" width="672" style="display: block; margin: auto;" /></p>
<p><code>value</code> 和 <code>value_norm</code> 列代表了未标准化和标准化后的值。</p>
</div>
<div id="理解组内变量的误差线" class="section level4" number="9.2.2.6">
<h4><span class="header-section-number">9.2.2.6</span> 理解组内变量的误差线</h4>
<p>这部分解释组内的误差线值是如何计算出来的。这些步骤仅作解释目的；它们对于绘制误差线是<strong>非必需</strong>的。</p>
<p>下面独立数据的图形结果展示了组内变量 <code>condition</code> 存在连续一致的趋势，但使用常规的标准误（或者置信区间）则不能充分地展示这一点。Morey (2008) 和Cousineau (2005) 的方法本质是标准化数据去移除组间的变化，计算出这个标准化数据的变异程度。</p>
<div class="sourceCode" id="cb309"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb309-1"><a href="ggplot2.html#cb309-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 使用一致的 y 轴范围</span></span>
<span id="cb309-2"><a href="ggplot2.html#cb309-2" aria-hidden="true" tabindex="-1"></a>ymax <span class="ot">&lt;-</span> <span class="fu">max</span>(dfw_long<span class="sc">$</span>value)</span>
<span id="cb309-3"><a href="ggplot2.html#cb309-3" aria-hidden="true" tabindex="-1"></a>ymin <span class="ot">&lt;-</span> <span class="fu">min</span>(dfw_long<span class="sc">$</span>value)</span>
<span id="cb309-4"><a href="ggplot2.html#cb309-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb309-5"><a href="ggplot2.html#cb309-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 绘制个体数据</span></span>
<span id="cb309-6"><a href="ggplot2.html#cb309-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dfw_long, <span class="fu">aes</span>(<span class="at">x =</span> condition, <span class="at">y =</span> value, <span class="at">colour =</span> subject,</span>
<span id="cb309-7"><a href="ggplot2.html#cb309-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">group =</span> subject)) <span class="sc">+</span> <span class="fu">geom_line</span>() <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">21</span>,</span>
<span id="cb309-8"><a href="ggplot2.html#cb309-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">fill =</span> <span class="st">&quot;white&quot;</span>) <span class="sc">+</span> <span class="fu">ylim</span>(ymin, ymax)</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-268-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb310"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb310-1"><a href="ggplot2.html#cb310-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb310-2"><a href="ggplot2.html#cb310-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 创造标准化的版本</span></span>
<span id="cb310-3"><a href="ggplot2.html#cb310-3" aria-hidden="true" tabindex="-1"></a>dfwNorm.long <span class="ot">&lt;-</span> <span class="fu">normDataWithin</span>(<span class="at">data =</span> dfw_long, <span class="at">idvar =</span> <span class="st">&quot;subject&quot;</span>,</span>
<span id="cb310-4"><a href="ggplot2.html#cb310-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">measurevar =</span> <span class="st">&quot;value&quot;</span>)</span>
<span id="cb310-5"><a href="ggplot2.html#cb310-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb310-6"><a href="ggplot2.html#cb310-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 绘制标准化的个体数据</span></span>
<span id="cb310-7"><a href="ggplot2.html#cb310-7" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dfwNorm.long, <span class="fu">aes</span>(<span class="at">x =</span> condition, <span class="at">y =</span> value_norm,</span>
<span id="cb310-8"><a href="ggplot2.html#cb310-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">colour =</span> subject, <span class="at">group =</span> subject)) <span class="sc">+</span> <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb310-9"><a href="ggplot2.html#cb310-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">21</span>, <span class="at">fill =</span> <span class="st">&quot;white&quot;</span>) <span class="sc">+</span> <span class="fu">ylim</span>(ymin,</span>
<span id="cb310-10"><a href="ggplot2.html#cb310-10" aria-hidden="true" tabindex="-1"></a>  ymax)</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-268-2.png" width="672" style="display: block; margin: auto;" /></p>
<p>针对正常（组间）方法和组内方法的误差线差异在下面呈现。正常的方法计算出的误差线用红色表示，组内方法的误差线用黑色表示。</p>
<div class="sourceCode" id="cb311"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb311-1"><a href="ggplot2.html#cb311-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Instead of summarySEwithin, use summarySE, which</span></span>
<span id="cb311-2"><a href="ggplot2.html#cb311-2" aria-hidden="true" tabindex="-1"></a><span class="co"># treats condition as though it were a</span></span>
<span id="cb311-3"><a href="ggplot2.html#cb311-3" aria-hidden="true" tabindex="-1"></a><span class="co"># between-subjects variable</span></span>
<span id="cb311-4"><a href="ggplot2.html#cb311-4" aria-hidden="true" tabindex="-1"></a>dfwc_between <span class="ot">&lt;-</span> <span class="fu">summarySE</span>(<span class="at">data =</span> dfw_long, <span class="at">measurevar =</span> <span class="st">&quot;value&quot;</span>,</span>
<span id="cb311-5"><a href="ggplot2.html#cb311-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">groupvars =</span> <span class="st">&quot;condition&quot;</span>, <span class="at">na.rm =</span> <span class="cn">FALSE</span>, <span class="at">conf.interval =</span> <span class="fl">0.95</span>)</span>
<span id="cb311-6"><a href="ggplot2.html#cb311-6" aria-hidden="true" tabindex="-1"></a>dfwc_between</span>
<span id="cb311-7"><a href="ggplot2.html#cb311-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   condition  N value    sd    se    ci</span></span>
<span id="cb311-8"><a href="ggplot2.html#cb311-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1   pretest 10 47.74 8.599 2.719 6.151</span></span>
<span id="cb311-9"><a href="ggplot2.html#cb311-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2  posttest 10 51.43 7.254 2.294 5.189</span></span>
<span id="cb311-10"><a href="ggplot2.html#cb311-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb311-11"><a href="ggplot2.html#cb311-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 用红色显示组间的置信区间，用黑色展示组内的置信区间</span></span>
<span id="cb311-12"><a href="ggplot2.html#cb311-12" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dfwc_between, <span class="fu">aes</span>(<span class="at">x =</span> condition, <span class="at">y =</span> value, <span class="at">group =</span> <span class="dv">1</span>)) <span class="sc">+</span></span>
<span id="cb311-13"><a href="ggplot2.html#cb311-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span> <span class="fu">geom_errorbar</span>(<span class="at">width =</span> <span class="fl">0.1</span>, <span class="fu">aes</span>(<span class="at">ymin =</span> value <span class="sc">-</span></span>
<span id="cb311-14"><a href="ggplot2.html#cb311-14" aria-hidden="true" tabindex="-1"></a>  ci, <span class="at">ymax =</span> value <span class="sc">+</span> ci), <span class="at">colour =</span> <span class="st">&quot;red&quot;</span>) <span class="sc">+</span> <span class="fu">geom_errorbar</span>(<span class="at">width =</span> <span class="fl">0.1</span>,</span>
<span id="cb311-15"><a href="ggplot2.html#cb311-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">ymin =</span> value <span class="sc">-</span> ci, <span class="at">ymax =</span> value <span class="sc">+</span> ci), <span class="at">data =</span> dfwc) <span class="sc">+</span></span>
<span id="cb311-16"><a href="ggplot2.html#cb311-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">21</span>, <span class="at">size =</span> <span class="dv">3</span>, <span class="at">fill =</span> <span class="st">&quot;white&quot;</span>) <span class="sc">+</span> <span class="fu">ylim</span>(ymin,</span>
<span id="cb311-17"><a href="ggplot2.html#cb311-17" aria-hidden="true" tabindex="-1"></a>  ymax)</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-269-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="两个组内变量" class="section level4" number="9.2.2.7">
<h4><span class="header-section-number">9.2.2.7</span> 两个组内变量</h4>
<p>如果存在超过一个的组内变量，我们可以使用相同的函数 <code>summarySEwithin</code>。下面的数据集来自 <a href="http://books.google.com/books?id=zSi2AAAAIAAJ">Hays (1994)</a>，在 <a href="http://www.jstor.org/pss/40064075">Rouder and Morey (2005)</a> 中用来绘制这类的组内误差线。</p>
<div class="sourceCode" id="cb312"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb312-1"><a href="ggplot2.html#cb312-1" aria-hidden="true" tabindex="-1"></a>data <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="at">header =</span> <span class="cn">TRUE</span>, <span class="at">text =</span> <span class="st">&quot;</span></span>
<span id="cb312-2"><a href="ggplot2.html#cb312-2" aria-hidden="true" tabindex="-1"></a><span class="st"> Subject RoundMono SquareMono RoundColor SquareColor</span></span>
<span id="cb312-3"><a href="ggplot2.html#cb312-3" aria-hidden="true" tabindex="-1"></a><span class="st">       1        41         40         41          37</span></span>
<span id="cb312-4"><a href="ggplot2.html#cb312-4" aria-hidden="true" tabindex="-1"></a><span class="st">       2        57         56         56          53</span></span>
<span id="cb312-5"><a href="ggplot2.html#cb312-5" aria-hidden="true" tabindex="-1"></a><span class="st">       3        52         53         53          50</span></span>
<span id="cb312-6"><a href="ggplot2.html#cb312-6" aria-hidden="true" tabindex="-1"></a><span class="st">       4        49         47         47          47</span></span>
<span id="cb312-7"><a href="ggplot2.html#cb312-7" aria-hidden="true" tabindex="-1"></a><span class="st">       5        47         48         48          47</span></span>
<span id="cb312-8"><a href="ggplot2.html#cb312-8" aria-hidden="true" tabindex="-1"></a><span class="st">       6        37         34         35          36</span></span>
<span id="cb312-9"><a href="ggplot2.html#cb312-9" aria-hidden="true" tabindex="-1"></a><span class="st">       7        47         50         47          46</span></span>
<span id="cb312-10"><a href="ggplot2.html#cb312-10" aria-hidden="true" tabindex="-1"></a><span class="st">       8        41         40         38          40</span></span>
<span id="cb312-11"><a href="ggplot2.html#cb312-11" aria-hidden="true" tabindex="-1"></a><span class="st">       9        48         47         49          45</span></span>
<span id="cb312-12"><a href="ggplot2.html#cb312-12" aria-hidden="true" tabindex="-1"></a><span class="st">      10        37         35         36          35</span></span>
<span id="cb312-13"><a href="ggplot2.html#cb312-13" aria-hidden="true" tabindex="-1"></a><span class="st">      11        32         31         31          33</span></span>
<span id="cb312-14"><a href="ggplot2.html#cb312-14" aria-hidden="true" tabindex="-1"></a><span class="st">      12        47         42         42          42</span></span>
<span id="cb312-15"><a href="ggplot2.html#cb312-15" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span>)</span></code></pre></div>
<p>数据集首先必须转换为长格式，列名显示了两个变量： 形状 (圆形/方形) 和配色方案 (黑白/有色)。</p>
<div class="sourceCode" id="cb313"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb313-1"><a href="ggplot2.html#cb313-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 转换为长格式</span></span>
<span id="cb313-2"><a href="ggplot2.html#cb313-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reshape2)</span>
<span id="cb313-3"><a href="ggplot2.html#cb313-3" aria-hidden="true" tabindex="-1"></a>data_long <span class="ot">&lt;-</span> <span class="fu">melt</span>(<span class="at">data =</span> data, <span class="at">id.var =</span> <span class="st">&quot;Subject&quot;</span>, <span class="at">measure.vars =</span> <span class="fu">c</span>(<span class="st">&quot;RoundMono&quot;</span>,</span>
<span id="cb313-4"><a href="ggplot2.html#cb313-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;SquareMono&quot;</span>, <span class="st">&quot;RoundColor&quot;</span>, <span class="st">&quot;SquareColor&quot;</span>), <span class="at">variable.name =</span> <span class="st">&quot;Condition&quot;</span>)</span>
<span id="cb313-5"><a href="ggplot2.html#cb313-5" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(data_long)[<span class="fu">names</span>(data_long) <span class="sc">==</span> <span class="st">&quot;value&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Time&quot;</span></span>
<span id="cb313-6"><a href="ggplot2.html#cb313-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb313-7"><a href="ggplot2.html#cb313-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 拆分 Condition 列为 Shape 和 ColorScheme</span></span>
<span id="cb313-8"><a href="ggplot2.html#cb313-8" aria-hidden="true" tabindex="-1"></a>data_long<span class="sc">$</span>Shape <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb313-9"><a href="ggplot2.html#cb313-9" aria-hidden="true" tabindex="-1"></a>data_long<span class="sc">$</span>Shape[<span class="fu">grepl</span>(<span class="st">&quot;^Round&quot;</span>, data_long<span class="sc">$</span>Condition)] <span class="ot">&lt;-</span> <span class="st">&quot;Round&quot;</span></span>
<span id="cb313-10"><a href="ggplot2.html#cb313-10" aria-hidden="true" tabindex="-1"></a>data_long<span class="sc">$</span>Shape[<span class="fu">grepl</span>(<span class="st">&quot;^Square&quot;</span>, data_long<span class="sc">$</span>Condition)] <span class="ot">&lt;-</span> <span class="st">&quot;Square&quot;</span></span>
<span id="cb313-11"><a href="ggplot2.html#cb313-11" aria-hidden="true" tabindex="-1"></a>data_long<span class="sc">$</span>Shape <span class="ot">&lt;-</span> <span class="fu">factor</span>(data_long<span class="sc">$</span>Shape)</span>
<span id="cb313-12"><a href="ggplot2.html#cb313-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb313-13"><a href="ggplot2.html#cb313-13" aria-hidden="true" tabindex="-1"></a>data_long<span class="sc">$</span>ColorScheme <span class="ot">&lt;-</span> <span class="cn">NA</span></span>
<span id="cb313-14"><a href="ggplot2.html#cb313-14" aria-hidden="true" tabindex="-1"></a>data_long<span class="sc">$</span>ColorScheme[<span class="fu">grepl</span>(<span class="st">&quot;Mono$&quot;</span>, data_long<span class="sc">$</span>Condition)] <span class="ot">&lt;-</span> <span class="st">&quot;Monochromatic&quot;</span></span>
<span id="cb313-15"><a href="ggplot2.html#cb313-15" aria-hidden="true" tabindex="-1"></a>data_long<span class="sc">$</span>ColorScheme[<span class="fu">grepl</span>(<span class="st">&quot;Color$&quot;</span>, data_long<span class="sc">$</span>Condition)] <span class="ot">&lt;-</span> <span class="st">&quot;Colored&quot;</span></span>
<span id="cb313-16"><a href="ggplot2.html#cb313-16" aria-hidden="true" tabindex="-1"></a>data_long<span class="sc">$</span>ColorScheme <span class="ot">&lt;-</span> <span class="fu">factor</span>(data_long<span class="sc">$</span>ColorScheme, <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;Monochromatic&quot;</span>,</span>
<span id="cb313-17"><a href="ggplot2.html#cb313-17" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Colored&quot;</span>))</span>
<span id="cb313-18"><a href="ggplot2.html#cb313-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb313-19"><a href="ggplot2.html#cb313-19" aria-hidden="true" tabindex="-1"></a><span class="co"># 删除 Condition 列</span></span>
<span id="cb313-20"><a href="ggplot2.html#cb313-20" aria-hidden="true" tabindex="-1"></a>data_long<span class="sc">$</span>Condition <span class="ot">&lt;-</span> <span class="cn">NULL</span></span>
<span id="cb313-21"><a href="ggplot2.html#cb313-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb313-22"><a href="ggplot2.html#cb313-22" aria-hidden="true" tabindex="-1"></a><span class="co"># 检查数据</span></span>
<span id="cb313-23"><a href="ggplot2.html#cb313-23" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(data_long)</span>
<span id="cb313-24"><a href="ggplot2.html#cb313-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   Subject Time Shape   ColorScheme</span></span>
<span id="cb313-25"><a href="ggplot2.html#cb313-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1       1   41 Round Monochromatic</span></span>
<span id="cb313-26"><a href="ggplot2.html#cb313-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2       2   57 Round Monochromatic</span></span>
<span id="cb313-27"><a href="ggplot2.html#cb313-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3       3   52 Round Monochromatic</span></span>
<span id="cb313-28"><a href="ggplot2.html#cb313-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4       4   49 Round Monochromatic</span></span>
<span id="cb313-29"><a href="ggplot2.html#cb313-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5       5   47 Round Monochromatic</span></span>
<span id="cb313-30"><a href="ggplot2.html#cb313-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6       6   37 Round Monochromatic</span></span></code></pre></div>
<p>现在可以进行统计汇总和绘图了。</p>
<div class="sourceCode" id="cb314"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb314-1"><a href="ggplot2.html#cb314-1" aria-hidden="true" tabindex="-1"></a>datac <span class="ot">&lt;-</span> <span class="fu">summarySEwithin</span>(data_long, <span class="at">measurevar =</span> <span class="st">&quot;Time&quot;</span>,</span>
<span id="cb314-2"><a href="ggplot2.html#cb314-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">withinvars =</span> <span class="fu">c</span>(<span class="st">&quot;Shape&quot;</span>, <span class="st">&quot;ColorScheme&quot;</span>), <span class="at">idvar =</span> <span class="st">&quot;Subject&quot;</span>)</span>
<span id="cb314-3"><a href="ggplot2.html#cb314-3" aria-hidden="true" tabindex="-1"></a>datac</span>
<span id="cb314-4"><a href="ggplot2.html#cb314-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;    Shape   ColorScheme  N  Time Time_norm    sd     se</span></span>
<span id="cb314-5"><a href="ggplot2.html#cb314-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1  Round       Colored 12 43.58     43.58 1.212 0.3500</span></span>
<span id="cb314-6"><a href="ggplot2.html#cb314-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2  Round Monochromatic 12 44.58     44.58 1.331 0.3844</span></span>
<span id="cb314-7"><a href="ggplot2.html#cb314-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 Square       Colored 12 42.58     42.58 1.462 0.4219</span></span>
<span id="cb314-8"><a href="ggplot2.html#cb314-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 Square Monochromatic 12 43.58     43.58 1.261 0.3641</span></span>
<span id="cb314-9"><a href="ggplot2.html#cb314-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;       ci</span></span>
<span id="cb314-10"><a href="ggplot2.html#cb314-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 0.7703</span></span>
<span id="cb314-11"><a href="ggplot2.html#cb314-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 0.8460</span></span>
<span id="cb314-12"><a href="ggplot2.html#cb314-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3 0.9287</span></span>
<span id="cb314-13"><a href="ggplot2.html#cb314-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 0.8014</span></span>
<span id="cb314-14"><a href="ggplot2.html#cb314-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb314-15"><a href="ggplot2.html#cb314-15" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb314-16"><a href="ggplot2.html#cb314-16" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(datac, <span class="fu">aes</span>(<span class="at">x =</span> Shape, <span class="at">y =</span> Time, <span class="at">fill =</span> ColorScheme)) <span class="sc">+</span></span>
<span id="cb314-17"><a href="ggplot2.html#cb314-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="fl">0.9</span>), <span class="at">colour =</span> <span class="st">&quot;black&quot;</span>,</span>
<span id="cb314-18"><a href="ggplot2.html#cb314-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="sc">+</span> <span class="fu">geom_errorbar</span>(<span class="at">position =</span> <span class="fu">position_dodge</span>(<span class="fl">0.9</span>),</span>
<span id="cb314-19"><a href="ggplot2.html#cb314-19" aria-hidden="true" tabindex="-1"></a>  <span class="at">width =</span> <span class="fl">0.25</span>, <span class="fu">aes</span>(<span class="at">ymin =</span> Time <span class="sc">-</span> ci, <span class="at">ymax =</span> Time <span class="sc">+</span> ci)) <span class="sc">+</span></span>
<span id="cb314-20"><a href="ggplot2.html#cb314-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">40</span>, <span class="dv">46</span>)) <span class="sc">+</span> <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;#CCCCCC&quot;</span>,</span>
<span id="cb314-21"><a href="ggplot2.html#cb314-21" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;#FFFFFF&quot;</span>)) <span class="sc">+</span> <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">100</span>)) <span class="sc">+</span></span>
<span id="cb314-22"><a href="ggplot2.html#cb314-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span> <span class="fu">geom_hline</span>(<span class="at">yintercept =</span> <span class="dv">38</span>)</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-272-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="注意标准化的均值" class="section level4" number="9.2.2.8">
<h4><span class="header-section-number">9.2.2.8</span> 注意标准化的均值</h4>
<p>函数 <code>summarySEWithin()</code> 返回标准化和未标准化的均值。未标准化的均值只是简单地表示每组的均值。标准化的均值计算出来保证组间的均值是一样的。</p>
<p>比如：</p>
<div class="sourceCode" id="cb315"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb315-1"><a href="ggplot2.html#cb315-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="at">header =</span> <span class="cn">TRUE</span>, <span class="at">text =</span> <span class="st">&quot;</span></span>
<span id="cb315-2"><a href="ggplot2.html#cb315-2" aria-hidden="true" tabindex="-1"></a><span class="st">id trial gender dv</span></span>
<span id="cb315-3"><a href="ggplot2.html#cb315-3" aria-hidden="true" tabindex="-1"></a><span class="st"> A     0   male  2</span></span>
<span id="cb315-4"><a href="ggplot2.html#cb315-4" aria-hidden="true" tabindex="-1"></a><span class="st"> A     1   male  4</span></span>
<span id="cb315-5"><a href="ggplot2.html#cb315-5" aria-hidden="true" tabindex="-1"></a><span class="st"> B     0   male  6</span></span>
<span id="cb315-6"><a href="ggplot2.html#cb315-6" aria-hidden="true" tabindex="-1"></a><span class="st"> B     1   male  8</span></span>
<span id="cb315-7"><a href="ggplot2.html#cb315-7" aria-hidden="true" tabindex="-1"></a><span class="st"> C     0 female 22</span></span>
<span id="cb315-8"><a href="ggplot2.html#cb315-8" aria-hidden="true" tabindex="-1"></a><span class="st"> C     1 female 24</span></span>
<span id="cb315-9"><a href="ggplot2.html#cb315-9" aria-hidden="true" tabindex="-1"></a><span class="st"> D     0 female 26</span></span>
<span id="cb315-10"><a href="ggplot2.html#cb315-10" aria-hidden="true" tabindex="-1"></a><span class="st"> D     1 female 28</span></span>
<span id="cb315-11"><a href="ggplot2.html#cb315-11" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span>)</span>
<span id="cb315-12"><a href="ggplot2.html#cb315-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb315-13"><a href="ggplot2.html#cb315-13" aria-hidden="true" tabindex="-1"></a><span class="co"># 标准化和未标准化的均值是不同的</span></span>
<span id="cb315-14"><a href="ggplot2.html#cb315-14" aria-hidden="true" tabindex="-1"></a><span class="fu">summarySEwithin</span>(dat, <span class="at">measurevar =</span> <span class="st">&quot;dv&quot;</span>, <span class="at">withinvars =</span> <span class="st">&quot;trial&quot;</span>,</span>
<span id="cb315-15"><a href="ggplot2.html#cb315-15" aria-hidden="true" tabindex="-1"></a>  <span class="at">betweenvars =</span> <span class="st">&quot;gender&quot;</span>, <span class="at">idvar =</span> <span class="st">&quot;id&quot;</span>)</span>
<span id="cb315-16"><a href="ggplot2.html#cb315-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Automatically converting the following non-factors to factors: gender, trial</span></span>
<span id="cb315-17"><a href="ggplot2.html#cb315-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   gender trial N dv dv_norm sd se ci</span></span>
<span id="cb315-18"><a href="ggplot2.html#cb315-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1 female     0 2 24      14  0  0  0</span></span>
<span id="cb315-19"><a href="ggplot2.html#cb315-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 female     1 2 26      16  0  0  0</span></span>
<span id="cb315-20"><a href="ggplot2.html#cb315-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3   male     0 2  4      14  0  0  0</span></span>
<span id="cb315-21"><a href="ggplot2.html#cb315-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4   male     1 2  6      16  0  0  0</span></span></code></pre></div>
</div>
</div>
<div id="其他-1" class="section level3" number="9.2.3">
<h3><span class="header-section-number">9.2.3</span> 其他</h3>
<p>解决问题的方法不止作者提供的这一种，为了理解 <strong>ggplot2</strong> 是如何进行误差线的计算和添加，我在 stackoverflow 上提交了一个关于 <a href="https://stackoverflow.com/questions/46192556/errorbar-in-ggplot-is-using-sd-or-se-as-default">ggplot2 使用 SE 还是 SD 作为默认误差线的问题</a>。有人就给出了快速简易的解答。回答者的共同观点是必须先进行数据的统计计算。我之前在其他博客上看到使用 <code>stat_boxplot(geom="errorbar", width=.3)</code> 直接计算误差线可能就有问题（难以解释它算的是 SD 还是 SE）。</p>
</div>
</div>
<div id="分布图" class="section level2" number="9.3">
<h2><span class="header-section-number">9.3</span> 分布图</h2>
<div id="问题-55" class="section level3" number="9.3.1">
<h3><span class="header-section-number">9.3.1</span> 问题</h3>
<p>你想要绘制一组数据的分布图。</p>
</div>
<div id="方案-54" class="section level3" number="9.3.2">
<h3><span class="header-section-number">9.3.2</span> 方案</h3>
<p>后面的例子中会使用以下这组简单的数据：</p>
<div class="sourceCode" id="cb316"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb316-1"><a href="ggplot2.html#cb316-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb316-2"><a href="ggplot2.html#cb316-2" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">cond =</span> <span class="fu">factor</span>(<span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>), <span class="at">each =</span> <span class="dv">200</span>)),</span>
<span id="cb316-3"><a href="ggplot2.html#cb316-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">rating =</span> <span class="fu">c</span>(<span class="fu">rnorm</span>(<span class="dv">200</span>), <span class="fu">rnorm</span>(<span class="dv">200</span>, <span class="at">mean =</span> <span class="fl">0.8</span>)))</span>
<span id="cb316-4"><a href="ggplot2.html#cb316-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 查看数据</span></span>
<span id="cb316-5"><a href="ggplot2.html#cb316-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dat)</span>
<span id="cb316-6"><a href="ggplot2.html#cb316-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   cond  rating</span></span>
<span id="cb316-7"><a href="ggplot2.html#cb316-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1    A -1.2071</span></span>
<span id="cb316-8"><a href="ggplot2.html#cb316-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2    A  0.2774</span></span>
<span id="cb316-9"><a href="ggplot2.html#cb316-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3    A  1.0844</span></span>
<span id="cb316-10"><a href="ggplot2.html#cb316-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4    A -2.3457</span></span>
<span id="cb316-11"><a href="ggplot2.html#cb316-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5    A  0.4291</span></span>
<span id="cb316-12"><a href="ggplot2.html#cb316-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6    A  0.5061</span></span>
<span id="cb316-13"><a href="ggplot2.html#cb316-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb316-14"><a href="ggplot2.html#cb316-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span></code></pre></div>
<div id="直方图和概率密度图" class="section level4" number="9.3.2.1">
<h4><span class="header-section-number">9.3.2.1</span> 直方图和概率密度图</h4>
<p><code>qplot()</code> 函数能够用更简单的语法绘制出与 <code>ggplot()</code> 相同的图像。然而，在实践过程中你会发现 <code>ggplot()</code> 是更好的选择，因为 <code>qplot()</code> 中很多参数的选项都会让人感到困惑。</p>
<div class="sourceCode" id="cb317"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb317-1"><a href="ggplot2.html#cb317-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 以 rating 为横轴绘制直方图，组距设为 0.5</span></span>
<span id="cb317-2"><a href="ggplot2.html#cb317-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 两种函数都可以绘制出相同的图:</span></span>
<span id="cb317-3"><a href="ggplot2.html#cb317-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat, <span class="fu">aes</span>(<span class="at">x=</span>rating)) <span class="sc">+</span> <span class="fu">geom_histogram</span>(<span class="at">binwidth=</span>.<span class="dv">5</span>)</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-275-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb318"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb318-1"><a href="ggplot2.html#cb318-1" aria-hidden="true" tabindex="-1"></a><span class="co"># qplot(dat$rating, binwidth=.5)</span></span>
<span id="cb318-2"><a href="ggplot2.html#cb318-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 绘制黑色边线，白色填充的图</span></span>
<span id="cb318-3"><a href="ggplot2.html#cb318-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat, <span class="fu">aes</span>(<span class="at">x=</span>rating)) <span class="sc">+</span></span>
<span id="cb318-4"><a href="ggplot2.html#cb318-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_histogram</span>(<span class="at">binwidth=</span>.<span class="dv">5</span>, <span class="at">colour=</span><span class="st">&quot;black&quot;</span>, <span class="at">fill=</span><span class="st">&quot;white&quot;</span>)</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-275-2.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb319"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb319-1"><a href="ggplot2.html#cb319-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 密度曲线</span></span>
<span id="cb319-2"><a href="ggplot2.html#cb319-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat, <span class="fu">aes</span>(<span class="at">x=</span>rating)) <span class="sc">+</span> <span class="fu">geom_density</span>()</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-275-3.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb320"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb320-1"><a href="ggplot2.html#cb320-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 直方图与核密度曲线重叠</span></span>
<span id="cb320-2"><a href="ggplot2.html#cb320-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat, <span class="fu">aes</span>(<span class="at">x=</span>rating)) <span class="sc">+</span> </span>
<span id="cb320-3"><a href="ggplot2.html#cb320-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(<span class="at">y=</span>..density..),      <span class="co"># 这里直方图以 density (密度)为y轴</span></span>
<span id="cb320-4"><a href="ggplot2.html#cb320-4" aria-hidden="true" tabindex="-1"></a>                   <span class="at">binwidth=</span>.<span class="dv">5</span>,</span>
<span id="cb320-5"><a href="ggplot2.html#cb320-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">colour=</span><span class="st">&quot;black&quot;</span>, <span class="at">fill=</span><span class="st">&quot;white&quot;</span>) <span class="sc">+</span></span>
<span id="cb320-6"><a href="ggplot2.html#cb320-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_density</span>(<span class="at">alpha=</span>.<span class="dv">2</span>, <span class="at">fill=</span><span class="st">&quot;#FF6666&quot;</span>)  <span class="co"># 重合部分透明填充</span></span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-275-4.png" width="672" style="display: block; margin: auto;" /></p>
<p>添加一条均值线：</p>
<div class="sourceCode" id="cb321"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb321-1"><a href="ggplot2.html#cb321-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat, <span class="fu">aes</span>(<span class="at">x=</span>rating)) <span class="sc">+</span></span>
<span id="cb321-2"><a href="ggplot2.html#cb321-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_histogram</span>(<span class="at">binwidth=</span>.<span class="dv">5</span>, <span class="at">colour=</span><span class="st">&quot;black&quot;</span>, <span class="at">fill=</span><span class="st">&quot;white&quot;</span>) <span class="sc">+</span></span>
<span id="cb321-3"><a href="ggplot2.html#cb321-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_vline</span>(<span class="fu">aes</span>(<span class="at">xintercept=</span><span class="fu">mean</span>(rating, <span class="at">na.rm=</span>T)),   <span class="co"># 忽略缺失值</span></span>
<span id="cb321-4"><a href="ggplot2.html#cb321-4" aria-hidden="true" tabindex="-1"></a>               <span class="at">color=</span><span class="st">&quot;red&quot;</span>, <span class="at">linetype=</span><span class="st">&quot;dashed&quot;</span>, <span class="at">size=</span><span class="dv">1</span>)</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-276-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="多组数据的直方图和概率密度图" class="section level4" number="9.3.2.2">
<h4><span class="header-section-number">9.3.2.2</span> 多组数据的直方图和概率密度图</h4>
<div class="sourceCode" id="cb322"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb322-1"><a href="ggplot2.html#cb322-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 重叠直方图</span></span>
<span id="cb322-2"><a href="ggplot2.html#cb322-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat, <span class="fu">aes</span>(<span class="at">x =</span> rating, <span class="at">fill =</span> cond)) <span class="sc">+</span> <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="fl">0.5</span>,</span>
<span id="cb322-3"><a href="ggplot2.html#cb322-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">position =</span> <span class="st">&quot;identity&quot;</span>)  <span class="co"># identity 表示将每个对象直接显示在图中，条形会彼此重叠。</span></span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-277-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb323"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb323-1"><a href="ggplot2.html#cb323-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 间隔直方图</span></span>
<span id="cb323-2"><a href="ggplot2.html#cb323-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat, <span class="fu">aes</span>(<span class="at">x =</span> rating, <span class="at">fill =</span> cond)) <span class="sc">+</span> <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="fl">0.5</span>,</span>
<span id="cb323-3"><a href="ggplot2.html#cb323-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">position =</span> <span class="st">&quot;dodge&quot;</span>)  <span class="co"># dodge 表示将每组的条形依次并列放置。</span></span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-277-2.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb324"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb324-1"><a href="ggplot2.html#cb324-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 密度图</span></span>
<span id="cb324-2"><a href="ggplot2.html#cb324-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat, <span class="fu">aes</span>(<span class="at">x =</span> rating, <span class="at">colour =</span> cond)) <span class="sc">+</span> <span class="fu">geom_density</span>()</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-277-3.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb325"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb325-1"><a href="ggplot2.html#cb325-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 半透明填充的密度图</span></span>
<span id="cb325-2"><a href="ggplot2.html#cb325-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat, <span class="fu">aes</span>(<span class="at">x =</span> rating, <span class="at">fill =</span> cond)) <span class="sc">+</span> <span class="fu">geom_density</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>)</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-277-4.png" width="672" style="display: block; margin: auto;" /></p>
<p>在给每组数据添加均值线前，需要将每组数据的平均值赋值到一个新的数据框。</p>
<div class="sourceCode" id="cb326"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb326-1"><a href="ggplot2.html#cb326-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 求均值</span></span>
<span id="cb326-2"><a href="ggplot2.html#cb326-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(plyr)</span>
<span id="cb326-3"><a href="ggplot2.html#cb326-3" aria-hidden="true" tabindex="-1"></a>cdat <span class="ot">&lt;-</span> <span class="fu">ddply</span>(dat, <span class="st">&quot;cond&quot;</span>, summarise, <span class="at">rating.mean =</span> <span class="fu">mean</span>(rating))</span>
<span id="cb326-4"><a href="ggplot2.html#cb326-4" aria-hidden="true" tabindex="-1"></a>cdat</span>
<span id="cb326-5"><a href="ggplot2.html#cb326-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   cond rating.mean</span></span>
<span id="cb326-6"><a href="ggplot2.html#cb326-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1    A    -0.05776</span></span>
<span id="cb326-7"><a href="ggplot2.html#cb326-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2    B     0.87325</span></span>
<span id="cb326-8"><a href="ggplot2.html#cb326-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb326-9"><a href="ggplot2.html#cb326-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 给重叠直方图添加均值线</span></span>
<span id="cb326-10"><a href="ggplot2.html#cb326-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat, <span class="fu">aes</span>(<span class="at">x =</span> rating, <span class="at">fill =</span> cond)) <span class="sc">+</span> <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="fl">0.5</span>,</span>
<span id="cb326-11"><a href="ggplot2.html#cb326-11" aria-hidden="true" tabindex="-1"></a>  <span class="at">alpha =</span> <span class="fl">0.5</span>, <span class="at">position =</span> <span class="st">&quot;identity&quot;</span>) <span class="sc">+</span> <span class="fu">geom_vline</span>(<span class="at">data =</span> cdat,</span>
<span id="cb326-12"><a href="ggplot2.html#cb326-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">aes</span>(<span class="at">xintercept =</span> rating.mean, <span class="at">colour =</span> cond), <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>,</span>
<span id="cb326-13"><a href="ggplot2.html#cb326-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">size =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-278-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb327"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb327-1"><a href="ggplot2.html#cb327-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 给密度图添加均值线</span></span>
<span id="cb327-2"><a href="ggplot2.html#cb327-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat, <span class="fu">aes</span>(<span class="at">x =</span> rating, <span class="at">colour =</span> cond)) <span class="sc">+</span> <span class="fu">geom_density</span>() <span class="sc">+</span></span>
<span id="cb327-3"><a href="ggplot2.html#cb327-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">data =</span> cdat, <span class="fu">aes</span>(<span class="at">xintercept =</span> rating.mean,</span>
<span id="cb327-4"><a href="ggplot2.html#cb327-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">colour =</span> cond), <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>, <span class="at">size =</span> <span class="dv">1</span>)</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-278-2.png" width="672" style="display: block; margin: auto;" /></p>
<p>使用分面：</p>
<div class="sourceCode" id="cb328"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb328-1"><a href="ggplot2.html#cb328-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat, <span class="fu">aes</span>(<span class="at">x =</span> rating)) <span class="sc">+</span> <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="fl">0.5</span>,</span>
<span id="cb328-2"><a href="ggplot2.html#cb328-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">colour =</span> <span class="st">&quot;black&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;white&quot;</span>) <span class="sc">+</span> <span class="fu">facet_grid</span>(cond <span class="sc">~</span></span>
<span id="cb328-3"><a href="ggplot2.html#cb328-3" aria-hidden="true" tabindex="-1"></a>  .)</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-279-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb329"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb329-1"><a href="ggplot2.html#cb329-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 使用之前的 cdat 添加均值线</span></span>
<span id="cb329-2"><a href="ggplot2.html#cb329-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat, <span class="fu">aes</span>(<span class="at">x =</span> rating)) <span class="sc">+</span> <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="fl">0.5</span>,</span>
<span id="cb329-3"><a href="ggplot2.html#cb329-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">colour =</span> <span class="st">&quot;black&quot;</span>, <span class="at">fill =</span> <span class="st">&quot;white&quot;</span>) <span class="sc">+</span> <span class="fu">facet_grid</span>(cond <span class="sc">~</span></span>
<span id="cb329-4"><a href="ggplot2.html#cb329-4" aria-hidden="true" tabindex="-1"></a>  .) <span class="sc">+</span> <span class="fu">geom_vline</span>(<span class="at">data =</span> cdat, <span class="fu">aes</span>(<span class="at">xintercept =</span> rating.mean),</span>
<span id="cb329-5"><a href="ggplot2.html#cb329-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>, <span class="at">size =</span> <span class="dv">1</span>, <span class="at">colour =</span> <span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-279-2.png" width="672" style="display: block; margin: auto;" /></p>
<p>更多关于分面的细节可查看<a href="ggplot2.html#ggplot-facet">分面</a></p>
</div>
<div id="箱型图" class="section level4" number="9.3.2.3">
<h4><span class="header-section-number">9.3.2.3</span> 箱型图</h4>
<div class="sourceCode" id="cb330"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb330-1"><a href="ggplot2.html#cb330-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 绘制箱型图</span></span>
<span id="cb330-2"><a href="ggplot2.html#cb330-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat, <span class="fu">aes</span>(<span class="at">x =</span> cond, <span class="at">y =</span> rating)) <span class="sc">+</span> <span class="fu">geom_boxplot</span>()</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-280-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb331"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb331-1"><a href="ggplot2.html#cb331-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 对分组填充颜色</span></span>
<span id="cb331-2"><a href="ggplot2.html#cb331-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat, <span class="fu">aes</span>(<span class="at">x =</span> cond, <span class="at">y =</span> rating, <span class="at">fill =</span> cond)) <span class="sc">+</span> <span class="fu">geom_boxplot</span>()</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-280-2.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb332"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb332-1"><a href="ggplot2.html#cb332-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 将上图中冗余的图例删除掉：</span></span>
<span id="cb332-2"><a href="ggplot2.html#cb332-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat, <span class="fu">aes</span>(<span class="at">x =</span> cond, <span class="at">y =</span> rating, <span class="at">fill =</span> cond)) <span class="sc">+</span> <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb332-3"><a href="ggplot2.html#cb332-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="cn">FALSE</span>)</span>
<span id="cb332-4"><a href="ggplot2.html#cb332-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning: `guides(&lt;scale&gt; = FALSE)` is deprecated.</span></span>
<span id="cb332-5"><a href="ggplot2.html#cb332-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Please use `guides(&lt;scale&gt; = &quot;none&quot;)` instead.</span></span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-280-3.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb333"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb333-1"><a href="ggplot2.html#cb333-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 坐标轴翻转</span></span>
<span id="cb333-2"><a href="ggplot2.html#cb333-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat, <span class="fu">aes</span>(<span class="at">x =</span> cond, <span class="at">y =</span> rating, <span class="at">fill =</span> cond)) <span class="sc">+</span> <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb333-3"><a href="ggplot2.html#cb333-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">fill =</span> <span class="cn">FALSE</span>) <span class="sc">+</span> <span class="fu">coord_flip</span>()</span>
<span id="cb333-4"><a href="ggplot2.html#cb333-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning: `guides(&lt;scale&gt; = FALSE)` is deprecated.</span></span>
<span id="cb333-5"><a href="ggplot2.html#cb333-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Please use `guides(&lt;scale&gt; = &quot;none&quot;)` instead.</span></span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-280-4.png" width="672" style="display: block; margin: auto;" /></p>
<p>同时可以通过 <code>stat_summary()</code> 来添加平均值。</p>
<div class="sourceCode" id="cb334"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb334-1"><a href="ggplot2.html#cb334-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 用菱形图标指征平均值，并调整参数使该图标变更大。</span></span>
<span id="cb334-2"><a href="ggplot2.html#cb334-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat, <span class="fu">aes</span>(<span class="at">x =</span> cond, <span class="at">y =</span> rating)) <span class="sc">+</span> <span class="fu">geom_boxplot</span>() <span class="sc">+</span></span>
<span id="cb334-3"><a href="ggplot2.html#cb334-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">stat_summary</span>(<span class="at">fun.y =</span> mean, <span class="at">geom =</span> <span class="st">&quot;point&quot;</span>, <span class="at">shape =</span> <span class="dv">5</span>,</span>
<span id="cb334-4"><a href="ggplot2.html#cb334-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">size =</span> <span class="dv">4</span>)</span>
<span id="cb334-5"><a href="ggplot2.html#cb334-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning: `fun.y` is deprecated. Use `fun` instead.</span></span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-281-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
</div>
</div>
<div id="散点图-1" class="section level2" number="9.4">
<h2><span class="header-section-number">9.4</span> 散点图</h2>
<div id="问题-56" class="section level3" number="9.4.1">
<h3><span class="header-section-number">9.4.1</span> 问题</h3>
<p>你想要绘制一幅散点图。</p>
</div>
<div id="方案-55" class="section level3" number="9.4.2">
<h3><span class="header-section-number">9.4.2</span> 方案</h3>
<p>假设这是你的数据：</p>
<div class="sourceCode" id="cb335"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb335-1"><a href="ggplot2.html#cb335-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">955</span>)</span>
<span id="cb335-2"><a href="ggplot2.html#cb335-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 创建一些噪声数据</span></span>
<span id="cb335-3"><a href="ggplot2.html#cb335-3" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">cond =</span> <span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;A&quot;</span>, <span class="st">&quot;B&quot;</span>), <span class="at">each =</span> <span class="dv">10</span>), <span class="at">xvar =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span> <span class="sc">+</span></span>
<span id="cb335-4"><a href="ggplot2.html#cb335-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rnorm</span>(<span class="dv">20</span>, <span class="at">sd =</span> <span class="dv">3</span>), <span class="at">yvar =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">20</span> <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">20</span>, <span class="at">sd =</span> <span class="dv">3</span>))</span>
<span id="cb335-5"><a href="ggplot2.html#cb335-5" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(dat)</span>
<span id="cb335-6"><a href="ggplot2.html#cb335-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   cond   xvar     yvar</span></span>
<span id="cb335-7"><a href="ggplot2.html#cb335-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1    A -4.252  3.47316</span></span>
<span id="cb335-8"><a href="ggplot2.html#cb335-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2    A  1.702  0.00594</span></span>
<span id="cb335-9"><a href="ggplot2.html#cb335-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3    A  4.323 -0.09425</span></span>
<span id="cb335-10"><a href="ggplot2.html#cb335-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4    A  1.781  2.07281</span></span>
<span id="cb335-11"><a href="ggplot2.html#cb335-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5    A 11.537  1.21544</span></span>
<span id="cb335-12"><a href="ggplot2.html#cb335-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6    A  6.672  3.60811</span></span>
<span id="cb335-13"><a href="ggplot2.html#cb335-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb335-14"><a href="ggplot2.html#cb335-14" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span></code></pre></div>
<div id="带回归线的基本散点图" class="section level4" number="9.4.2.1">
<h4><span class="header-section-number">9.4.2.1</span> 带回归线的基本散点图</h4>
<div class="sourceCode" id="cb336"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb336-1"><a href="ggplot2.html#cb336-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat, <span class="fu">aes</span>(<span class="at">x=</span>xvar, <span class="at">y=</span>yvar)) <span class="sc">+</span></span>
<span id="cb336-2"><a href="ggplot2.html#cb336-2" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">shape=</span><span class="dv">1</span>)      <span class="co"># 使用空心圆</span></span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-283-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb337"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb337-1"><a href="ggplot2.html#cb337-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb337-2"><a href="ggplot2.html#cb337-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat, <span class="fu">aes</span>(<span class="at">x=</span>xvar, <span class="at">y=</span>yvar)) <span class="sc">+</span></span>
<span id="cb337-3"><a href="ggplot2.html#cb337-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">shape=</span><span class="dv">1</span>) <span class="sc">+</span>    <span class="co"># 使用空心圆</span></span>
<span id="cb337-4"><a href="ggplot2.html#cb337-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">method=</span>lm)   <span class="co"># 添加回归线</span></span>
<span id="cb337-5"><a href="ggplot2.html#cb337-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; `geom_smooth()` using formula &#39;y ~ x&#39;</span></span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-283-2.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb338"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb338-1"><a href="ggplot2.html#cb338-1" aria-hidden="true" tabindex="-1"></a>                             <span class="co"># (默认包含 95% 置信区间)</span></span>
<span id="cb338-2"><a href="ggplot2.html#cb338-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb338-3"><a href="ggplot2.html#cb338-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat, <span class="fu">aes</span>(<span class="at">x=</span>xvar, <span class="at">y=</span>yvar)) <span class="sc">+</span></span>
<span id="cb338-4"><a href="ggplot2.html#cb338-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">shape=</span><span class="dv">1</span>) <span class="sc">+</span>    <span class="co"># 使用空心圆</span></span>
<span id="cb338-5"><a href="ggplot2.html#cb338-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">method=</span>lm,   <span class="co"># 添加回归线</span></span>
<span id="cb338-6"><a href="ggplot2.html#cb338-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">se=</span><span class="cn">FALSE</span>)    <span class="co"># 不加置信区域</span></span>
<span id="cb338-7"><a href="ggplot2.html#cb338-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; `geom_smooth()` using formula &#39;y ~ x&#39;</span></span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-283-3.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb339"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb339-1"><a href="ggplot2.html#cb339-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb339-2"><a href="ggplot2.html#cb339-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb339-3"><a href="ggplot2.html#cb339-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat, <span class="fu">aes</span>(<span class="at">x=</span>xvar, <span class="at">y=</span>yvar)) <span class="sc">+</span></span>
<span id="cb339-4"><a href="ggplot2.html#cb339-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">shape=</span><span class="dv">1</span>) <span class="sc">+</span>    <span class="co"># 使用空心圆</span></span>
<span id="cb339-5"><a href="ggplot2.html#cb339-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>()            <span class="co"># 添加带置信区间的平滑拟合曲线</span></span>
<span id="cb339-6"><a href="ggplot2.html#cb339-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</span></span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-283-4.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="通过其他变量设置颜色和形状" class="section level4" number="9.4.2.2">
<h4><span class="header-section-number">9.4.2.2</span> 通过其他变量设置颜色和形状</h4>
<div class="sourceCode" id="cb340"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb340-1"><a href="ggplot2.html#cb340-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 根据 cond 设置颜色</span></span>
<span id="cb340-2"><a href="ggplot2.html#cb340-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat, <span class="fu">aes</span>(<span class="at">x=</span>xvar, <span class="at">y=</span>yvar, <span class="at">color=</span>cond)) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">shape=</span><span class="dv">1</span>)</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-284-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb341"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb341-1"><a href="ggplot2.html#cb341-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb341-2"><a href="ggplot2.html#cb341-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 同上，但这里带了回归线</span></span>
<span id="cb341-3"><a href="ggplot2.html#cb341-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat, <span class="fu">aes</span>(<span class="at">x=</span>xvar, <span class="at">y=</span>yvar, <span class="at">color=</span>cond)) <span class="sc">+</span></span>
<span id="cb341-4"><a href="ggplot2.html#cb341-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">shape=</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb341-5"><a href="ggplot2.html#cb341-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_colour_hue</span>(<span class="at">l=</span><span class="dv">50</span>) <span class="sc">+</span> <span class="co"># 使用稍暗的调色板</span></span>
<span id="cb341-6"><a href="ggplot2.html#cb341-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">method=</span>lm,   </span>
<span id="cb341-7"><a href="ggplot2.html#cb341-7" aria-hidden="true" tabindex="-1"></a>                <span class="at">se=</span><span class="cn">FALSE</span>)    </span>
<span id="cb341-8"><a href="ggplot2.html#cb341-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; `geom_smooth()` using formula &#39;y ~ x&#39;</span></span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-284-2.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb342"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb342-1"><a href="ggplot2.html#cb342-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb342-2"><a href="ggplot2.html#cb342-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 拓展回归线到数据区域之外（带预测效果）</span></span>
<span id="cb342-3"><a href="ggplot2.html#cb342-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat, <span class="fu">aes</span>(<span class="at">x=</span>xvar, <span class="at">y=</span>yvar, <span class="at">color=</span>cond)) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">shape=</span><span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb342-4"><a href="ggplot2.html#cb342-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_colour_hue</span>(<span class="at">l=</span><span class="dv">50</span>) <span class="sc">+</span> </span>
<span id="cb342-5"><a href="ggplot2.html#cb342-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_smooth</span>(<span class="at">method=</span>lm,   </span>
<span id="cb342-6"><a href="ggplot2.html#cb342-6" aria-hidden="true" tabindex="-1"></a>                <span class="at">se=</span><span class="cn">FALSE</span>,    </span>
<span id="cb342-7"><a href="ggplot2.html#cb342-7" aria-hidden="true" tabindex="-1"></a>                <span class="at">fullrange=</span><span class="cn">TRUE</span>) </span>
<span id="cb342-8"><a href="ggplot2.html#cb342-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; `geom_smooth()` using formula &#39;y ~ x&#39;</span></span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-284-3.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb343"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb343-1"><a href="ggplot2.html#cb343-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb343-2"><a href="ggplot2.html#cb343-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 根据 cond 设置形状</span></span>
<span id="cb343-3"><a href="ggplot2.html#cb343-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat, <span class="fu">aes</span>(<span class="at">x=</span>xvar, <span class="at">y=</span>yvar, <span class="at">shape=</span>cond)) <span class="sc">+</span> <span class="fu">geom_point</span>()</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-284-4.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb344"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb344-1"><a href="ggplot2.html#cb344-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb344-2"><a href="ggplot2.html#cb344-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 同上，但形状不同</span></span>
<span id="cb344-3"><a href="ggplot2.html#cb344-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat, <span class="fu">aes</span>(<span class="at">x=</span>xvar, <span class="at">y=</span>yvar, <span class="at">shape=</span>cond)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb344-4"><a href="ggplot2.html#cb344-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">scale_shape_manual</span>(<span class="at">values=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))  <span class="co"># 使用圆和三角形</span></span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-284-5.png" width="672" style="display: block; margin: auto;" /></p>
<p>查看<a href="ggplot2.html#ggplot2-colors">颜色</a>获取更多关于颜色的信息。查看<a href="图形混杂.html#shape-and-linetype">形状与线形</a>获取更多相关内容。</p>
</div>
<div id="处理图像元素叠加" class="section level4" number="9.4.2.3">
<h4><span class="header-section-number">9.4.2.3</span> 处理图像元素叠加</h4>
<p>如果你有很多数据点，或者你的数据是离散的，那么数据可能会覆盖到一起，这样就看不清楚同一个位置有多少数据了。</p>
<div class="sourceCode" id="cb345"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb345-1"><a href="ggplot2.html#cb345-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 取近似值</span></span>
<span id="cb345-2"><a href="ggplot2.html#cb345-2" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>xrnd <span class="ot">&lt;-</span> <span class="fu">round</span>(dat<span class="sc">$</span>xvar<span class="sc">/</span><span class="dv">5</span>) <span class="sc">*</span> <span class="dv">5</span></span>
<span id="cb345-3"><a href="ggplot2.html#cb345-3" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>yrnd <span class="ot">&lt;-</span> <span class="fu">round</span>(dat<span class="sc">$</span>yvar<span class="sc">/</span><span class="dv">5</span>) <span class="sc">*</span> <span class="dv">5</span></span>
<span id="cb345-4"><a href="ggplot2.html#cb345-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb345-5"><a href="ggplot2.html#cb345-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 让每个点都部分透明 如果情况严重，可以使用更小的值</span></span>
<span id="cb345-6"><a href="ggplot2.html#cb345-6" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat, <span class="fu">aes</span>(<span class="at">x =</span> xrnd, <span class="at">y =</span> yrnd)) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">19</span>,</span>
<span id="cb345-7"><a href="ggplot2.html#cb345-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">alpha =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>)</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-285-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb346"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb346-1"><a href="ggplot2.html#cb346-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb346-2"><a href="ggplot2.html#cb346-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 抖动点 抖动范围在 x 轴上是 1，y 轴上是 0.5</span></span>
<span id="cb346-3"><a href="ggplot2.html#cb346-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat, <span class="fu">aes</span>(<span class="at">x =</span> xrnd, <span class="at">y =</span> yrnd)) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">1</span>,</span>
<span id="cb346-4"><a href="ggplot2.html#cb346-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">position =</span> <span class="fu">position_jitter</span>(<span class="at">width =</span> <span class="dv">1</span>, <span class="at">height =</span> <span class="fl">0.5</span>))</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-285-2.png" width="672" style="display: block; margin: auto;" /></p>
</div>
</div>
</div>
<div id="标题" class="section level2" number="9.5">
<h2><span class="header-section-number">9.5</span> 标题</h2>
<div id="问题-57" class="section level3" number="9.5.1">
<h3><span class="header-section-number">9.5.1</span> 问题</h3>
<p>你想给图形设定一个标题。</p>
</div>
<div id="方案-56" class="section level3" number="9.5.2">
<h3><span class="header-section-number">9.5.2</span> 方案</h3>
<p>一个不带标题的图形例子：</p>
<div class="sourceCode" id="cb347"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb347-1"><a href="ggplot2.html#cb347-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb347-2"><a href="ggplot2.html#cb347-2" aria-hidden="true" tabindex="-1"></a>bp <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(PlantGrowth, <span class="fu">aes</span>(<span class="at">x =</span> group, <span class="at">y =</span> weight)) <span class="sc">+</span></span>
<span id="cb347-3"><a href="ggplot2.html#cb347-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>()</span>
<span id="cb347-4"><a href="ggplot2.html#cb347-4" aria-hidden="true" tabindex="-1"></a>bp</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-286-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>添加标题：</p>
<div class="sourceCode" id="cb348"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb348-1"><a href="ggplot2.html#cb348-1" aria-hidden="true" tabindex="-1"></a>bp <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">&quot;Plant growth&quot;</span>)</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-287-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb349"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb349-1"><a href="ggplot2.html#cb349-1" aria-hidden="true" tabindex="-1"></a><span class="do">## 等同于 bp + labs(title=&#39;Plant growth&#39;)</span></span>
<span id="cb349-2"><a href="ggplot2.html#cb349-2" aria-hidden="true" tabindex="-1"></a><span class="do">## 如果标题比较长，可以用 \n 将它分成多行来显示</span></span>
<span id="cb349-3"><a href="ggplot2.html#cb349-3" aria-hidden="true" tabindex="-1"></a>bp <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">&quot;Plant growth with</span><span class="sc">\n</span><span class="st">different treatments&quot;</span>)</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-287-2.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb350"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb350-1"><a href="ggplot2.html#cb350-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 缩少行距并使用粗体</span></span>
<span id="cb350-2"><a href="ggplot2.html#cb350-2" aria-hidden="true" tabindex="-1"></a>bp <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">&quot;Plant growth with</span><span class="sc">\n</span><span class="st">different treatments&quot;</span>) <span class="sc">+</span></span>
<span id="cb350-3"><a href="ggplot2.html#cb350-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">plot.title =</span> <span class="fu">element_text</span>(<span class="at">lineheight =</span> <span class="fl">0.8</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>))</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-287-3.png" width="672" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="ggplot2-axes" class="section level2" number="9.6">
<h2><span class="header-section-number">9.6</span> 坐标轴</h2>
<div id="问题-58" class="section level3" number="9.6.1">
<h3><span class="header-section-number">9.6.1</span> 问题</h3>
<p>你想要改变轴的顺序或方向。</p>
</div>
<div id="方案-57" class="section level3" number="9.6.2">
<h3><span class="header-section-number">9.6.2</span> 方案</h3>
<blockquote>
<p>注意：下面的例子中提到的 <code>scale_y_continuous()</code>、<code>ylim()</code> 等函数名中，<code>y</code> 都可以替换为 <code>x</code>。</p>
</blockquote>
<p>下面使用内置的 <code>PlantGrowth</code> 数据集绘制一个基本的箱线图。</p>
<div class="sourceCode" id="cb351"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb351-1"><a href="ggplot2.html#cb351-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb351-2"><a href="ggplot2.html#cb351-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb351-3"><a href="ggplot2.html#cb351-3" aria-hidden="true" tabindex="-1"></a>bp <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(PlantGrowth, <span class="fu">aes</span>(<span class="at">x =</span> group, <span class="at">y =</span> weight)) <span class="sc">+</span></span>
<span id="cb351-4"><a href="ggplot2.html#cb351-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_boxplot</span>()</span>
<span id="cb351-5"><a href="ggplot2.html#cb351-5" aria-hidden="true" tabindex="-1"></a>bp</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-288-1.png" width="672" style="display: block; margin: auto;" /></p>
<div id="交换-x-和-y-轴" class="section level4" number="9.6.2.1">
<h4><span class="header-section-number">9.6.2.1</span> 交换 x 和 y 轴</h4>
<p>交换 x 和 y 轴（让 x 垂直、y 水平）。</p>
<div class="sourceCode" id="cb352"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb352-1"><a href="ggplot2.html#cb352-1" aria-hidden="true" tabindex="-1"></a>bp <span class="sc">+</span> <span class="fu">coord_flip</span>()</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-289-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="离散轴" class="section level4" number="9.6.2.2">
<h4><span class="header-section-number">9.6.2.2</span> 离散轴</h4>
<div id="改变条目的顺序" class="section level5" number="9.6.2.2.1">
<h5><span class="header-section-number">9.6.2.2.1</span> 改变条目的顺序</h5>
<div class="sourceCode" id="cb353"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb353-1"><a href="ggplot2.html#cb353-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 手动设定离散轴条目的顺序</span></span>
<span id="cb353-2"><a href="ggplot2.html#cb353-2" aria-hidden="true" tabindex="-1"></a>bp <span class="sc">+</span> <span class="fu">scale_x_discrete</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="st">&quot;trt1&quot;</span>, <span class="st">&quot;trt2&quot;</span>, <span class="st">&quot;ctrl&quot;</span>))</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-290-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb354"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb354-1"><a href="ggplot2.html#cb354-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb354-2"><a href="ggplot2.html#cb354-2" aria-hidden="true" tabindex="-1"></a><span class="do">## 逆转轴条目顺序 获取因子水平</span></span>
<span id="cb354-3"><a href="ggplot2.html#cb354-3" aria-hidden="true" tabindex="-1"></a>flevels <span class="ot">&lt;-</span> <span class="fu">levels</span>(PlantGrowth<span class="sc">$</span>group)</span>
<span id="cb354-4"><a href="ggplot2.html#cb354-4" aria-hidden="true" tabindex="-1"></a>flevels</span>
<span id="cb354-5"><a href="ggplot2.html#cb354-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;ctrl&quot; &quot;trt1&quot; &quot;trt2&quot;</span></span>
<span id="cb354-6"><a href="ggplot2.html#cb354-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb354-7"><a href="ggplot2.html#cb354-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 逆转顺序</span></span>
<span id="cb354-8"><a href="ggplot2.html#cb354-8" aria-hidden="true" tabindex="-1"></a>flevels <span class="ot">&lt;-</span> <span class="fu">rev</span>(flevels)</span>
<span id="cb354-9"><a href="ggplot2.html#cb354-9" aria-hidden="true" tabindex="-1"></a>flevels</span>
<span id="cb354-10"><a href="ggplot2.html#cb354-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; [1] &quot;trt2&quot; &quot;trt1&quot; &quot;ctrl&quot;</span></span>
<span id="cb354-11"><a href="ggplot2.html#cb354-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb354-12"><a href="ggplot2.html#cb354-12" aria-hidden="true" tabindex="-1"></a>bp <span class="sc">+</span> <span class="fu">scale_x_discrete</span>(<span class="at">limits =</span> flevels)</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-290-2.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb355"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb355-1"><a href="ggplot2.html#cb355-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb355-2"><a href="ggplot2.html#cb355-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 或者一行搞定</span></span>
<span id="cb355-3"><a href="ggplot2.html#cb355-3" aria-hidden="true" tabindex="-1"></a>bp <span class="sc">+</span> <span class="fu">scale_x_discrete</span>(<span class="at">limits =</span> <span class="fu">rev</span>(<span class="fu">levels</span>(PlantGrowth<span class="sc">$</span>group)))</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-290-3.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="设定标签" class="section level5" number="9.6.2.2.2">
<h5><span class="header-section-number">9.6.2.2.2</span> 设定标签</h5>
<p>对于离散变量，标签来自于因子水平。然而，有时候短的因子水平名字并不适合展示。</p>
<div class="sourceCode" id="cb356"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb356-1"><a href="ggplot2.html#cb356-1" aria-hidden="true" tabindex="-1"></a>bp <span class="sc">+</span> <span class="fu">scale_x_discrete</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="st">&quot;ctrl&quot;</span>, <span class="st">&quot;trt1&quot;</span>, <span class="st">&quot;trt2&quot;</span>),</span>
<span id="cb356-2"><a href="ggplot2.html#cb356-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Control&quot;</span>, <span class="st">&quot;Treat 1&quot;</span>, <span class="st">&quot;Treat 2&quot;</span>))</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-291-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb357"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb357-1"><a href="ggplot2.html#cb357-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 隐藏 x 刻度、标签和网格线</span></span>
<span id="cb357-2"><a href="ggplot2.html#cb357-2" aria-hidden="true" tabindex="-1"></a>bp <span class="sc">+</span> <span class="fu">scale_x_discrete</span>(<span class="at">breaks =</span> <span class="cn">NULL</span>)</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-292-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb358"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb358-1"><a href="ggplot2.html#cb358-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb358-2"><a href="ggplot2.html#cb358-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 隐藏所有的刻度和标签（X 轴），保留网格线</span></span>
<span id="cb358-3"><a href="ggplot2.html#cb358-3" aria-hidden="true" tabindex="-1"></a>bp <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(), <span class="at">axis.text.x =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-292-2.png" width="672" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="连续轴" class="section level4" number="9.6.2.3">
<h4><span class="header-section-number">9.6.2.3</span> 连续轴</h4>
<div id="设定范围和反转轴方向" class="section level5" number="9.6.2.3.1">
<h5><span class="header-section-number">9.6.2.3.1</span> 设定范围和反转轴方向</h5>
<p>如果你仅想简单地让轴包含某个值，可以使用 <code>expand_limits()</code>，它会进行拓展而不是拉伸。</p>
<div class="sourceCode" id="cb359"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb359-1"><a href="ggplot2.html#cb359-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 确保 y 轴包含 0</span></span>
<span id="cb359-2"><a href="ggplot2.html#cb359-2" aria-hidden="true" tabindex="-1"></a>bp <span class="sc">+</span> <span class="fu">expand_limits</span>(<span class="at">y =</span> <span class="dv">0</span>)</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-293-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb360"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb360-1"><a href="ggplot2.html#cb360-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb360-2"><a href="ggplot2.html#cb360-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 确保 y 轴包含 0 和 8</span></span>
<span id="cb360-3"><a href="ggplot2.html#cb360-3" aria-hidden="true" tabindex="-1"></a>bp <span class="sc">+</span> <span class="fu">expand_limits</span>(<span class="at">y =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">8</span>))</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-293-2.png" width="672" style="display: block; margin: auto;" /></p>
<p>当然你也可以通过 y 刻度显式地指定。注意如果使用<strong>任何</strong> <code>scale_y_continuous</code> 命令，它会覆盖任何 <code>ylim</code> 命令，而且 <code>ylim</code> 会被忽略。</p>
<div class="sourceCode" id="cb361"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb361-1"><a href="ggplot2.html#cb361-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 设定连续值轴的范围 下面是相同的操作</span></span>
<span id="cb361-2"><a href="ggplot2.html#cb361-2" aria-hidden="true" tabindex="-1"></a>bp <span class="sc">+</span> <span class="fu">ylim</span>(<span class="dv">0</span>, <span class="dv">8</span>)</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-294-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb362"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb362-1"><a href="ggplot2.html#cb362-1" aria-hidden="true" tabindex="-1"></a><span class="co"># bp + scale_y_continuous(limits=c(0, 8))</span></span></code></pre></div>
<p>如果使用上述方法让 y 轴的范围变小，任何超出范围的数据都会被忽略。有时候这会产生一些问题，读者需要注意。</p>
<p>为了避免产生问题，你可以使用 <code>coord_cartesian()</code>，相比于设定轴的范围，它设定数据可视化的区域。</p>
<div class="sourceCode" id="cb363"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb363-1"><a href="ggplot2.html#cb363-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 这两个操作一致，超出范围的数据被删除了，导致产生一个误导的箱线图</span></span>
<span id="cb363-2"><a href="ggplot2.html#cb363-2" aria-hidden="true" tabindex="-1"></a>bp <span class="sc">+</span> <span class="fu">ylim</span>(<span class="dv">5</span>, <span class="fl">7.5</span>)</span>
<span id="cb363-3"><a href="ggplot2.html#cb363-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning: Removed 13 rows containing non-finite values</span></span>
<span id="cb363-4"><a href="ggplot2.html#cb363-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; (stat_boxplot).</span></span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-295-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb364"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb364-1"><a href="ggplot2.html#cb364-1" aria-hidden="true" tabindex="-1"></a><span class="co"># bp + scale_y_continuous(limits=c(5, 7.5))</span></span>
<span id="cb364-2"><a href="ggplot2.html#cb364-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb364-3"><a href="ggplot2.html#cb364-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 使用 coord_cartesian &#39;zooms&#39; 区域</span></span>
<span id="cb364-4"><a href="ggplot2.html#cb364-4" aria-hidden="true" tabindex="-1"></a>bp <span class="sc">+</span> <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="fl">7.5</span>))</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-295-2.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb365"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb365-1"><a href="ggplot2.html#cb365-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb365-2"><a href="ggplot2.html#cb365-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 直接指定刻度</span></span>
<span id="cb365-3"><a href="ggplot2.html#cb365-3" aria-hidden="true" tabindex="-1"></a>bp <span class="sc">+</span> <span class="fu">coord_cartesian</span>(<span class="at">ylim =</span> <span class="fu">c</span>(<span class="dv">5</span>, <span class="fl">7.5</span>)) <span class="sc">+</span> <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,</span>
<span id="cb365-4"><a href="ggplot2.html#cb365-4" aria-hidden="true" tabindex="-1"></a>  <span class="dv">10</span>, <span class="fl">0.25</span>))  <span class="co"># Ticks from 0-10, every .25</span></span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-295-3.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="反转轴方向" class="section level5" number="9.6.2.3.2">
<h5><span class="header-section-number">9.6.2.3.2</span> 反转轴方向</h5>
<div class="sourceCode" id="cb366"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb366-1"><a href="ggplot2.html#cb366-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 反转一个连续值轴的方向</span></span>
<span id="cb366-2"><a href="ggplot2.html#cb366-2" aria-hidden="true" tabindex="-1"></a>bp <span class="sc">+</span> <span class="fu">scale_y_reverse</span>()</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-296-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="设置和隐藏刻度标记" class="section level5" number="9.6.2.3.3">
<h5><span class="header-section-number">9.6.2.3.3</span> 设置和隐藏刻度标记</h5>
<div class="sourceCode" id="cb367"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb367-1"><a href="ggplot2.html#cb367-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Setting the tick marks on an axis This will show</span></span>
<span id="cb367-2"><a href="ggplot2.html#cb367-2" aria-hidden="true" tabindex="-1"></a><span class="co"># tick marks on every 0.25 from 1 to 10 The scale will</span></span>
<span id="cb367-3"><a href="ggplot2.html#cb367-3" aria-hidden="true" tabindex="-1"></a><span class="co"># show only the ones that are within range (3.50-6.25</span></span>
<span id="cb367-4"><a href="ggplot2.html#cb367-4" aria-hidden="true" tabindex="-1"></a><span class="co"># in this case)</span></span>
<span id="cb367-5"><a href="ggplot2.html#cb367-5" aria-hidden="true" tabindex="-1"></a>bp <span class="sc">+</span> <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">1</span>, <span class="dv">10</span>, <span class="dv">1</span><span class="sc">/</span><span class="dv">4</span>))</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-297-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb368"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb368-1"><a href="ggplot2.html#cb368-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb368-2"><a href="ggplot2.html#cb368-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 刻度不平等变化</span></span>
<span id="cb368-3"><a href="ggplot2.html#cb368-3" aria-hidden="true" tabindex="-1"></a>bp <span class="sc">+</span> <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="fl">4.25</span>, <span class="fl">4.5</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">8</span>))</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-297-2.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb369"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb369-1"><a href="ggplot2.html#cb369-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb369-2"><a href="ggplot2.html#cb369-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 抑制标签和网格线</span></span>
<span id="cb369-3"><a href="ggplot2.html#cb369-3" aria-hidden="true" tabindex="-1"></a>bp <span class="sc">+</span> <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="cn">NULL</span>)</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-297-3.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb370"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb370-1"><a href="ggplot2.html#cb370-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb370-2"><a href="ggplot2.html#cb370-2" aria-hidden="true" tabindex="-1"></a><span class="co"># Hide tick marks and labels (on Y axis), but keep the</span></span>
<span id="cb370-3"><a href="ggplot2.html#cb370-3" aria-hidden="true" tabindex="-1"></a><span class="co"># gridlines</span></span>
<span id="cb370-4"><a href="ggplot2.html#cb370-4" aria-hidden="true" tabindex="-1"></a>bp <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(), <span class="at">axis.text.y =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-297-4.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="轴刻度-logsqrt-等转换" class="section level5" number="9.6.2.3.4">
<h5><span class="header-section-number">9.6.2.3.4</span> 轴刻度 log、sqrt 等转换</h5>
<p>默认轴是线性坐标，我们也可以将它转换为 log、幂、根等等。</p>
<p>有两种办法可以转换一个轴，一是使用 <em>scale</em> 进行转换，另外是使用 <em>coordinate</em> 进行转换。使用前者需要在先弄好刻度和轴的范围之前转换，而使用后者则相反，需要在弄好刻度和轴范围之后转换。这将产生不太一样的显示效果，如下所示。</p>
<div class="sourceCode" id="cb371"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb371-1"><a href="ggplot2.html#cb371-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 创建指数分布数据</span></span>
<span id="cb371-2"><a href="ggplot2.html#cb371-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">201</span>)</span>
<span id="cb371-3"><a href="ggplot2.html#cb371-3" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb371-4"><a href="ggplot2.html#cb371-4" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">xval =</span> (<span class="dv">1</span><span class="sc">:</span>n <span class="sc">+</span> <span class="fu">rnorm</span>(n, <span class="at">sd =</span> <span class="dv">5</span>))<span class="sc">/</span><span class="dv">20</span>, <span class="at">yval =</span> <span class="dv">2</span> <span class="sc">*</span></span>
<span id="cb371-5"><a href="ggplot2.html#cb371-5" aria-hidden="true" tabindex="-1"></a>  <span class="dv">2</span><span class="sc">^</span>((<span class="dv">1</span><span class="sc">:</span>n <span class="sc">+</span> <span class="fu">rnorm</span>(n, <span class="at">sd =</span> <span class="dv">5</span>))<span class="sc">/</span><span class="dv">20</span>))</span>
<span id="cb371-6"><a href="ggplot2.html#cb371-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb371-7"><a href="ggplot2.html#cb371-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 创建常规的散点图</span></span>
<span id="cb371-8"><a href="ggplot2.html#cb371-8" aria-hidden="true" tabindex="-1"></a>sp <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(dat, <span class="fu">aes</span>(xval, yval)) <span class="sc">+</span> <span class="fu">geom_point</span>()</span>
<span id="cb371-9"><a href="ggplot2.html#cb371-9" aria-hidden="true" tabindex="-1"></a>sp</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-298-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb372"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb372-1"><a href="ggplot2.html#cb372-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb372-2"><a href="ggplot2.html#cb372-2" aria-hidden="true" tabindex="-1"></a><span class="co"># log2 比例化（间隔相等）</span></span>
<span id="cb372-3"><a href="ggplot2.html#cb372-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)  <span class="co"># 需要 scales 包</span></span>
<span id="cb372-4"><a href="ggplot2.html#cb372-4" aria-hidden="true" tabindex="-1"></a>sp <span class="sc">+</span> <span class="fu">scale_y_continuous</span>(<span class="at">trans =</span> <span class="fu">log2_trans</span>())</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-298-2.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb373"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb373-1"><a href="ggplot2.html#cb373-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb373-2"><a href="ggplot2.html#cb373-2" aria-hidden="true" tabindex="-1"></a><span class="co"># log2 坐标转换，空间间隔不同</span></span>
<span id="cb373-3"><a href="ggplot2.html#cb373-3" aria-hidden="true" tabindex="-1"></a>sp <span class="sc">+</span> <span class="fu">coord_trans</span>(<span class="at">y =</span> <span class="st">&quot;log2&quot;</span>)</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-298-3.png" width="672" style="display: block; margin: auto;" /></p>
<p>在标度转换中，我们还可以指定刻度值，让它们显示指数。</p>
<div class="sourceCode" id="cb374"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb374-1"><a href="ggplot2.html#cb374-1" aria-hidden="true" tabindex="-1"></a>sp <span class="sc">+</span> <span class="fu">scale_y_continuous</span>(<span class="at">trans =</span> <span class="fu">log2_trans</span>(), <span class="at">breaks =</span> <span class="fu">trans_breaks</span>(<span class="st">&quot;log2&quot;</span>,</span>
<span id="cb374-2"><a href="ggplot2.html#cb374-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">function</span>(x) <span class="dv">2</span><span class="sc">^</span>x), <span class="at">labels =</span> <span class="fu">trans_format</span>(<span class="st">&quot;log2&quot;</span>, <span class="fu">math_format</span>(<span class="dv">2</span><span class="sc">^</span>.x)))</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-299-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>可以使用非常多的转换，参见 <code>?trans_new</code> 查看所有可用转换的列表。如果你所需要的转换不在该列表上，可以自己写一个转换函数。</p>
<p>有一些非常便捷的函数：<code>scale_y_log10()</code> 和 <code>scale_y_sqrt()</code> （有对应的 x 版本）。</p>
<div class="sourceCode" id="cb375"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb375-1"><a href="ggplot2.html#cb375-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">205</span>)</span>
<span id="cb375-2"><a href="ggplot2.html#cb375-2" aria-hidden="true" tabindex="-1"></a>n <span class="ot">&lt;-</span> <span class="dv">100</span></span>
<span id="cb375-3"><a href="ggplot2.html#cb375-3" aria-hidden="true" tabindex="-1"></a>dat10 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">xval =</span> (<span class="dv">1</span><span class="sc">:</span>n <span class="sc">+</span> <span class="fu">rnorm</span>(n, <span class="at">sd =</span> <span class="dv">5</span>))<span class="sc">/</span><span class="dv">20</span>,</span>
<span id="cb375-4"><a href="ggplot2.html#cb375-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">yval =</span> <span class="dv">10</span> <span class="sc">*</span> <span class="dv">10</span><span class="sc">^</span>((<span class="dv">1</span><span class="sc">:</span>n <span class="sc">+</span> <span class="fu">rnorm</span>(n, <span class="at">sd =</span> <span class="dv">5</span>))<span class="sc">/</span><span class="dv">20</span>))</span>
<span id="cb375-5"><a href="ggplot2.html#cb375-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb375-6"><a href="ggplot2.html#cb375-6" aria-hidden="true" tabindex="-1"></a>sp10 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(dat10, <span class="fu">aes</span>(xval, yval)) <span class="sc">+</span> <span class="fu">geom_point</span>()</span>
<span id="cb375-7"><a href="ggplot2.html#cb375-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb375-8"><a href="ggplot2.html#cb375-8" aria-hidden="true" tabindex="-1"></a><span class="co"># log10</span></span>
<span id="cb375-9"><a href="ggplot2.html#cb375-9" aria-hidden="true" tabindex="-1"></a>sp10 <span class="sc">+</span> <span class="fu">scale_y_log10</span>()</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-300-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb376"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb376-1"><a href="ggplot2.html#cb376-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb376-2"><a href="ggplot2.html#cb376-2" aria-hidden="true" tabindex="-1"></a><span class="co"># log10 转换，并设定指数标签</span></span>
<span id="cb376-3"><a href="ggplot2.html#cb376-3" aria-hidden="true" tabindex="-1"></a>sp10 <span class="sc">+</span> <span class="fu">scale_y_log10</span>(<span class="at">breaks =</span> <span class="fu">trans_breaks</span>(<span class="st">&quot;log10&quot;</span>, <span class="cf">function</span>(x) <span class="dv">10</span><span class="sc">^</span>x),</span>
<span id="cb376-4"><a href="ggplot2.html#cb376-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">labels =</span> <span class="fu">trans_format</span>(<span class="st">&quot;log10&quot;</span>, <span class="fu">math_format</span>(<span class="dv">10</span><span class="sc">^</span>.x)))</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-300-2.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="x-与-y-轴固定的比例" class="section level5" number="9.6.2.3.5">
<h5><span class="header-section-number">9.6.2.3.5</span> x 与 y 轴固定的比例</h5>
<p>设置 x 与 y 轴比例宽度也是可以的。</p>
<div class="sourceCode" id="cb377"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb377-1"><a href="ggplot2.html#cb377-1" aria-hidden="true" tabindex="-1"></a><span class="co"># x 范围 0-10, y 范围 0-30</span></span>
<span id="cb377-2"><a href="ggplot2.html#cb377-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">202</span>)</span>
<span id="cb377-3"><a href="ggplot2.html#cb377-3" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">xval =</span> <span class="fu">runif</span>(<span class="dv">40</span>, <span class="dv">0</span>, <span class="dv">10</span>), <span class="at">yval =</span> <span class="fu">runif</span>(<span class="dv">40</span>,</span>
<span id="cb377-4"><a href="ggplot2.html#cb377-4" aria-hidden="true" tabindex="-1"></a>  <span class="dv">0</span>, <span class="dv">30</span>))</span>
<span id="cb377-5"><a href="ggplot2.html#cb377-5" aria-hidden="true" tabindex="-1"></a>sp <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(dat, <span class="fu">aes</span>(xval, yval)) <span class="sc">+</span> <span class="fu">geom_point</span>()</span>
<span id="cb377-6"><a href="ggplot2.html#cb377-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb377-7"><a href="ggplot2.html#cb377-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 强制比例相等</span></span>
<span id="cb377-8"><a href="ggplot2.html#cb377-8" aria-hidden="true" tabindex="-1"></a>sp <span class="sc">+</span> <span class="fu">coord_fixed</span>()</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-301-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb378"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb378-1"><a href="ggplot2.html#cb378-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb378-2"><a href="ggplot2.html#cb378-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 相等的标度变化，让 x 的 1 个单位等同 y 的 3 个单位</span></span>
<span id="cb378-3"><a href="ggplot2.html#cb378-3" aria-hidden="true" tabindex="-1"></a>sp <span class="sc">+</span> <span class="fu">coord_fixed</span>(<span class="at">ratio =</span> <span class="dv">1</span><span class="sc">/</span><span class="dv">3</span>)</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-301-2.png" width="672" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="轴标签和文字格式化" class="section level4" number="9.6.2.4">
<h4><span class="header-section-number">9.6.2.4</span> 轴标签和文字格式化</h4>
<p>设置和隐藏轴标签：</p>
<div class="sourceCode" id="cb379"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb379-1"><a href="ggplot2.html#cb379-1" aria-hidden="true" tabindex="-1"></a>bp <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_blank</span>()) <span class="sc">+</span>   <span class="co"># 移除 x 轴标签</span></span>
<span id="cb379-2"><a href="ggplot2.html#cb379-2" aria-hidden="true" tabindex="-1"></a>     <span class="fu">ylab</span>(<span class="st">&quot;Weight (Kg)&quot;</span>)                       <span class="co"># 设置 y 轴标签</span></span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-302-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb380"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb380-1"><a href="ggplot2.html#cb380-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb380-2"><a href="ggplot2.html#cb380-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 也可以通过标度设置</span></span>
<span id="cb380-3"><a href="ggplot2.html#cb380-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 注意这里 x 轴标签的空间仍然保留</span></span>
<span id="cb380-4"><a href="ggplot2.html#cb380-4" aria-hidden="true" tabindex="-1"></a>bp <span class="sc">+</span> <span class="fu">scale_x_discrete</span>(<span class="at">name=</span><span class="st">&quot;&quot;</span>) <span class="sc">+</span></span>
<span id="cb380-5"><a href="ggplot2.html#cb380-5" aria-hidden="true" tabindex="-1"></a>     <span class="fu">scale_y_continuous</span>(<span class="at">name=</span><span class="st">&quot;Weight (Kg)&quot;</span>)</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-302-2.png" width="672" style="display: block; margin: auto;" /></p>
<p>改变字体、颜色、旋转刻度标签：</p>
<div class="sourceCode" id="cb381"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb381-1"><a href="ggplot2.html#cb381-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 改变字体选项： X-axis label: bold, red, and 20</span></span>
<span id="cb381-2"><a href="ggplot2.html#cb381-2" aria-hidden="true" tabindex="-1"></a><span class="co"># points X-axis tick marks: rotate 90 degrees CCW,</span></span>
<span id="cb381-3"><a href="ggplot2.html#cb381-3" aria-hidden="true" tabindex="-1"></a><span class="co"># move to the left a bit (using vjust, since the</span></span>
<span id="cb381-4"><a href="ggplot2.html#cb381-4" aria-hidden="true" tabindex="-1"></a><span class="co"># labels are rotated), and 16 points</span></span>
<span id="cb381-5"><a href="ggplot2.html#cb381-5" aria-hidden="true" tabindex="-1"></a>bp <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">face =</span> <span class="st">&quot;bold&quot;</span>, <span class="at">colour =</span> <span class="st">&quot;#990000&quot;</span>,</span>
<span id="cb381-6"><a href="ggplot2.html#cb381-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">size =</span> <span class="dv">20</span>), <span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">90</span>, <span class="at">vjust =</span> <span class="fl">0.5</span>,</span>
<span id="cb381-7"><a href="ggplot2.html#cb381-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">size =</span> <span class="dv">16</span>))</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-303-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="刻度标签" class="section level4" number="9.6.2.5">
<h4><span class="header-section-number">9.6.2.5</span> 刻度标签</h4>
<p>你可能想将值显示为百分比、或美元、或科学计数法。这里可以使用<strong>格式器</strong>，它是一个可以改变文本的函数。</p>
<div class="sourceCode" id="cb382"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb382-1"><a href="ggplot2.html#cb382-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 标签格式器</span></span>
<span id="cb382-2"><a href="ggplot2.html#cb382-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(scales)  <span class="co"># 需要 scales 包</span></span>
<span id="cb382-3"><a href="ggplot2.html#cb382-3" aria-hidden="true" tabindex="-1"></a>bp <span class="sc">+</span> <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> percent) <span class="sc">+</span> <span class="fu">scale_x_discrete</span>(<span class="at">labels =</span> abbreviate)  <span class="co"># 在这个例子中它没作用</span></span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-304-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>连续标度格式器有 <code>comma</code>、<code>percent</code>、<code>dollar</code> 以及 <code>scientific</code>。离散标度格式器有 <code>abbreviate</code>、<code>date_format</code> 等。</p>
<p>有时你需要自己创建格式化函数。下面的函数可以显示时间格式为 HH:MM:SS。</p>
<div class="sourceCode" id="cb383"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb383-1"><a href="ggplot2.html#cb383-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 自定义时间格式化函数</span></span>
<span id="cb383-2"><a href="ggplot2.html#cb383-2" aria-hidden="true" tabindex="-1"></a>timeHMS_formatter <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb383-3"><a href="ggplot2.html#cb383-3" aria-hidden="true" tabindex="-1"></a>  h <span class="ot">&lt;-</span> <span class="fu">floor</span>(x<span class="sc">/</span><span class="dv">60</span>)</span>
<span id="cb383-4"><a href="ggplot2.html#cb383-4" aria-hidden="true" tabindex="-1"></a>  m <span class="ot">&lt;-</span> <span class="fu">floor</span>(x<span class="sc">%%</span><span class="dv">60</span>)</span>
<span id="cb383-5"><a href="ggplot2.html#cb383-5" aria-hidden="true" tabindex="-1"></a>  s <span class="ot">&lt;-</span> <span class="fu">round</span>(<span class="dv">60</span> <span class="sc">*</span> (x<span class="sc">%%</span><span class="dv">1</span>))  <span class="co"># Round to nearest second</span></span>
<span id="cb383-6"><a href="ggplot2.html#cb383-6" aria-hidden="true" tabindex="-1"></a>  lab <span class="ot">&lt;-</span> <span class="fu">sprintf</span>(<span class="st">&quot;%02d:%02d:%02d&quot;</span>, h, m, s)  <span class="co"># Format the strings as HH:MM:SS</span></span>
<span id="cb383-7"><a href="ggplot2.html#cb383-7" aria-hidden="true" tabindex="-1"></a>  lab <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">&quot;^00:&quot;</span>, <span class="st">&quot;&quot;</span>, lab)  <span class="co"># Remove leading 00: if present</span></span>
<span id="cb383-8"><a href="ggplot2.html#cb383-8" aria-hidden="true" tabindex="-1"></a>  lab <span class="ot">&lt;-</span> <span class="fu">gsub</span>(<span class="st">&quot;^0&quot;</span>, <span class="st">&quot;&quot;</span>, lab)  <span class="co"># Remove leading 0 if present</span></span>
<span id="cb383-9"><a href="ggplot2.html#cb383-9" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb383-10"><a href="ggplot2.html#cb383-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb383-11"><a href="ggplot2.html#cb383-11" aria-hidden="true" tabindex="-1"></a>bp <span class="sc">+</span> <span class="fu">scale_y_continuous</span>(<span class="at">label =</span> timeHMS_formatter)</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-305-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="隐藏网格线" class="section level4" number="9.6.2.6">
<h4><span class="header-section-number">9.6.2.6</span> 隐藏网格线</h4>
<p>隐藏网格线：</p>
<div class="sourceCode" id="cb384"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb384-1"><a href="ggplot2.html#cb384-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 隐藏所有网格线</span></span>
<span id="cb384-2"><a href="ggplot2.html#cb384-2" aria-hidden="true" tabindex="-1"></a>bp <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(), <span class="at">panel.grid.major =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-306-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb385"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb385-1"><a href="ggplot2.html#cb385-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 仅隐藏次级网格线</span></span>
<span id="cb385-2"><a href="ggplot2.html#cb385-2" aria-hidden="true" tabindex="-1"></a>bp <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-306-2.png" width="672" style="display: block; margin: auto;" /></p>
<p>也可以仅隐藏水平或垂直网格线：</p>
<div class="sourceCode" id="cb386"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb386-1"><a href="ggplot2.html#cb386-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 隐藏所有垂直网格线</span></span>
<span id="cb386-2"><a href="ggplot2.html#cb386-2" aria-hidden="true" tabindex="-1"></a>bp <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.grid.minor.x =</span> <span class="fu">element_blank</span>(), <span class="at">panel.grid.major.x =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-307-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb387"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb387-1"><a href="ggplot2.html#cb387-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 隐藏所有水平网格线</span></span>
<span id="cb387-2"><a href="ggplot2.html#cb387-2" aria-hidden="true" tabindex="-1"></a>bp <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">panel.grid.minor.y =</span> <span class="fu">element_blank</span>(), <span class="at">panel.grid.major.y =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-307-2.png" width="672" style="display: block; margin: auto;" /></p>
</div>
</div>
</div>
<div id="ggplot2-legends" class="section level2" number="9.7">
<h2><span class="header-section-number">9.7</span> 图例</h2>
<div id="问题-59" class="section level3" number="9.7.1">
<h3><span class="header-section-number">9.7.1</span> 问题</h3>
<p>你想用 <strong>ggplot2</strong> 修改图表中的图例。</p>
</div>
<div id="方案-58" class="section level3" number="9.7.2">
<h3><span class="header-section-number">9.7.2</span> 方案</h3>
<p>从带有默认选项的示例图开始：</p>
<div class="sourceCode" id="cb388"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb388-1"><a href="ggplot2.html#cb388-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb388-2"><a href="ggplot2.html#cb388-2" aria-hidden="true" tabindex="-1"></a>bp <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> PlantGrowth, <span class="fu">aes</span>(<span class="at">x =</span> group, <span class="at">y =</span> weight,</span>
<span id="cb388-3"><a href="ggplot2.html#cb388-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">fill =</span> group)) <span class="sc">+</span> <span class="fu">geom_boxplot</span>()</span>
<span id="cb388-4"><a href="ggplot2.html#cb388-4" aria-hidden="true" tabindex="-1"></a>bp</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-308-1.png" width="672" style="display: block; margin: auto;" /></p>
<div id="去除图例" class="section level4" number="9.7.2.1">
<h4><span class="header-section-number">9.7.2.1</span> 去除图例</h4>
<p>使用 <code>guides(fill=FALSE)</code>, 用想要的颜色替代填充色.</p>
<p>你也可以用 <code>theme()</code> 移除图表中所有的图例。</p>
<div class="sourceCode" id="cb389"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb389-1"><a href="ggplot2.html#cb389-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 删除特定美学的图例（填充）</span></span>
<span id="cb389-2"><a href="ggplot2.html#cb389-2" aria-hidden="true" tabindex="-1"></a>bp <span class="sc">+</span> <span class="fu">guides</span>(<span class="at">fill =</span> <span class="cn">FALSE</span>)</span>
<span id="cb389-3"><a href="ggplot2.html#cb389-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning: `guides(&lt;scale&gt; = FALSE)` is deprecated.</span></span>
<span id="cb389-4"><a href="ggplot2.html#cb389-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Please use `guides(&lt;scale&gt; = &quot;none&quot;)` instead.</span></span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-309-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb390"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb390-1"><a href="ggplot2.html#cb390-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 在指定比例时也可以这样做</span></span>
<span id="cb390-2"><a href="ggplot2.html#cb390-2" aria-hidden="true" tabindex="-1"></a>bp <span class="sc">+</span> <span class="fu">scale_fill_discrete</span>(<span class="at">guide =</span> <span class="cn">FALSE</span>)</span>
<span id="cb390-3"><a href="ggplot2.html#cb390-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; Warning: It is deprecated to specify `guide = FALSE` to</span></span>
<span id="cb390-4"><a href="ggplot2.html#cb390-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; remove a guide. Please use `guide = &quot;none&quot;` instead.</span></span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-309-2.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb391"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb391-1"><a href="ggplot2.html#cb391-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 这将移除所有的图例</span></span>
<span id="cb391-2"><a href="ggplot2.html#cb391-2" aria-hidden="true" tabindex="-1"></a>bp <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-309-3.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="在图例中改变变量的顺序" class="section level4" number="9.7.2.2">
<h4><span class="header-section-number">9.7.2.2</span> 在图例中改变变量的顺序</h4>
<p>这会将变量的顺序更改为 trt1，ctrl，trt2:</p>
<div class="sourceCode" id="cb392"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb392-1"><a href="ggplot2.html#cb392-1" aria-hidden="true" tabindex="-1"></a>bp <span class="sc">+</span> <span class="fu">scale_fill_discrete</span>(<span class="at">breaks =</span> <span class="fu">c</span>(<span class="st">&quot;trt1&quot;</span>, <span class="st">&quot;ctrl&quot;</span>, <span class="st">&quot;trt2&quot;</span>))</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-310-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>根据指定颜色的方式，你可能必须使用不同的比例，如 <code>scale_fill_manual()</code>, <code>scale_colour_hue()</code>, <code>scale_colour_manual()</code>, <code>scale_shape_discrete()</code>, <code>scale_linetype_discrete()</code> 等。</p>
</div>
<div id="反转图例中的条目顺序" class="section level4" number="9.7.2.3">
<h4><span class="header-section-number">9.7.2.3</span> 反转图例中的条目顺序</h4>
<p>反转图例顺序:</p>
<div class="sourceCode" id="cb393"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb393-1"><a href="ggplot2.html#cb393-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 这两种方式等同:</span></span>
<span id="cb393-2"><a href="ggplot2.html#cb393-2" aria-hidden="true" tabindex="-1"></a>bp <span class="sc">+</span> <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_legend</span>(<span class="at">reverse =</span> <span class="cn">TRUE</span>))</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-311-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb394"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb394-1"><a href="ggplot2.html#cb394-1" aria-hidden="true" tabindex="-1"></a>bp <span class="sc">+</span> <span class="fu">scale_fill_discrete</span>(<span class="at">guide =</span> <span class="fu">guide_legend</span>(<span class="at">reverse =</span> <span class="cn">TRUE</span>))</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-311-2.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb395"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb395-1"><a href="ggplot2.html#cb395-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 你也可以直接修改比例尺：</span></span>
<span id="cb395-2"><a href="ggplot2.html#cb395-2" aria-hidden="true" tabindex="-1"></a>bp <span class="sc">+</span> <span class="fu">scale_fill_discrete</span>(<span class="at">breaks =</span> <span class="fu">rev</span>(<span class="fu">levels</span>(PlantGrowth<span class="sc">$</span>group)))</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-311-3.png" width="672" style="display: block; margin: auto;" /></p>
<p>你可以使用不同的比例尺，如 <code>scale_fill_manual()</code>, <code>scale_colour_hue()</code>, <code>scale_colour_manual()</code>, <code>scale_shape_discrete()</code>, <code>scale_linetype_discrete()</code> 等，而不是 <code>scale_fill_discrete()</code>。</p>
</div>
<div id="隐藏图例标题" class="section level4" number="9.7.2.4">
<h4><span class="header-section-number">9.7.2.4</span> 隐藏图例标题</h4>
<p>这将隐藏图例标题:</p>
<div class="sourceCode" id="cb396"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb396-1"><a href="ggplot2.html#cb396-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 为了填充的图例移除标题</span></span>
<span id="cb396-2"><a href="ggplot2.html#cb396-2" aria-hidden="true" tabindex="-1"></a>bp <span class="sc">+</span> <span class="fu">guides</span>(<span class="at">fill =</span> <span class="fu">guide_legend</span>(<span class="at">title =</span> <span class="cn">NULL</span>))</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-312-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb397"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb397-1"><a href="ggplot2.html#cb397-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb397-2"><a href="ggplot2.html#cb397-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 为了所有的图例移除标题</span></span>
<span id="cb397-3"><a href="ggplot2.html#cb397-3" aria-hidden="true" tabindex="-1"></a>bp <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.title =</span> <span class="fu">element_blank</span>())</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-312-2.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="修改图例标题和标签的文字" class="section level4" number="9.7.2.5">
<h4><span class="header-section-number">9.7.2.5</span> 修改图例标题和标签的文字</h4>
<p>有两种方法可以更改图例标题和标签。 第一种方法是告诉 <em>scale</em> 使用具有不同的标题和标签。 第二种方法是更改数据框，使因子具有所需的形式。</p>
<div id="使用比例尺" class="section level5" number="9.7.2.5.1">
<h5><span class="header-section-number">9.7.2.5.1</span> 使用比例尺</h5>
<p>图例可能由 <code>fill</code>, <code>colour</code>, <code>linetype</code>, <code>shape</code> 或其他因素所介导.</p>
</div>
<div id="使用填充和颜色" class="section level5" number="9.7.2.5.2">
<h5><span class="header-section-number">9.7.2.5.2</span> 使用填充和颜色</h5>
<p>因为图例中的变量 <code>group</code> 被映射到颜色 <code>fill</code>，所以必须使用 <code>scale_fill_xxx</code>，其中 <code>xxx</code> 是将 <code>group</code> 的每个因子级别映射到不同颜色的方法。 默认设置是在每个因子级别的色轮上使用不同的色调，但也可以手动指定每个级别的颜色。</p>
<div class="sourceCode" id="cb398"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb398-1"><a href="ggplot2.html#cb398-1" aria-hidden="true" tabindex="-1"></a>bp <span class="sc">+</span> <span class="fu">scale_fill_discrete</span>(<span class="at">name =</span> <span class="st">&quot;Experimental</span><span class="sc">\n</span><span class="st">Condition&quot;</span>)</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-313-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb399"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb399-1"><a href="ggplot2.html#cb399-1" aria-hidden="true" tabindex="-1"></a>bp <span class="sc">+</span> <span class="fu">scale_fill_discrete</span>(<span class="at">name =</span> <span class="st">&quot;Experimental</span><span class="sc">\n</span><span class="st">Condition&quot;</span>,</span>
<span id="cb399-2"><a href="ggplot2.html#cb399-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">breaks =</span> <span class="fu">c</span>(<span class="st">&quot;ctrl&quot;</span>, <span class="st">&quot;trt1&quot;</span>, <span class="st">&quot;trt2&quot;</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Control&quot;</span>,</span>
<span id="cb399-3"><a href="ggplot2.html#cb399-3" aria-hidden="true" tabindex="-1"></a>    <span class="st">&quot;Treatment 1&quot;</span>, <span class="st">&quot;Treatment 2&quot;</span>))</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-313-2.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb400"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb400-1"><a href="ggplot2.html#cb400-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 使用手动刻度而不是色调</span></span>
<span id="cb400-2"><a href="ggplot2.html#cb400-2" aria-hidden="true" tabindex="-1"></a>bp <span class="sc">+</span> <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;#999999&quot;</span>, <span class="st">&quot;#E69F00&quot;</span>,</span>
<span id="cb400-3"><a href="ggplot2.html#cb400-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;#56B4E9&quot;</span>), <span class="at">name =</span> <span class="st">&quot;Experimental</span><span class="sc">\n</span><span class="st">Condition&quot;</span>, <span class="at">breaks =</span> <span class="fu">c</span>(<span class="st">&quot;ctrl&quot;</span>,</span>
<span id="cb400-4"><a href="ggplot2.html#cb400-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;trt1&quot;</span>, <span class="st">&quot;trt2&quot;</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Control&quot;</span>, <span class="st">&quot;Treatment 1&quot;</span>,</span>
<span id="cb400-5"><a href="ggplot2.html#cb400-5" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Treatment 2&quot;</span>))</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-313-3.png" width="672" style="display: block; margin: auto;" /></p>
<p>请注意，这并未更改 x 轴标签。 有关如何修改轴标签的信息，请参见<a href="ggplot2.html#ggplot2-axes">坐标轴</a>。</p>
<p>如果使用折线图，则可能需要使用 <code>scale_colour_xxx()</code> 或 <code>scale_shape_xxx()</code> 而不是 <code>scale_fill_xxx()</code>。 <strong>颜色</strong>映射到线条和点的颜色，而<strong>填充</strong>映射到区域填充的颜色。 <strong>形状</strong>映射到点的形状。</p>
<p>我们将在这里为线图使用不同的数据集，因为 PlantGrowth 数据集不适用于折线图。</p>
<div class="sourceCode" id="cb401"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb401-1"><a href="ggplot2.html#cb401-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 一个不同的数据集</span></span>
<span id="cb401-2"><a href="ggplot2.html#cb401-2" aria-hidden="true" tabindex="-1"></a>df1 <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">sex =</span> <span class="fu">factor</span>(<span class="fu">c</span>(<span class="st">&quot;Female&quot;</span>, <span class="st">&quot;Female&quot;</span>, <span class="st">&quot;Male&quot;</span>,</span>
<span id="cb401-3"><a href="ggplot2.html#cb401-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Male&quot;</span>)), <span class="at">time =</span> <span class="fu">factor</span>(<span class="fu">c</span>(<span class="st">&quot;Lunch&quot;</span>, <span class="st">&quot;Dinner&quot;</span>, <span class="st">&quot;Lunch&quot;</span>,</span>
<span id="cb401-4"><a href="ggplot2.html#cb401-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Dinner&quot;</span>), <span class="at">levels =</span> <span class="fu">c</span>(<span class="st">&quot;Lunch&quot;</span>, <span class="st">&quot;Dinner&quot;</span>)), <span class="at">total_bill =</span> <span class="fu">c</span>(<span class="fl">13.53</span>,</span>
<span id="cb401-5"><a href="ggplot2.html#cb401-5" aria-hidden="true" tabindex="-1"></a>  <span class="fl">16.81</span>, <span class="fl">16.24</span>, <span class="fl">17.42</span>))</span>
<span id="cb401-6"><a href="ggplot2.html#cb401-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb401-7"><a href="ggplot2.html#cb401-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 基本的图表</span></span>
<span id="cb401-8"><a href="ggplot2.html#cb401-8" aria-hidden="true" tabindex="-1"></a>lp <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> df1, <span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> total_bill, <span class="at">group =</span> sex,</span>
<span id="cb401-9"><a href="ggplot2.html#cb401-9" aria-hidden="true" tabindex="-1"></a>  <span class="at">shape =</span> sex)) <span class="sc">+</span> <span class="fu">geom_line</span>() <span class="sc">+</span> <span class="fu">geom_point</span>()</span>
<span id="cb401-10"><a href="ggplot2.html#cb401-10" aria-hidden="true" tabindex="-1"></a>lp</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-314-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb402"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb402-1"><a href="ggplot2.html#cb402-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb402-2"><a href="ggplot2.html#cb402-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 更改图例</span></span>
<span id="cb402-3"><a href="ggplot2.html#cb402-3" aria-hidden="true" tabindex="-1"></a>lp <span class="sc">+</span> <span class="fu">scale_shape_discrete</span>(<span class="at">name =</span> <span class="st">&quot;Payer&quot;</span>, <span class="at">breaks =</span> <span class="fu">c</span>(<span class="st">&quot;Female&quot;</span>,</span>
<span id="cb402-4"><a href="ggplot2.html#cb402-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Male&quot;</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Woman&quot;</span>, <span class="st">&quot;Man&quot;</span>))</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-314-2.png" width="672" style="display: block; margin: auto;" /></p>
<p>如果你同时使用 <code>colour</code> 和 <code>shape</code>，它们都需要给出比例规格。 否则会有两个独立的图例。</p>
<div class="sourceCode" id="cb403"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb403-1"><a href="ggplot2.html#cb403-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 指定颜色和形状</span></span>
<span id="cb403-2"><a href="ggplot2.html#cb403-2" aria-hidden="true" tabindex="-1"></a>lp1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="at">data =</span> df1, <span class="fu">aes</span>(<span class="at">x =</span> time, <span class="at">y =</span> total_bill,</span>
<span id="cb403-3"><a href="ggplot2.html#cb403-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">group =</span> sex, <span class="at">shape =</span> sex, <span class="at">colour =</span> sex)) <span class="sc">+</span> <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb403-4"><a href="ggplot2.html#cb403-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span>
<span id="cb403-5"><a href="ggplot2.html#cb403-5" aria-hidden="true" tabindex="-1"></a>lp1</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-315-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb404"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb404-1"><a href="ggplot2.html#cb404-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb404-2"><a href="ggplot2.html#cb404-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 如果你仅仅指定颜色，将会发生</span></span>
<span id="cb404-3"><a href="ggplot2.html#cb404-3" aria-hidden="true" tabindex="-1"></a>lp1 <span class="sc">+</span> <span class="fu">scale_colour_discrete</span>(<span class="at">name =</span> <span class="st">&quot;Payer&quot;</span>, <span class="at">breaks =</span> <span class="fu">c</span>(<span class="st">&quot;Female&quot;</span>,</span>
<span id="cb404-4"><a href="ggplot2.html#cb404-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Male&quot;</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Woman&quot;</span>, <span class="st">&quot;Man&quot;</span>))</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-315-2.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb405"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb405-1"><a href="ggplot2.html#cb405-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb405-2"><a href="ggplot2.html#cb405-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 指定的颜色和形状</span></span>
<span id="cb405-3"><a href="ggplot2.html#cb405-3" aria-hidden="true" tabindex="-1"></a>lp1 <span class="sc">+</span> <span class="fu">scale_colour_discrete</span>(<span class="at">name =</span> <span class="st">&quot;Payer&quot;</span>, <span class="at">breaks =</span> <span class="fu">c</span>(<span class="st">&quot;Female&quot;</span>,</span>
<span id="cb405-4"><a href="ggplot2.html#cb405-4" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;Male&quot;</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Woman&quot;</span>, <span class="st">&quot;Man&quot;</span>)) <span class="sc">+</span> <span class="fu">scale_shape_discrete</span>(<span class="at">name =</span> <span class="st">&quot;Payer&quot;</span>,</span>
<span id="cb405-5"><a href="ggplot2.html#cb405-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">breaks =</span> <span class="fu">c</span>(<span class="st">&quot;Female&quot;</span>, <span class="st">&quot;Male&quot;</span>), <span class="at">labels =</span> <span class="fu">c</span>(<span class="st">&quot;Woman&quot;</span>, <span class="st">&quot;Man&quot;</span>))</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-315-3.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="比例尺的种类" class="section level5" number="9.7.2.5.3">
<h5><span class="header-section-number">9.7.2.5.3</span> 比例尺的种类</h5>
<p>比例尺有很多种。 它们采用「scale_xxx_yyy」的形式。 以下是一些常用的 <code>xxx</code> 和 <code>yyy</code> 值：</p>
<table>
<thead>
<tr class="header">
<th align="center"><strong>xxx</strong></th>
<th align="center"><strong>描述</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">colour</td>
<td align="center">线和点的颜色</td>
</tr>
<tr class="even">
<td align="center">fill</td>
<td align="center">填充区域的颜色 (比如：柱状图)</td>
</tr>
<tr class="odd">
<td align="center">线条类型</td>
<td align="center">Solid/dashed/dotted lines</td>
</tr>
<tr class="even">
<td align="center">形状</td>
<td align="center">点的形状</td>
</tr>
<tr class="odd">
<td align="center">大小</td>
<td align="center">Size of points</td>
</tr>
<tr class="even">
<td align="center">alpha</td>
<td align="center">不透明度/透明度</td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr class="header">
<th align="center"><strong>yyy</strong></th>
<th align="center"><strong>描述</strong></th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="center">hue</td>
<td align="center">色轮的颜色相同</td>
</tr>
<tr class="even">
<td align="center">manual</td>
<td align="center">手动指定的值（例如，颜色，点形状，线型）</td>
</tr>
<tr class="odd">
<td align="center">gradient</td>
<td align="center">颜色渐变</td>
</tr>
<tr class="even">
<td align="center">grey</td>
<td align="center">Shades of grey</td>
</tr>
<tr class="odd">
<td align="center">discrete</td>
<td align="center">不连续的值 (比如颜色，点的形状，线条类型，点的大小</td>
</tr>
<tr class="even">
<td align="center">continuous</td>
<td align="center">连续的值（透明度，颜色，点的大小）</td>
</tr>
</tbody>
</table>
</div>
</div>
<div id="更改数据框中的因子" class="section level4" number="9.7.2.6">
<h4><span class="header-section-number">9.7.2.6</span> 更改数据框中的因子</h4>
<p>更改图例标题和标签的另一种方法是直接修改数据框。</p>
<div class="sourceCode" id="cb406"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb406-1"><a href="ggplot2.html#cb406-1" aria-hidden="true" tabindex="-1"></a>pg <span class="ot">&lt;-</span> PlantGrowth  <span class="co"># 把数据复制到新的数据框</span></span>
<span id="cb406-2"><a href="ggplot2.html#cb406-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 重命名列中的列和值</span></span>
<span id="cb406-3"><a href="ggplot2.html#cb406-3" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(pg<span class="sc">$</span>group)[<span class="fu">levels</span>(pg<span class="sc">$</span>group) <span class="sc">==</span> <span class="st">&quot;ctrl&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Control&quot;</span></span>
<span id="cb406-4"><a href="ggplot2.html#cb406-4" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(pg<span class="sc">$</span>group)[<span class="fu">levels</span>(pg<span class="sc">$</span>group) <span class="sc">==</span> <span class="st">&quot;trt1&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Treatment 1&quot;</span></span>
<span id="cb406-5"><a href="ggplot2.html#cb406-5" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(pg<span class="sc">$</span>group)[<span class="fu">levels</span>(pg<span class="sc">$</span>group) <span class="sc">==</span> <span class="st">&quot;trt2&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Treatment 2&quot;</span></span>
<span id="cb406-6"><a href="ggplot2.html#cb406-6" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(pg)[<span class="fu">names</span>(pg) <span class="sc">==</span> <span class="st">&quot;group&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Experimental Condition&quot;</span></span>
<span id="cb406-7"><a href="ggplot2.html#cb406-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb406-8"><a href="ggplot2.html#cb406-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 查看最终结果的几行</span></span>
<span id="cb406-9"><a href="ggplot2.html#cb406-9" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(pg)</span>
<span id="cb406-10"><a href="ggplot2.html#cb406-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   weight Experimental Condition</span></span>
<span id="cb406-11"><a href="ggplot2.html#cb406-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1   4.17                Control</span></span>
<span id="cb406-12"><a href="ggplot2.html#cb406-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2   5.58                Control</span></span>
<span id="cb406-13"><a href="ggplot2.html#cb406-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3   5.18                Control</span></span>
<span id="cb406-14"><a href="ggplot2.html#cb406-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4   6.11                Control</span></span>
<span id="cb406-15"><a href="ggplot2.html#cb406-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5   4.50                Control</span></span>
<span id="cb406-16"><a href="ggplot2.html#cb406-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6   4.61                Control</span></span>
<span id="cb406-17"><a href="ggplot2.html#cb406-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb406-18"><a href="ggplot2.html#cb406-18" aria-hidden="true" tabindex="-1"></a><span class="co"># 画图</span></span>
<span id="cb406-19"><a href="ggplot2.html#cb406-19" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> pg, <span class="fu">aes</span>(<span class="at">x =</span> <span class="st">`</span><span class="at">Experimental Condition</span><span class="st">`</span>, <span class="at">y =</span> weight,</span>
<span id="cb406-20"><a href="ggplot2.html#cb406-20" aria-hidden="true" tabindex="-1"></a>  <span class="at">fill =</span> <span class="st">`</span><span class="at">Experimental Condition</span><span class="st">`</span>)) <span class="sc">+</span> <span class="fu">geom_boxplot</span>()</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-316-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>图例标题“实验条件”很长，如果它被分成两行可能看起来更好，但是这种方法效果不好，因为你必须在列的名称中加上一个换行符。另一种方法，有尺度，通常是更好的方法。</p>
<p>另请注意使用反引号而不是引号。由于变量名中的空格，它们是必需的。</p>
</div>
<div id="修改图例标题和标签的外观" class="section level4" number="9.7.2.7">
<h4><span class="header-section-number">9.7.2.7</span> 修改图例标题和标签的外观</h4>
<div class="sourceCode" id="cb407"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb407-1"><a href="ggplot2.html#cb407-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 题目外观</span></span>
<span id="cb407-2"><a href="ggplot2.html#cb407-2" aria-hidden="true" tabindex="-1"></a>bp <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">colour =</span> <span class="st">&quot;blue&quot;</span>,</span>
<span id="cb407-3"><a href="ggplot2.html#cb407-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">size =</span> <span class="dv">16</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>))</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-317-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb408"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb408-1"><a href="ggplot2.html#cb408-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb408-2"><a href="ggplot2.html#cb408-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 标签外观</span></span>
<span id="cb408-3"><a href="ggplot2.html#cb408-3" aria-hidden="true" tabindex="-1"></a>bp <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">colour =</span> <span class="st">&quot;blue&quot;</span>, <span class="at">size =</span> <span class="dv">16</span>,</span>
<span id="cb408-4"><a href="ggplot2.html#cb408-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>))</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-317-2.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="修改图例框" class="section level4" number="9.7.2.8">
<h4><span class="header-section-number">9.7.2.8</span> 修改图例框</h4>
<p>默认情况下，图例周围没有框。 添加框并修改其属性:</p>
<div class="sourceCode" id="cb409"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb409-1"><a href="ggplot2.html#cb409-1" aria-hidden="true" tabindex="-1"></a>bp <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.background =</span> <span class="fu">element_rect</span>())</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-318-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb410"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb410-1"><a href="ggplot2.html#cb410-1" aria-hidden="true" tabindex="-1"></a>bp <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;gray90&quot;</span>,</span>
<span id="cb410-2"><a href="ggplot2.html#cb410-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">size =</span> <span class="fl">0.5</span>, <span class="at">linetype =</span> <span class="st">&quot;dotted&quot;</span>))</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-318-2.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="改变图例位置" class="section level4" number="9.7.2.9">
<h4><span class="header-section-number">9.7.2.9</span> 改变图例位置</h4>
<p>将图例位置放在绘图区域外（左/右/上/下）:</p>
<div class="sourceCode" id="cb411"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb411-1"><a href="ggplot2.html#cb411-1" aria-hidden="true" tabindex="-1"></a>bp <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;top&quot;</span>)</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-319-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>也可以将图例定位在绘图区域内。 请注意，下面的数字位置是相对于整个区域的，包括标题和标签，而不仅仅是绘图区域。</p>
<div class="sourceCode" id="cb412"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb412-1"><a href="ggplot2.html#cb412-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 将图例放在图表中，其中 x，y 为 0, 0（左下角）到 1,</span></span>
<span id="cb412-2"><a href="ggplot2.html#cb412-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 1（右上角）</span></span>
<span id="cb412-3"><a href="ggplot2.html#cb412-3" aria-hidden="true" tabindex="-1"></a>bp <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="fu">c</span>(<span class="fl">0.5</span>, <span class="fl">0.5</span>))</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-320-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb413"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb413-1"><a href="ggplot2.html#cb413-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb413-2"><a href="ggplot2.html#cb413-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 设置图例的「锚点」（左下角为 0, 0; 右上角为 1, 1）</span></span>
<span id="cb413-3"><a href="ggplot2.html#cb413-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 将图例框的左下角放在图的左下角</span></span>
<span id="cb413-4"><a href="ggplot2.html#cb413-4" aria-hidden="true" tabindex="-1"></a>bp <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.justification =</span> <span class="fu">c</span>(<span class="dv">0</span>, <span class="dv">0</span>), <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="dv">0</span>,</span>
<span id="cb413-5"><a href="ggplot2.html#cb413-5" aria-hidden="true" tabindex="-1"></a>  <span class="dv">0</span>))</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-320-2.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb414"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb414-1"><a href="ggplot2.html#cb414-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb414-2"><a href="ggplot2.html#cb414-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 将图例框的右下角放在图表的右下角</span></span>
<span id="cb414-3"><a href="ggplot2.html#cb414-3" aria-hidden="true" tabindex="-1"></a>bp <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">legend.justification =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">0</span>), <span class="at">legend.position =</span> <span class="fu">c</span>(<span class="dv">1</span>,</span>
<span id="cb414-4"><a href="ggplot2.html#cb414-4" aria-hidden="true" tabindex="-1"></a>  <span class="dv">0</span>))</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-320-3.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="隐藏在图例中的斜线" class="section level4" number="9.7.2.10">
<h4><span class="header-section-number">9.7.2.10</span> 隐藏在图例中的斜线</h4>
<p>如果使用轮廓制作条形图（通过设置 color = “black”），它将通过图例中的颜色绘制斜线。 没有内置的方法来删除斜杠，但可以覆盖它们。</p>
<div class="sourceCode" id="cb415"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb415-1"><a href="ggplot2.html#cb415-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 没有边缘线</span></span>
<span id="cb415-2"><a href="ggplot2.html#cb415-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> PlantGrowth, <span class="fu">aes</span>(<span class="at">x =</span> group, <span class="at">fill =</span> group)) <span class="sc">+</span></span>
<span id="cb415-3"><a href="ggplot2.html#cb415-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>()</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-321-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb416"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb416-1"><a href="ggplot2.html#cb416-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb416-2"><a href="ggplot2.html#cb416-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 添加轮廓，但图例中会出现斜线</span></span>
<span id="cb416-3"><a href="ggplot2.html#cb416-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> PlantGrowth, <span class="fu">aes</span>(<span class="at">x =</span> group, <span class="at">fill =</span> group)) <span class="sc">+</span></span>
<span id="cb416-4"><a href="ggplot2.html#cb416-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">colour =</span> <span class="st">&quot;black&quot;</span>)</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-321-2.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb417"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb417-1"><a href="ggplot2.html#cb417-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb417-2"><a href="ggplot2.html#cb417-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 隐藏斜线：首先绘制没有轮廓的条形图并添加图例,</span></span>
<span id="cb417-3"><a href="ggplot2.html#cb417-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 然后用轮廓再次绘制条形图，但带有空白图例.</span></span>
<span id="cb417-4"><a href="ggplot2.html#cb417-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(<span class="at">data =</span> PlantGrowth, <span class="fu">aes</span>(<span class="at">x =</span> group, <span class="at">fill =</span> group)) <span class="sc">+</span></span>
<span id="cb417-5"><a href="ggplot2.html#cb417-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>() <span class="sc">+</span> <span class="fu">geom_bar</span>(<span class="at">colour =</span> <span class="st">&quot;black&quot;</span>, <span class="at">show.legend =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-321-3.png" width="672" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="注意-7" class="section level3" number="9.7.3">
<h3><span class="header-section-number">9.7.3</span> 注意</h3>
<p>更多信息，请阅读 <a href="https://github.com/hadley/ggplot2/wiki/Legend-Attributes">ggplot2-图例属性</a>。</p>
</div>
</div>
<div id="线条" class="section level2" number="9.8">
<h2><span class="header-section-number">9.8</span> 线条</h2>
<div id="问题-60" class="section level3" number="9.8.1">
<h3><span class="header-section-number">9.8.1</span> 问题</h3>
<p>你想要把线条加到图上。</p>
</div>
<div id="方案-59" class="section level3" number="9.8.2">
<h3><span class="header-section-number">9.8.2</span> 方案</h3>
<div id="使用一个连续轴和一个分类轴" class="section level4" number="9.8.2.1">
<h4><span class="header-section-number">9.8.2.1</span> 使用一个连续轴和一个分类轴</h4>
<div class="sourceCode" id="cb418"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb418-1"><a href="ggplot2.html#cb418-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 一些样本数据</span></span>
<span id="cb418-2"><a href="ggplot2.html#cb418-2" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="at">header =</span> <span class="cn">TRUE</span>, <span class="at">text =</span> <span class="st">&quot;</span></span>
<span id="cb418-3"><a href="ggplot2.html#cb418-3" aria-hidden="true" tabindex="-1"></a><span class="st">     cond result</span></span>
<span id="cb418-4"><a href="ggplot2.html#cb418-4" aria-hidden="true" tabindex="-1"></a><span class="st">  control     10</span></span>
<span id="cb418-5"><a href="ggplot2.html#cb418-5" aria-hidden="true" tabindex="-1"></a><span class="st">treatment   11.5</span></span>
<span id="cb418-6"><a href="ggplot2.html#cb418-6" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span>)</span>
<span id="cb418-7"><a href="ggplot2.html#cb418-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb418-8"><a href="ggplot2.html#cb418-8" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span></code></pre></div>
<div id="一条线段" class="section level5" number="9.8.2.1.1">
<h5><span class="header-section-number">9.8.2.1.1</span> 一条线段</h5>
<p>这些使用 <code>geom_hline()</code>，因为y轴是连续的，但如果x轴是连续的，也可以使用 <code>geom_vline()</code>（带有 <code>xintercept</code>）。</p>
<div class="sourceCode" id="cb419"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb419-1"><a href="ggplot2.html#cb419-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 基本柱状条</span></span>
<span id="cb419-2"><a href="ggplot2.html#cb419-2" aria-hidden="true" tabindex="-1"></a>bp <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(dat, <span class="fu">aes</span>(<span class="at">x =</span> cond, <span class="at">y =</span> result)) <span class="sc">+</span> <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="fu">position_dodge</span>(),</span>
<span id="cb419-3"><a href="ggplot2.html#cb419-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>)</span>
<span id="cb419-4"><a href="ggplot2.html#cb419-4" aria-hidden="true" tabindex="-1"></a>bp</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-323-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb420"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb420-1"><a href="ggplot2.html#cb420-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 添加水平线</span></span>
<span id="cb420-2"><a href="ggplot2.html#cb420-2" aria-hidden="true" tabindex="-1"></a>bp <span class="sc">+</span> <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> <span class="dv">12</span>))</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-323-2.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb421"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb421-1"><a href="ggplot2.html#cb421-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 使线条变红并变为虚线</span></span>
<span id="cb421-2"><a href="ggplot2.html#cb421-2" aria-hidden="true" tabindex="-1"></a>bp <span class="sc">+</span> <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> <span class="dv">12</span>), <span class="at">colour =</span> <span class="st">&quot;#990000&quot;</span>,</span>
<span id="cb421-3"><a href="ggplot2.html#cb421-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>)</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-323-3.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="每个分类值的单独行" class="section level5" number="9.8.2.1.2">
<h5><span class="header-section-number">9.8.2.1.2</span> 每个分类值的单独行</h5>
<p>要为每个条形成单独的行，请使用 <code>geom_errorbar()</code>。</p>
<div class="sourceCode" id="cb422"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb422-1"><a href="ggplot2.html#cb422-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 为每个条形绘制单独的线条。 首先添加另一列到目前为止</span></span>
<span id="cb422-2"><a href="ggplot2.html#cb422-2" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>hline <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="dv">9</span>, <span class="dv">12</span>)</span>
<span id="cb422-3"><a href="ggplot2.html#cb422-3" aria-hidden="true" tabindex="-1"></a>dat</span>
<span id="cb422-4"><a href="ggplot2.html#cb422-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;        cond result hline</span></span>
<span id="cb422-5"><a href="ggplot2.html#cb422-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1   control   10.0     9</span></span>
<span id="cb422-6"><a href="ggplot2.html#cb422-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 treatment   11.5    12</span></span>
<span id="cb422-7"><a href="ggplot2.html#cb422-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb422-8"><a href="ggplot2.html#cb422-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 需要重新指定 bp，因为数据已经改变</span></span>
<span id="cb422-9"><a href="ggplot2.html#cb422-9" aria-hidden="true" tabindex="-1"></a>bp <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(dat, <span class="fu">aes</span>(<span class="at">x =</span> cond, <span class="at">y =</span> result)) <span class="sc">+</span> <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="fu">position_dodge</span>(),</span>
<span id="cb422-10"><a href="ggplot2.html#cb422-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>)</span>
<span id="cb422-11"><a href="ggplot2.html#cb422-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb422-12"><a href="ggplot2.html#cb422-12" aria-hidden="true" tabindex="-1"></a><span class="co"># 为每个柱状图画分开的线条</span></span>
<span id="cb422-13"><a href="ggplot2.html#cb422-13" aria-hidden="true" tabindex="-1"></a>bp <span class="sc">+</span> <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymax =</span> hline, <span class="at">ymin =</span> hline), <span class="at">colour =</span> <span class="st">&quot;#AA0000&quot;</span>)</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-324-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb423"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb423-1"><a href="ggplot2.html#cb423-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb423-2"><a href="ggplot2.html#cb423-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 让线条更细一点</span></span>
<span id="cb423-3"><a href="ggplot2.html#cb423-3" aria-hidden="true" tabindex="-1"></a>bp <span class="sc">+</span> <span class="fu">geom_errorbar</span>(<span class="at">width =</span> <span class="fl">0.5</span>, <span class="fu">aes</span>(<span class="at">ymax =</span> hline, <span class="at">ymin =</span> hline),</span>
<span id="cb423-4"><a href="ggplot2.html#cb423-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">colour =</span> <span class="st">&quot;#AA0000&quot;</span>)</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-324-2.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb424"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb424-1"><a href="ggplot2.html#cb424-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb424-2"><a href="ggplot2.html#cb424-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb424-3"><a href="ggplot2.html#cb424-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 即使我们从第二个数据框获得 hline</span></span>
<span id="cb424-4"><a href="ggplot2.html#cb424-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 值，也可以得到相同的结果 使用 hline 定义数据框</span></span>
<span id="cb424-5"><a href="ggplot2.html#cb424-5" aria-hidden="true" tabindex="-1"></a>dat_hlines <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">cond =</span> <span class="fu">c</span>(<span class="st">&quot;control&quot;</span>, <span class="st">&quot;treatment&quot;</span>),</span>
<span id="cb424-6"><a href="ggplot2.html#cb424-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">hline =</span> <span class="fu">c</span>(<span class="dv">9</span>, <span class="dv">12</span>))</span>
<span id="cb424-7"><a href="ggplot2.html#cb424-7" aria-hidden="true" tabindex="-1"></a>dat_hlines</span>
<span id="cb424-8"><a href="ggplot2.html#cb424-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;        cond hline</span></span>
<span id="cb424-9"><a href="ggplot2.html#cb424-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1   control     9</span></span>
<span id="cb424-10"><a href="ggplot2.html#cb424-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 treatment    12</span></span>
<span id="cb424-11"><a href="ggplot2.html#cb424-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb424-12"><a href="ggplot2.html#cb424-12" aria-hidden="true" tabindex="-1"></a><span class="co"># 柱状图形来自 dat，但是线条来自 dat_hlines</span></span>
<span id="cb424-13"><a href="ggplot2.html#cb424-13" aria-hidden="true" tabindex="-1"></a>bp <span class="sc">+</span> <span class="fu">geom_errorbar</span>(<span class="at">data =</span> dat_hlines, <span class="fu">aes</span>(<span class="at">y =</span> <span class="cn">NULL</span>, <span class="at">ymax =</span> hline,</span>
<span id="cb424-14"><a href="ggplot2.html#cb424-14" aria-hidden="true" tabindex="-1"></a>  <span class="at">ymin =</span> hline), <span class="at">colour =</span> <span class="st">&quot;#AA0000&quot;</span>)</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-324-3.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="分组栏上的线条" class="section level5" number="9.8.2.1.3">
<h5><span class="header-section-number">9.8.2.1.3</span> 分组栏上的线条</h5>
<p>可以在分组条上添加线条。 在这个例子中，实际上有四行（<code>hline</code> 的每个条目一行），但它看起来像两个，因为它们是相互重叠的。 我不认为可以避免这种情况，但它不会导致任何问题。</p>
<div class="sourceCode" id="cb425"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb425-1"><a href="ggplot2.html#cb425-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="at">header =</span> <span class="cn">TRUE</span>, <span class="at">text =</span> <span class="st">&quot;</span></span>
<span id="cb425-2"><a href="ggplot2.html#cb425-2" aria-hidden="true" tabindex="-1"></a><span class="st">     cond group result hline</span></span>
<span id="cb425-3"><a href="ggplot2.html#cb425-3" aria-hidden="true" tabindex="-1"></a><span class="st">  control     A     10     9</span></span>
<span id="cb425-4"><a href="ggplot2.html#cb425-4" aria-hidden="true" tabindex="-1"></a><span class="st">treatment     A   11.5    12</span></span>
<span id="cb425-5"><a href="ggplot2.html#cb425-5" aria-hidden="true" tabindex="-1"></a><span class="st">  control     B     12     9</span></span>
<span id="cb425-6"><a href="ggplot2.html#cb425-6" aria-hidden="true" tabindex="-1"></a><span class="st">treatment     B     14    12</span></span>
<span id="cb425-7"><a href="ggplot2.html#cb425-7" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span>)</span>
<span id="cb425-8"><a href="ggplot2.html#cb425-8" aria-hidden="true" tabindex="-1"></a>dat</span>
<span id="cb425-9"><a href="ggplot2.html#cb425-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;        cond group result hline</span></span>
<span id="cb425-10"><a href="ggplot2.html#cb425-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1   control     A   10.0     9</span></span>
<span id="cb425-11"><a href="ggplot2.html#cb425-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 treatment     A   11.5    12</span></span>
<span id="cb425-12"><a href="ggplot2.html#cb425-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3   control     B   12.0     9</span></span>
<span id="cb425-13"><a href="ggplot2.html#cb425-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4 treatment     B   14.0    12</span></span>
<span id="cb425-14"><a href="ggplot2.html#cb425-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb425-15"><a href="ggplot2.html#cb425-15" aria-hidden="true" tabindex="-1"></a><span class="co"># 定义基本柱状图</span></span>
<span id="cb425-16"><a href="ggplot2.html#cb425-16" aria-hidden="true" tabindex="-1"></a>bp <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(dat, <span class="fu">aes</span>(<span class="at">x =</span> cond, <span class="at">y =</span> result, <span class="at">fill =</span> group)) <span class="sc">+</span></span>
<span id="cb425-17"><a href="ggplot2.html#cb425-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="fu">position_dodge</span>(), <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>)</span>
<span id="cb425-18"><a href="ggplot2.html#cb425-18" aria-hidden="true" tabindex="-1"></a>bp</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-325-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb426"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb426-1"><a href="ggplot2.html#cb426-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb426-2"><a href="ggplot2.html#cb426-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 误差线相互绘制 - 有四个但看起来像两个</span></span>
<span id="cb426-3"><a href="ggplot2.html#cb426-3" aria-hidden="true" tabindex="-1"></a>bp <span class="sc">+</span> <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymax =</span> hline, <span class="at">ymin =</span> hline), <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>)</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-325-2.png" width="672" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="各个组合柱状图上的线条" class="section level4" number="9.8.2.2">
<h4><span class="header-section-number">9.8.2.2</span> 各个组合柱状图上的线条</h4>
<p>即使在分组时，也可以在每个单独的条上划线。</p>
<div class="sourceCode" id="cb427"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb427-1"><a href="ggplot2.html#cb427-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="at">header =</span> <span class="cn">TRUE</span>, <span class="at">text =</span> <span class="st">&quot;</span></span>
<span id="cb427-2"><a href="ggplot2.html#cb427-2" aria-hidden="true" tabindex="-1"></a><span class="st">     cond group result hline</span></span>
<span id="cb427-3"><a href="ggplot2.html#cb427-3" aria-hidden="true" tabindex="-1"></a><span class="st">  control     A     10    11</span></span>
<span id="cb427-4"><a href="ggplot2.html#cb427-4" aria-hidden="true" tabindex="-1"></a><span class="st">treatment     A   11.5    12</span></span>
<span id="cb427-5"><a href="ggplot2.html#cb427-5" aria-hidden="true" tabindex="-1"></a><span class="st">  control     B     12  12.5</span></span>
<span id="cb427-6"><a href="ggplot2.html#cb427-6" aria-hidden="true" tabindex="-1"></a><span class="st">treatment     B     14    15</span></span>
<span id="cb427-7"><a href="ggplot2.html#cb427-7" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span>)</span>
<span id="cb427-8"><a href="ggplot2.html#cb427-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb427-9"><a href="ggplot2.html#cb427-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 定义基本条形图</span></span>
<span id="cb427-10"><a href="ggplot2.html#cb427-10" aria-hidden="true" tabindex="-1"></a>bp <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(dat, <span class="fu">aes</span>(<span class="at">x =</span> cond, <span class="at">y =</span> result, <span class="at">fill =</span> group)) <span class="sc">+</span></span>
<span id="cb427-11"><a href="ggplot2.html#cb427-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_bar</span>(<span class="at">position =</span> <span class="fu">position_dodge</span>(), <span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>)</span>
<span id="cb427-12"><a href="ggplot2.html#cb427-12" aria-hidden="true" tabindex="-1"></a>bp</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-326-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb428"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb428-1"><a href="ggplot2.html#cb428-1" aria-hidden="true" tabindex="-1"></a>bp <span class="sc">+</span> <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">ymax =</span> hline, <span class="at">ymin =</span> hline), <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>,</span>
<span id="cb428-2"><a href="ggplot2.html#cb428-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">position =</span> <span class="fu">position_dodge</span>())</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-326-2.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="有两个连续轴" class="section level4" number="9.8.2.3">
<h4><span class="header-section-number">9.8.2.3</span> 有两个连续轴</h4>
<p>样本数据如下：</p>
<div class="sourceCode" id="cb429"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb429-1"><a href="ggplot2.html#cb429-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="at">header =</span> <span class="cn">TRUE</span>, <span class="at">text =</span> <span class="st">&quot;</span></span>
<span id="cb429-2"><a href="ggplot2.html#cb429-2" aria-hidden="true" tabindex="-1"></a><span class="st">      cond xval yval</span></span>
<span id="cb429-3"><a href="ggplot2.html#cb429-3" aria-hidden="true" tabindex="-1"></a><span class="st">   control 11.5 10.8</span></span>
<span id="cb429-4"><a href="ggplot2.html#cb429-4" aria-hidden="true" tabindex="-1"></a><span class="st">   control  9.3 12.9</span></span>
<span id="cb429-5"><a href="ggplot2.html#cb429-5" aria-hidden="true" tabindex="-1"></a><span class="st">   control  8.0  9.9</span></span>
<span id="cb429-6"><a href="ggplot2.html#cb429-6" aria-hidden="true" tabindex="-1"></a><span class="st">   control 11.5 10.1</span></span>
<span id="cb429-7"><a href="ggplot2.html#cb429-7" aria-hidden="true" tabindex="-1"></a><span class="st">   control  8.6  8.3</span></span>
<span id="cb429-8"><a href="ggplot2.html#cb429-8" aria-hidden="true" tabindex="-1"></a><span class="st">   control  9.9  9.5</span></span>
<span id="cb429-9"><a href="ggplot2.html#cb429-9" aria-hidden="true" tabindex="-1"></a><span class="st">   control  8.8  8.7</span></span>
<span id="cb429-10"><a href="ggplot2.html#cb429-10" aria-hidden="true" tabindex="-1"></a><span class="st">   control 11.7 10.1</span></span>
<span id="cb429-11"><a href="ggplot2.html#cb429-11" aria-hidden="true" tabindex="-1"></a><span class="st">   control  9.7  9.3</span></span>
<span id="cb429-12"><a href="ggplot2.html#cb429-12" aria-hidden="true" tabindex="-1"></a><span class="st">   control  9.8 12.0</span></span>
<span id="cb429-13"><a href="ggplot2.html#cb429-13" aria-hidden="true" tabindex="-1"></a><span class="st"> treatment 10.4 10.6</span></span>
<span id="cb429-14"><a href="ggplot2.html#cb429-14" aria-hidden="true" tabindex="-1"></a><span class="st"> treatment 12.1  8.6</span></span>
<span id="cb429-15"><a href="ggplot2.html#cb429-15" aria-hidden="true" tabindex="-1"></a><span class="st"> treatment 11.2 11.0</span></span>
<span id="cb429-16"><a href="ggplot2.html#cb429-16" aria-hidden="true" tabindex="-1"></a><span class="st"> treatment 10.0  8.8</span></span>
<span id="cb429-17"><a href="ggplot2.html#cb429-17" aria-hidden="true" tabindex="-1"></a><span class="st"> treatment 12.9  9.5</span></span>
<span id="cb429-18"><a href="ggplot2.html#cb429-18" aria-hidden="true" tabindex="-1"></a><span class="st"> treatment  9.1 10.0</span></span>
<span id="cb429-19"><a href="ggplot2.html#cb429-19" aria-hidden="true" tabindex="-1"></a><span class="st"> treatment 13.4  9.6</span></span>
<span id="cb429-20"><a href="ggplot2.html#cb429-20" aria-hidden="true" tabindex="-1"></a><span class="st"> treatment 11.6  9.8</span></span>
<span id="cb429-21"><a href="ggplot2.html#cb429-21" aria-hidden="true" tabindex="-1"></a><span class="st"> treatment 11.5  9.8</span></span>
<span id="cb429-22"><a href="ggplot2.html#cb429-22" aria-hidden="true" tabindex="-1"></a><span class="st"> treatment 12.0 10.6</span></span>
<span id="cb429-23"><a href="ggplot2.html#cb429-23" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span>)</span>
<span id="cb429-24"><a href="ggplot2.html#cb429-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb429-25"><a href="ggplot2.html#cb429-25" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span></code></pre></div>
<div id="基础线条" class="section level5" number="9.8.2.3.1">
<h5><span class="header-section-number">9.8.2.3.1</span> 基础线条</h5>
<div class="sourceCode" id="cb430"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb430-1"><a href="ggplot2.html#cb430-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 基本的散点图</span></span>
<span id="cb430-2"><a href="ggplot2.html#cb430-2" aria-hidden="true" tabindex="-1"></a>sp <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(dat, <span class="fu">aes</span>(<span class="at">x =</span> xval, <span class="at">y =</span> yval, <span class="at">colour =</span> cond)) <span class="sc">+</span></span>
<span id="cb430-3"><a href="ggplot2.html#cb430-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>()</span>
<span id="cb430-4"><a href="ggplot2.html#cb430-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 添加一个水平线条</span></span>
<span id="cb430-5"><a href="ggplot2.html#cb430-5" aria-hidden="true" tabindex="-1"></a>sp <span class="sc">+</span> <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> <span class="dv">10</span>))</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-328-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb431"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb431-1"><a href="ggplot2.html#cb431-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 添加红色虚线垂直线</span></span>
<span id="cb431-2"><a href="ggplot2.html#cb431-2" aria-hidden="true" tabindex="-1"></a>sp <span class="sc">+</span> <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> <span class="dv">10</span>)) <span class="sc">+</span> <span class="fu">geom_vline</span>(<span class="fu">aes</span>(<span class="at">xintercept =</span> <span class="fl">11.5</span>),</span>
<span id="cb431-3"><a href="ggplot2.html#cb431-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">colour =</span> <span class="st">&quot;#BB0000&quot;</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>)</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-328-2.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="画线为平均值" class="section level5" number="9.8.2.3.2">
<h5><span class="header-section-number">9.8.2.3.2</span> 画线为平均值</h5>
<p>还可以按一些变量分组计算每个数据子集的平均值。 组别必须计算并存储在单独的列中，最简单的方法是使用 <strong>dplyr</strong> 包。请注意，该行的 y 范围由数据确定。</p>
<div class="sourceCode" id="cb432"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb432-1"><a href="ggplot2.html#cb432-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb432-2"><a href="ggplot2.html#cb432-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb432-3"><a href="ggplot2.html#cb432-3" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 载入程辑包：&#39;dplyr&#39;</span></span>
<span id="cb432-4"><a href="ggplot2.html#cb432-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; The following objects are masked from &#39;package:plyr&#39;:</span></span>
<span id="cb432-5"><a href="ggplot2.html#cb432-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb432-6"><a href="ggplot2.html#cb432-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     arrange, count, desc, failwith, id, mutate,</span></span>
<span id="cb432-7"><a href="ggplot2.html#cb432-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     rename, summarise, summarize</span></span>
<span id="cb432-8"><a href="ggplot2.html#cb432-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; The following object is masked from &#39;package:car&#39;:</span></span>
<span id="cb432-9"><a href="ggplot2.html#cb432-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb432-10"><a href="ggplot2.html#cb432-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     recode</span></span>
<span id="cb432-11"><a href="ggplot2.html#cb432-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; The following objects are masked from &#39;package:stats&#39;:</span></span>
<span id="cb432-12"><a href="ggplot2.html#cb432-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb432-13"><a href="ggplot2.html#cb432-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     filter, lag</span></span>
<span id="cb432-14"><a href="ggplot2.html#cb432-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; The following objects are masked from &#39;package:base&#39;:</span></span>
<span id="cb432-15"><a href="ggplot2.html#cb432-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb432-16"><a href="ggplot2.html#cb432-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span>
<span id="cb432-17"><a href="ggplot2.html#cb432-17" aria-hidden="true" tabindex="-1"></a>lines <span class="ot">&lt;-</span> dat <span class="sc">%&gt;%</span></span>
<span id="cb432-18"><a href="ggplot2.html#cb432-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cond) <span class="sc">%&gt;%</span></span>
<span id="cb432-19"><a href="ggplot2.html#cb432-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">x =</span> <span class="fu">mean</span>(xval), <span class="at">ymin =</span> <span class="fu">min</span>(yval), <span class="at">ymax =</span> <span class="fu">max</span>(yval))</span>
<span id="cb432-20"><a href="ggplot2.html#cb432-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb432-21"><a href="ggplot2.html#cb432-21" aria-hidden="true" tabindex="-1"></a><span class="co"># 为每组的平均 xval 添加彩色线条</span></span>
<span id="cb432-22"><a href="ggplot2.html#cb432-22" aria-hidden="true" tabindex="-1"></a>sp <span class="ot">&lt;-</span> sp <span class="sc">+</span> <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> <span class="dv">10</span>)) <span class="sc">+</span> <span class="fu">geom_linerange</span>(<span class="fu">aes</span>(<span class="at">x =</span> x,</span>
<span id="cb432-23"><a href="ggplot2.html#cb432-23" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="cn">NULL</span>, <span class="at">ymin =</span> ymin, <span class="at">ymax =</span> ymax), <span class="at">data =</span> lines)</span>
<span id="cb432-24"><a href="ggplot2.html#cb432-24" aria-hidden="true" tabindex="-1"></a>sp</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-329-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="在分面使用线条" class="section level5" number="9.8.2.3.3">
<h5><span class="header-section-number">9.8.2.3.3</span> 在分面使用线条</h5>
<p>一般来说，如果你加一条线，它将出现在所有的分面上。</p>
<div class="sourceCode" id="cb433"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb433-1"><a href="ggplot2.html#cb433-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 分面，基于cond</span></span>
<span id="cb433-2"><a href="ggplot2.html#cb433-2" aria-hidden="true" tabindex="-1"></a>spf <span class="ot">&lt;-</span> sp <span class="sc">+</span> <span class="fu">facet_grid</span>(. <span class="sc">~</span> cond)</span>
<span id="cb433-3"><a href="ggplot2.html#cb433-3" aria-hidden="true" tabindex="-1"></a>spf</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-330-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb434"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb434-1"><a href="ggplot2.html#cb434-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 用相同的值在所有的分面上画水平线</span></span>
<span id="cb434-2"><a href="ggplot2.html#cb434-2" aria-hidden="true" tabindex="-1"></a>spf <span class="sc">+</span> <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> <span class="dv">10</span>))</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-330-2.png" width="672" style="display: block; margin: auto;" /></p>
<p>如果你希望不同的线条出现在不同的方面，有两个选项。 一种是创建具有所需线条值的新数据框。 另一种选择（控制更有限）是在 <code>geom_line()</code> 中设定 <code>stat</code> 和 <code>xintercept</code>。</p>
<div class="sourceCode" id="cb435"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb435-1"><a href="ggplot2.html#cb435-1" aria-hidden="true" tabindex="-1"></a>dat_vlines <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">cond =</span> <span class="fu">c</span>(<span class="st">&quot;control&quot;</span>, <span class="st">&quot;treatment&quot;</span>),</span>
<span id="cb435-2"><a href="ggplot2.html#cb435-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">xval =</span> <span class="fu">c</span>(<span class="dv">10</span>, <span class="fl">11.5</span>))</span>
<span id="cb435-3"><a href="ggplot2.html#cb435-3" aria-hidden="true" tabindex="-1"></a>dat_vlines</span>
<span id="cb435-4"><a href="ggplot2.html#cb435-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;        cond xval</span></span>
<span id="cb435-5"><a href="ggplot2.html#cb435-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1   control 10.0</span></span>
<span id="cb435-6"><a href="ggplot2.html#cb435-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2 treatment 11.5</span></span>
<span id="cb435-7"><a href="ggplot2.html#cb435-7" aria-hidden="true" tabindex="-1"></a>spf <span class="sc">+</span> <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> <span class="dv">10</span>)) <span class="sc">+</span> <span class="fu">geom_vline</span>(<span class="fu">aes</span>(<span class="at">xintercept =</span> xval),</span>
<span id="cb435-8"><a href="ggplot2.html#cb435-8" aria-hidden="true" tabindex="-1"></a>  <span class="at">data =</span> dat_vlines, <span class="at">colour =</span> <span class="st">&quot;#990000&quot;</span>, <span class="at">linetype =</span> <span class="st">&quot;dashed&quot;</span>)</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-331-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb436"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb436-1"><a href="ggplot2.html#cb436-1" aria-hidden="true" tabindex="-1"></a>spf <span class="sc">+</span> <span class="fu">geom_hline</span>(<span class="fu">aes</span>(<span class="at">yintercept =</span> <span class="dv">10</span>)) <span class="sc">+</span> <span class="fu">geom_linerange</span>(<span class="fu">aes</span>(<span class="at">x =</span> x,</span>
<span id="cb436-2"><a href="ggplot2.html#cb436-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">y =</span> <span class="cn">NULL</span>, <span class="at">ymin =</span> ymin, <span class="at">ymax =</span> ymax), <span class="at">data =</span> lines)</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-331-2.png" width="672" style="display: block; margin: auto;" /></p>
</div>
</div>
</div>
</div>
<div id="ggplot-facet" class="section level2" number="9.9">
<h2><span class="header-section-number">9.9</span> 分面</h2>
<div id="问题-61" class="section level3" number="9.9.1">
<h3><span class="header-section-number">9.9.1</span> 问题</h3>
<p>你想要根据一个或多个变量对数据进行分割并且绘制出该数据所有的子图。</p>
</div>
<div id="方案-60" class="section level3" number="9.9.2">
<h3><span class="header-section-number">9.9.2</span> 方案</h3>
<div id="样本数据-1" class="section level4" number="9.9.2.1">
<h4><span class="header-section-number">9.9.2.1</span> 样本数据</h4>
<p>以下例子将使用 <strong>reshape2</strong> 包中的 <code>tips</code> 数据集</p>
<div class="sourceCode" id="cb437"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb437-1"><a href="ggplot2.html#cb437-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(reshape2)</span>
<span id="cb437-2"><a href="ggplot2.html#cb437-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 查看头几行数据</span></span>
<span id="cb437-3"><a href="ggplot2.html#cb437-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(tips)</span>
<span id="cb437-4"><a href="ggplot2.html#cb437-4" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   total_bill  tip    sex smoker day   time size</span></span>
<span id="cb437-5"><a href="ggplot2.html#cb437-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1      16.99 1.01 Female     No Sun Dinner    2</span></span>
<span id="cb437-6"><a href="ggplot2.html#cb437-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2      10.34 1.66   Male     No Sun Dinner    3</span></span>
<span id="cb437-7"><a href="ggplot2.html#cb437-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3      21.01 3.50   Male     No Sun Dinner    3</span></span>
<span id="cb437-8"><a href="ggplot2.html#cb437-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 4      23.68 3.31   Male     No Sun Dinner    2</span></span>
<span id="cb437-9"><a href="ggplot2.html#cb437-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 5      24.59 3.61 Female     No Sun Dinner    4</span></span>
<span id="cb437-10"><a href="ggplot2.html#cb437-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 6      25.29 4.71   Male     No Sun Dinner    4</span></span></code></pre></div>
<p>根据小费 (tip) 占总账单 (total_bill) 的百分比绘制散点图</p>
<div class="sourceCode" id="cb438"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb438-1"><a href="ggplot2.html#cb438-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb438-2"><a href="ggplot2.html#cb438-2" aria-hidden="true" tabindex="-1"></a>sp <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(tips, <span class="fu">aes</span>(<span class="at">x =</span> total_bill, <span class="at">y =</span> tip<span class="sc">/</span>total_bill)) <span class="sc">+</span></span>
<span id="cb438-3"><a href="ggplot2.html#cb438-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">1</span>)</span>
<span id="cb438-4"><a href="ggplot2.html#cb438-4" aria-hidden="true" tabindex="-1"></a>sp</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-333-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="facet_grid" class="section level4" number="9.9.2.2">
<h4><span class="header-section-number">9.9.2.2</span> facet_grid</h4>
<p>根据一个或多个变量对数据进行分割，生成的子图按照水平或垂直的方向进行排列。这一功能是通过赋予 <code>facet_grid()</code> 函数一个 <code>vertical ~ horizontal</code> 公式来实现的（这里所说的「公式」是 R 中的一种数据结构，而不是数学意义上的公式）。</p>
<div class="sourceCode" id="cb439"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb439-1"><a href="ggplot2.html#cb439-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 根据 &#39;sex&#39; 按垂直方向分割</span></span>
<span id="cb439-2"><a href="ggplot2.html#cb439-2" aria-hidden="true" tabindex="-1"></a>sp <span class="sc">+</span> <span class="fu">facet_grid</span>(sex <span class="sc">~</span> .)</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-334-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb440"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb440-1"><a href="ggplot2.html#cb440-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 根据 &#39;sex&#39; 按水平方向分割。</span></span>
<span id="cb440-2"><a href="ggplot2.html#cb440-2" aria-hidden="true" tabindex="-1"></a>sp <span class="sc">+</span> <span class="fu">facet_grid</span>(. <span class="sc">~</span> sex)</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-335-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb441"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb441-1"><a href="ggplot2.html#cb441-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 垂直方向以 &#39;sex&#39; 分割，水平方向以 &#39;day&#39; 分割。</span></span>
<span id="cb441-2"><a href="ggplot2.html#cb441-2" aria-hidden="true" tabindex="-1"></a>sp <span class="sc">+</span> <span class="fu">facet_grid</span>(sex <span class="sc">~</span> day)</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-336-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="facet_wrap" class="section level4" number="9.9.2.3">
<h4><span class="header-section-number">9.9.2.3</span> facet_wrap</h4>
<p>除了能够根据<strong>单个变量</strong>在水平或垂直方向上对图进行分面，<code>facet_wrap()</code> 函数可以通过设置特定的行数或列数，让子图排列到一起。此时每个图像的上方都会有标签。</p>
<div class="sourceCode" id="cb442"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb442-1"><a href="ggplot2.html#cb442-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 以变量 `day` 进行水平分面，分面的行数为2。</span></span>
<span id="cb442-2"><a href="ggplot2.html#cb442-2" aria-hidden="true" tabindex="-1"></a>sp <span class="sc">+</span> <span class="fu">facet_wrap</span>(<span class="sc">~</span>day, <span class="at">ncol =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-337-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="修改分面标签的外观" class="section level4" number="9.9.2.4">
<h4><span class="header-section-number">9.9.2.4</span> 修改分面标签的外观</h4>
<div class="sourceCode" id="cb443"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb443-1"><a href="ggplot2.html#cb443-1" aria-hidden="true" tabindex="-1"></a>sp <span class="sc">+</span> <span class="fu">facet_grid</span>(sex <span class="sc">~</span> day) <span class="sc">+</span> <span class="fu">theme</span>(<span class="at">strip.text.x =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>,</span>
<span id="cb443-2"><a href="ggplot2.html#cb443-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">angle =</span> <span class="dv">75</span>), <span class="at">strip.text.y =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>,</span>
<span id="cb443-3"><a href="ggplot2.html#cb443-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>), <span class="at">strip.background =</span> <span class="fu">element_rect</span>(<span class="at">colour =</span> <span class="st">&quot;red&quot;</span>,</span>
<span id="cb443-4"><a href="ggplot2.html#cb443-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">fill =</span> <span class="st">&quot;#CCCCFF&quot;</span>))</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-338-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="修改分面标签的文本" class="section level4" number="9.9.2.5">
<h4><span class="header-section-number">9.9.2.5</span> 修改分面标签的文本</h4>
<p>修改分面标签内容有两种方法。最简单的方法是为原来的名字匹配一个新的名字向量。例如，对数据中 <code>sex</code> 的类别进行重新定义 Female==&gt;Women 和 Male==&gt;Men：</p>
<div class="sourceCode" id="cb444"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb444-1"><a href="ggplot2.html#cb444-1" aria-hidden="true" tabindex="-1"></a>labels <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="at">Female =</span> <span class="st">&quot;Women&quot;</span>, <span class="at">Male =</span> <span class="st">&quot;Men&quot;</span>)</span>
<span id="cb444-2"><a href="ggplot2.html#cb444-2" aria-hidden="true" tabindex="-1"></a>sp <span class="sc">+</span> <span class="fu">facet_grid</span>(. <span class="sc">~</span> sex, <span class="at">labeller =</span> <span class="fu">labeller</span>(<span class="at">sex =</span> labels))</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-339-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>另一个方法就是直接在数据框中修改，将你想要显示的标签赋值给相应的数据:</p>
<div class="sourceCode" id="cb445"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb445-1"><a href="ggplot2.html#cb445-1" aria-hidden="true" tabindex="-1"></a>tips2 <span class="ot">&lt;-</span> tips</span>
<span id="cb445-2"><a href="ggplot2.html#cb445-2" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(tips2<span class="sc">$</span>sex)[<span class="fu">levels</span>(tips2<span class="sc">$</span>sex) <span class="sc">==</span> <span class="st">&quot;Female&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Women&quot;</span></span>
<span id="cb445-3"><a href="ggplot2.html#cb445-3" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(tips2<span class="sc">$</span>sex)[<span class="fu">levels</span>(tips2<span class="sc">$</span>sex) <span class="sc">==</span> <span class="st">&quot;Male&quot;</span>] <span class="ot">&lt;-</span> <span class="st">&quot;Men&quot;</span></span>
<span id="cb445-4"><a href="ggplot2.html#cb445-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(tips2, <span class="dv">3</span>)</span>
<span id="cb445-5"><a href="ggplot2.html#cb445-5" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;   total_bill  tip   sex smoker day   time size</span></span>
<span id="cb445-6"><a href="ggplot2.html#cb445-6" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 1      16.99 1.01 Women     No Sun Dinner    2</span></span>
<span id="cb445-7"><a href="ggplot2.html#cb445-7" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 2      10.34 1.66   Men     No Sun Dinner    3</span></span>
<span id="cb445-8"><a href="ggplot2.html#cb445-8" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; 3      21.01 3.50   Men     No Sun Dinner    3</span></span>
<span id="cb445-9"><a href="ggplot2.html#cb445-9" aria-hidden="true" tabindex="-1"></a>sp2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(tips2, <span class="fu">aes</span>(<span class="at">x =</span> total_bill, <span class="at">y =</span> tip<span class="sc">/</span>total_bill)) <span class="sc">+</span></span>
<span id="cb445-10"><a href="ggplot2.html#cb445-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">shape =</span> <span class="dv">1</span>)</span>
<span id="cb445-11"><a href="ggplot2.html#cb445-11" aria-hidden="true" tabindex="-1"></a>sp2 <span class="sc">+</span> <span class="fu">facet_grid</span>(. <span class="sc">~</span> sex)</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-340-1.png" width="672" style="display: block; margin: auto;" /></p>
<p>两种方法都能得到相同的结果。</p>
<p><code>labeller()</code> 可以通过设定不同的 <code>函数</code> 来处理输入的字符向量。比方说 <code>Hmisc</code> 包里的 <code>capitalize</code> 函数可以将字符串的首字母变成大写。我们也可以这样来自定义函数，如下所示，将字符串中的字母倒序：</p>
<div class="sourceCode" id="cb446"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb446-1"><a href="ggplot2.html#cb446-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 对每个字符向量进行倒序：</span></span>
<span id="cb446-2"><a href="ggplot2.html#cb446-2" aria-hidden="true" tabindex="-1"></a>reverse <span class="ot">&lt;-</span> <span class="cf">function</span>(strings) {</span>
<span id="cb446-3"><a href="ggplot2.html#cb446-3" aria-hidden="true" tabindex="-1"></a>  strings <span class="ot">&lt;-</span> <span class="fu">strsplit</span>(strings, <span class="st">&quot;&quot;</span>)</span>
<span id="cb446-4"><a href="ggplot2.html#cb446-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">vapply</span>(strings, <span class="cf">function</span>(x) {</span>
<span id="cb446-5"><a href="ggplot2.html#cb446-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">paste</span>(<span class="fu">rev</span>(x), <span class="at">collapse =</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb446-6"><a href="ggplot2.html#cb446-6" aria-hidden="true" tabindex="-1"></a>  }, <span class="at">FUN.VALUE =</span> <span class="fu">character</span>(<span class="dv">1</span>))</span>
<span id="cb446-7"><a href="ggplot2.html#cb446-7" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb446-8"><a href="ggplot2.html#cb446-8" aria-hidden="true" tabindex="-1"></a>sp <span class="sc">+</span> <span class="fu">facet_grid</span>(. <span class="sc">~</span> sex, <span class="at">labeller =</span> <span class="fu">labeller</span>(<span class="at">sex =</span> reverse))</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-341-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="设置标度" class="section level4" number="9.9.2.6">
<h4><span class="header-section-number">9.9.2.6</span> 设置标度</h4>
<p>一般而言，每幅图的坐标轴范围都是<strong>固定不变</strong>的，也就是说每幅图都拥有相同的尺寸和范围。你可以通过将 <code>scales</code> 设置为 <code>free</code>，<code>free_x</code> 或 <code>free_y</code> 来改变坐标轴范围。</p>
<div class="sourceCode" id="cb447"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb447-1"><a href="ggplot2.html#cb447-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 描绘一个 total_bill 的柱状图</span></span>
<span id="cb447-2"><a href="ggplot2.html#cb447-2" aria-hidden="true" tabindex="-1"></a>hp <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(tips, <span class="fu">aes</span>(<span class="at">x =</span> total_bill)) <span class="sc">+</span> <span class="fu">geom_histogram</span>(<span class="at">binwidth =</span> <span class="dv">2</span>,</span>
<span id="cb447-3"><a href="ggplot2.html#cb447-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">colour =</span> <span class="st">&quot;white&quot;</span>)</span>
<span id="cb447-4"><a href="ggplot2.html#cb447-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 根据性别和是否吸烟进行分面</span></span>
<span id="cb447-5"><a href="ggplot2.html#cb447-5" aria-hidden="true" tabindex="-1"></a>hp <span class="sc">+</span> <span class="fu">facet_grid</span>(sex <span class="sc">~</span> smoker)</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-342-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb448"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb448-1"><a href="ggplot2.html#cb448-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 在同样的情况下设定 scales=&#39;free_y&#39; (y 轴自由标度）</span></span>
<span id="cb448-2"><a href="ggplot2.html#cb448-2" aria-hidden="true" tabindex="-1"></a>hp <span class="sc">+</span> <span class="fu">facet_grid</span>(sex <span class="sc">~</span> smoker, <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span>)</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-342-2.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb449"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb449-1"><a href="ggplot2.html#cb449-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 画布的缩放比例不变，但各分面的范围有所改变，因此每个分面的物理大小都不一致</span></span>
<span id="cb449-2"><a href="ggplot2.html#cb449-2" aria-hidden="true" tabindex="-1"></a>hp <span class="sc">+</span> <span class="fu">facet_grid</span>(sex <span class="sc">~</span> smoker, <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>, <span class="at">space =</span> <span class="st">&quot;free&quot;</span>)</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-342-3.png" width="672" style="display: block; margin: auto;" /></p>
</div>
</div>
</div>
<div id="多图" class="section level2" number="9.10">
<h2><span class="header-section-number">9.10</span> 多图</h2>
<div id="问题-62" class="section level3" number="9.10.1">
<h3><span class="header-section-number">9.10.1</span> 问题</h3>
<p>你想把多个图形放到同一个页面中。</p>
</div>
<div id="方案-61" class="section level3" number="9.10.2">
<h3><span class="header-section-number">9.10.2</span> 方案</h3>
<p>最简单的方法就是使用 <code>multiplot()</code> 函数。</p>
<p><code>multiplot()</code> 函数可以将任意数量的图像对象作为参数，或者可以构建一个图像对象列表传递到该函数的 <code>plotlist</code> 参数中。</p>
<div class="sourceCode" id="cb450"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb450-1"><a href="ggplot2.html#cb450-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 多图功能 ggplot 对象可以直接放入 `…`</span></span>
<span id="cb450-2"><a href="ggplot2.html#cb450-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 中，也可以传递到 `plotlist` 里（这里的 ggplot</span></span>
<span id="cb450-3"><a href="ggplot2.html#cb450-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 对象以列表形式存在） - cols: 图像的列数 - layout:</span></span>
<span id="cb450-4"><a href="ggplot2.html#cb450-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 用来指定布局的一组矩阵。当其存在时，可以忽略 `cols`</span></span>
<span id="cb450-5"><a href="ggplot2.html#cb450-5" aria-hidden="true" tabindex="-1"></a><span class="co"># 参数。 假设 layout 参数是 matrix(c(1,2,3,3), nrow=2,</span></span>
<span id="cb450-6"><a href="ggplot2.html#cb450-6" aria-hidden="true" tabindex="-1"></a><span class="co"># byrow = TRUE),</span></span>
<span id="cb450-7"><a href="ggplot2.html#cb450-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 那么第一幅图像会位于左上方，第二幅图会在右上方，而</span></span>
<span id="cb450-8"><a href="ggplot2.html#cb450-8" aria-hidden="true" tabindex="-1"></a><span class="co"># 第三幅图会占据整个下方。</span></span>
<span id="cb450-9"><a href="ggplot2.html#cb450-9" aria-hidden="true" tabindex="-1"></a>multiplot <span class="ot">&lt;-</span> <span class="cf">function</span>(..., <span class="at">plotlist =</span> <span class="cn">NULL</span>, file, <span class="at">cols =</span> <span class="dv">1</span>,</span>
<span id="cb450-10"><a href="ggplot2.html#cb450-10" aria-hidden="true" tabindex="-1"></a>  <span class="at">layout =</span> <span class="cn">NULL</span>) {</span>
<span id="cb450-11"><a href="ggplot2.html#cb450-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">library</span>(grid)</span>
<span id="cb450-12"><a href="ggplot2.html#cb450-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb450-13"><a href="ggplot2.html#cb450-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 从参数 `…`中建立一个列表然后 plotlist</span></span>
<span id="cb450-14"><a href="ggplot2.html#cb450-14" aria-hidden="true" tabindex="-1"></a>  plots <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">list</span>(...), plotlist)</span>
<span id="cb450-15"><a href="ggplot2.html#cb450-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb450-16"><a href="ggplot2.html#cb450-16" aria-hidden="true" tabindex="-1"></a>  numPlots <span class="ot">=</span> <span class="fu">length</span>(plots)</span>
<span id="cb450-17"><a href="ggplot2.html#cb450-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># 假如 layout 是 NULL, 那么可以用 `cols` 来定义布局</span></span>
<span id="cb450-18"><a href="ggplot2.html#cb450-18" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (<span class="fu">is.null</span>(layout)) {</span>
<span id="cb450-19"><a href="ggplot2.html#cb450-19" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 创建面板 ncol: 图像的列数 nrow:</span></span>
<span id="cb450-20"><a href="ggplot2.html#cb450-20" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 根据上述给定的列数，计算所需要的行数</span></span>
<span id="cb450-21"><a href="ggplot2.html#cb450-21" aria-hidden="true" tabindex="-1"></a>    layout <span class="ot">&lt;-</span> <span class="fu">matrix</span>(<span class="fu">seq</span>(<span class="dv">1</span>, cols <span class="sc">*</span> <span class="fu">ceiling</span>(numPlots<span class="sc">/</span>cols)),</span>
<span id="cb450-22"><a href="ggplot2.html#cb450-22" aria-hidden="true" tabindex="-1"></a>      <span class="at">ncol =</span> cols, <span class="at">nrow =</span> <span class="fu">ceiling</span>(numPlots<span class="sc">/</span>cols))</span>
<span id="cb450-23"><a href="ggplot2.html#cb450-23" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb450-24"><a href="ggplot2.html#cb450-24" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span> (numPlots <span class="sc">==</span> <span class="dv">1</span>) {</span>
<span id="cb450-25"><a href="ggplot2.html#cb450-25" aria-hidden="true" tabindex="-1"></a>    <span class="fu">print</span>(plots[[<span class="dv">1</span>]])</span>
<span id="cb450-26"><a href="ggplot2.html#cb450-26" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb450-27"><a href="ggplot2.html#cb450-27" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 创建页面</span></span>
<span id="cb450-28"><a href="ggplot2.html#cb450-28" aria-hidden="true" tabindex="-1"></a>    <span class="fu">grid.newpage</span>()</span>
<span id="cb450-29"><a href="ggplot2.html#cb450-29" aria-hidden="true" tabindex="-1"></a>    <span class="fu">pushViewport</span>(<span class="fu">viewport</span>(<span class="at">layout =</span> <span class="fu">grid.layout</span>(<span class="fu">nrow</span>(layout),</span>
<span id="cb450-30"><a href="ggplot2.html#cb450-30" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ncol</span>(layout))))</span>
<span id="cb450-31"><a href="ggplot2.html#cb450-31" aria-hidden="true" tabindex="-1"></a>    <span class="co"># 让每一幅图像排列在正确的位置</span></span>
<span id="cb450-32"><a href="ggplot2.html#cb450-32" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span>numPlots) {</span>
<span id="cb450-33"><a href="ggplot2.html#cb450-33" aria-hidden="true" tabindex="-1"></a>      <span class="co"># 获取包含这一子图所在区域的坐标 matrix i,j</span></span>
<span id="cb450-34"><a href="ggplot2.html#cb450-34" aria-hidden="true" tabindex="-1"></a>      matchidx <span class="ot">&lt;-</span> <span class="fu">as.data.frame</span>(<span class="fu">which</span>(layout <span class="sc">==</span> i,</span>
<span id="cb450-35"><a href="ggplot2.html#cb450-35" aria-hidden="true" tabindex="-1"></a>        <span class="at">arr.ind =</span> <span class="cn">TRUE</span>))</span>
<span id="cb450-36"><a href="ggplot2.html#cb450-36" aria-hidden="true" tabindex="-1"></a>      <span class="fu">print</span>(plots[[i]], <span class="at">vp =</span> <span class="fu">viewport</span>(<span class="at">layout.pos.row =</span> matchidx<span class="sc">$</span>row,</span>
<span id="cb450-37"><a href="ggplot2.html#cb450-37" aria-hidden="true" tabindex="-1"></a>        <span class="at">layout.pos.col =</span> matchidx<span class="sc">$</span>col))</span>
<span id="cb450-38"><a href="ggplot2.html#cb450-38" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb450-39"><a href="ggplot2.html#cb450-39" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb450-40"><a href="ggplot2.html#cb450-40" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<p>如果它不能满足你的需求，你可以将其复制下来然后作出适当的修改。</p>
<p>首先，构建并保存图像但不需要对它们进行渲染，这些图像的细节并不重要。你只需要将这些图像对象储存为变量。</p>
<div class="sourceCode" id="cb451"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb451-1"><a href="ggplot2.html#cb451-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 以下例子使用的是 ggplot2 包中自带的 Chickweight</span></span>
<span id="cb451-2"><a href="ggplot2.html#cb451-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 数据集 第一幅图像</span></span>
<span id="cb451-3"><a href="ggplot2.html#cb451-3" aria-hidden="true" tabindex="-1"></a>p1 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(ChickWeight, <span class="fu">aes</span>(<span class="at">x =</span> Time, <span class="at">y =</span> weight, <span class="at">colour =</span> Diet,</span>
<span id="cb451-4"><a href="ggplot2.html#cb451-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">group =</span> Chick)) <span class="sc">+</span> <span class="fu">geom_line</span>() <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">&quot;Growth curve for individual chicks&quot;</span>)</span>
<span id="cb451-5"><a href="ggplot2.html#cb451-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb451-6"><a href="ggplot2.html#cb451-6" aria-hidden="true" tabindex="-1"></a><span class="co"># 第二幅图像</span></span>
<span id="cb451-7"><a href="ggplot2.html#cb451-7" aria-hidden="true" tabindex="-1"></a>p2 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(ChickWeight, <span class="fu">aes</span>(<span class="at">x =</span> Time, <span class="at">y =</span> weight, <span class="at">colour =</span> Diet)) <span class="sc">+</span></span>
<span id="cb451-8"><a href="ggplot2.html#cb451-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="at">alpha =</span> <span class="fl">0.3</span>) <span class="sc">+</span> <span class="fu">geom_smooth</span>(<span class="at">alpha =</span> <span class="fl">0.2</span>, <span class="at">size =</span> <span class="dv">1</span>) <span class="sc">+</span></span>
<span id="cb451-9"><a href="ggplot2.html#cb451-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Fitted growth curve per diet&quot;</span>)</span>
<span id="cb451-10"><a href="ggplot2.html#cb451-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb451-11"><a href="ggplot2.html#cb451-11" aria-hidden="true" tabindex="-1"></a><span class="co"># 第三幅图像</span></span>
<span id="cb451-12"><a href="ggplot2.html#cb451-12" aria-hidden="true" tabindex="-1"></a>p3 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">subset</span>(ChickWeight, Time <span class="sc">==</span> <span class="dv">21</span>), <span class="fu">aes</span>(<span class="at">x =</span> weight,</span>
<span id="cb451-13"><a href="ggplot2.html#cb451-13" aria-hidden="true" tabindex="-1"></a>  <span class="at">colour =</span> Diet)) <span class="sc">+</span> <span class="fu">geom_density</span>() <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">&quot;Final weight, by diet&quot;</span>)</span>
<span id="cb451-14"><a href="ggplot2.html#cb451-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb451-15"><a href="ggplot2.html#cb451-15" aria-hidden="true" tabindex="-1"></a><span class="co"># 第四幅图像</span></span>
<span id="cb451-16"><a href="ggplot2.html#cb451-16" aria-hidden="true" tabindex="-1"></a>p4 <span class="ot">&lt;-</span> <span class="fu">ggplot</span>(<span class="fu">subset</span>(ChickWeight, Time <span class="sc">==</span> <span class="dv">21</span>), <span class="fu">aes</span>(<span class="at">x =</span> weight,</span>
<span id="cb451-17"><a href="ggplot2.html#cb451-17" aria-hidden="true" tabindex="-1"></a>  <span class="at">fill =</span> Diet)) <span class="sc">+</span> <span class="fu">geom_histogram</span>(<span class="at">colour =</span> <span class="st">&quot;black&quot;</span>, <span class="at">binwidth =</span> <span class="dv">50</span>) <span class="sc">+</span></span>
<span id="cb451-18"><a href="ggplot2.html#cb451-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(Diet <span class="sc">~</span> .) <span class="sc">+</span> <span class="fu">ggtitle</span>(<span class="st">&quot;Final weight, by diet&quot;</span>) <span class="sc">+</span></span>
<span id="cb451-19"><a href="ggplot2.html#cb451-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;none&quot;</span>)  <span class="co">#为了避免冗余，这里不添加图例</span></span></code></pre></div>
<p>这些图像都构建好了后，我们可以用 <code>multiplot()</code> 对它们进行渲染。下面将这些图形分成两列进行展示：</p>
<div class="sourceCode" id="cb452"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb452-1"><a href="ggplot2.html#cb452-1" aria-hidden="true" tabindex="-1"></a><span class="fu">multiplot</span>(p1, p2, p3, p4, <span class="at">cols =</span> <span class="dv">2</span>)</span>
<span id="cb452-2"><a href="ggplot2.html#cb452-2" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; `geom_smooth()` using method = &#39;loess&#39; and formula &#39;y ~ x&#39;</span></span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-345-1.png" width="672" style="display: block; margin: auto;" /></p>
</div>
</div>
<div id="ggplot2-colors" class="section level2" number="9.11">
<h2><span class="header-section-number">9.11</span> 颜色</h2>
<div id="问题-63" class="section level3" number="9.11.1">
<h3><span class="header-section-number">9.11.1</span> 问题</h3>
<p>你想在图表中用 <strong>ggplot2</strong> 添加颜色。</p>
</div>
<div id="方案-62" class="section level3" number="9.11.2">
<h3><span class="header-section-number">9.11.2</span> 方案</h3>
<p>在 <strong>ggplot2</strong> 中设置颜色，对相互区分不同变量会有些困难，因为这些颜色有一样的亮度，且对色盲者不太友好。一个比较好的通用解决方案是使用对<a href="ggplot2.html#colorblind-friendly">色盲友好</a>的颜色。</p>
<div id="样本数据-2" class="section level4" number="9.11.2.1">
<h4><span class="header-section-number">9.11.2.1</span> 样本数据</h4>
<p>这两个数据集将用来产生下面的图表：</p>
<div class="sourceCode" id="cb453"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb453-1"><a href="ggplot2.html#cb453-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 两个变量</span></span>
<span id="cb453-2"><a href="ggplot2.html#cb453-2" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="at">header =</span> <span class="cn">TRUE</span>, <span class="at">text =</span> <span class="st">&quot;</span></span>
<span id="cb453-3"><a href="ggplot2.html#cb453-3" aria-hidden="true" tabindex="-1"></a><span class="st"> cond yval</span></span>
<span id="cb453-4"><a href="ggplot2.html#cb453-4" aria-hidden="true" tabindex="-1"></a><span class="st">    A 2</span></span>
<span id="cb453-5"><a href="ggplot2.html#cb453-5" aria-hidden="true" tabindex="-1"></a><span class="st">    B 2.5</span></span>
<span id="cb453-6"><a href="ggplot2.html#cb453-6" aria-hidden="true" tabindex="-1"></a><span class="st">    C 1.6</span></span>
<span id="cb453-7"><a href="ggplot2.html#cb453-7" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span>)</span>
<span id="cb453-8"><a href="ggplot2.html#cb453-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb453-9"><a href="ggplot2.html#cb453-9" aria-hidden="true" tabindex="-1"></a><span class="co"># 三个变量</span></span>
<span id="cb453-10"><a href="ggplot2.html#cb453-10" aria-hidden="true" tabindex="-1"></a>df2 <span class="ot">&lt;-</span> <span class="fu">read.table</span>(<span class="at">header =</span> <span class="cn">TRUE</span>, <span class="at">text =</span> <span class="st">&quot;</span></span>
<span id="cb453-11"><a href="ggplot2.html#cb453-11" aria-hidden="true" tabindex="-1"></a><span class="st"> cond1 cond2 yval</span></span>
<span id="cb453-12"><a href="ggplot2.html#cb453-12" aria-hidden="true" tabindex="-1"></a><span class="st">    A      I 2</span></span>
<span id="cb453-13"><a href="ggplot2.html#cb453-13" aria-hidden="true" tabindex="-1"></a><span class="st">    A      J 2.5</span></span>
<span id="cb453-14"><a href="ggplot2.html#cb453-14" aria-hidden="true" tabindex="-1"></a><span class="st">    A      K 1.6</span></span>
<span id="cb453-15"><a href="ggplot2.html#cb453-15" aria-hidden="true" tabindex="-1"></a><span class="st">    B      I 2.2</span></span>
<span id="cb453-16"><a href="ggplot2.html#cb453-16" aria-hidden="true" tabindex="-1"></a><span class="st">    B      J 2.4</span></span>
<span id="cb453-17"><a href="ggplot2.html#cb453-17" aria-hidden="true" tabindex="-1"></a><span class="st">    B      K 1.2</span></span>
<span id="cb453-18"><a href="ggplot2.html#cb453-18" aria-hidden="true" tabindex="-1"></a><span class="st">    C      I 1.7</span></span>
<span id="cb453-19"><a href="ggplot2.html#cb453-19" aria-hidden="true" tabindex="-1"></a><span class="st">    C      J 2.3</span></span>
<span id="cb453-20"><a href="ggplot2.html#cb453-20" aria-hidden="true" tabindex="-1"></a><span class="st">    C      K 1.9</span></span>
<span id="cb453-21"><a href="ggplot2.html#cb453-21" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;</span>)</span></code></pre></div>
</div>
<div id="简单的颜色设置" class="section level4" number="9.11.2.2">
<h4><span class="header-section-number">9.11.2.2</span> 简单的颜色设置</h4>
<p>有颜色的线条和点可以直接用 <code>colour = "red"</code>, 用颜色名称代替 <code>"red"</code>。填充的对象的颜色，如柱状条，可以用 <code>fill="red"</code> 来进行设置。</p>
<p>如果你想用任何其他非常规颜色，用十六进位码来设置颜色更容易，比如 <code>#FF6699</code>。</p>
<div class="sourceCode" id="cb454"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb454-1"><a href="ggplot2.html#cb454-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb454-2"><a href="ggplot2.html#cb454-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 设置：黑色柱状条</span></span>
<span id="cb454-3"><a href="ggplot2.html#cb454-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x=</span>cond, <span class="at">y=</span>yval)) <span class="sc">+</span> <span class="fu">geom_bar</span>(<span class="at">stat=</span><span class="st">&quot;identity&quot;</span>)</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-347-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb455"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb455-1"><a href="ggplot2.html#cb455-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 柱状条外用红色边线</span></span>
<span id="cb455-2"><a href="ggplot2.html#cb455-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x=</span>cond, <span class="at">y=</span>yval)) <span class="sc">+</span> <span class="fu">geom_bar</span>(<span class="at">stat=</span><span class="st">&quot;identity&quot;</span>, <span class="at">colour=</span><span class="st">&quot;#FF9999&quot;</span>) </span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-347-2.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb456"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb456-1"><a href="ggplot2.html#cb456-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 红色填充，黑色边线</span></span>
<span id="cb456-2"><a href="ggplot2.html#cb456-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x=</span>cond, <span class="at">y=</span>yval)) <span class="sc">+</span> <span class="fu">geom_bar</span>(<span class="at">stat=</span><span class="st">&quot;identity&quot;</span>, <span class="at">fill=</span><span class="st">&quot;#FF9999&quot;</span>, <span class="at">colour=</span><span class="st">&quot;black&quot;</span>)</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-347-3.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb457"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb457-1"><a href="ggplot2.html#cb457-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb457-2"><a href="ggplot2.html#cb457-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 标准黑色线条和点</span></span>
<span id="cb457-3"><a href="ggplot2.html#cb457-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x=</span>cond, <span class="at">y=</span>yval)) <span class="sc">+</span> </span>
<span id="cb457-4"><a href="ggplot2.html#cb457-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group=</span><span class="dv">1</span>)) <span class="sc">+</span>     </span>
<span id="cb457-5"><a href="ggplot2.html#cb457-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">size=</span><span class="dv">3</span>)</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-347-4.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb458"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb458-1"><a href="ggplot2.html#cb458-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 蓝黑色线条，红色点</span></span>
<span id="cb458-2"><a href="ggplot2.html#cb458-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x=</span>cond, <span class="at">y=</span>yval)) <span class="sc">+</span> </span>
<span id="cb458-3"><a href="ggplot2.html#cb458-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">group=</span><span class="dv">1</span>), <span class="at">colour=</span><span class="st">&quot;#000099&quot;</span>) <span class="sc">+</span>  <span class="co"># 蓝线</span></span>
<span id="cb458-4"><a href="ggplot2.html#cb458-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">size=</span><span class="dv">3</span>, <span class="at">colour=</span><span class="st">&quot;#CC0000&quot;</span>)         <span class="co"># 红点</span></span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-347-5.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="将变量值映射到颜色" class="section level4" number="9.11.2.3">
<h4><span class="header-section-number">9.11.2.3</span> 将变量值映射到颜色</h4>
<p>不用全局改变颜色，你可以将变量映射到颜色——换言之，通过把颜色放到 <code>aes()</code> 函数中，可以设置条件性变量。</p>
<div class="sourceCode" id="cb459"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb459-1"><a href="ggplot2.html#cb459-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 柱状条: x 和填充都依赖于cond2</span></span>
<span id="cb459-2"><a href="ggplot2.html#cb459-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x=</span>cond, <span class="at">y=</span>yval, <span class="at">fill=</span>cond)) <span class="sc">+</span> <span class="fu">geom_bar</span>(<span class="at">stat=</span><span class="st">&quot;identity&quot;</span>)</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-348-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb460"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb460-1"><a href="ggplot2.html#cb460-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb460-2"><a href="ggplot2.html#cb460-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 其他数据集的柱状条；填充依赖于cond2</span></span>
<span id="cb460-3"><a href="ggplot2.html#cb460-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df2, <span class="fu">aes</span>(<span class="at">x=</span>cond1, <span class="at">y=</span>yval)) <span class="sc">+</span> </span>
<span id="cb460-4"><a href="ggplot2.html#cb460-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_bar</span>(<span class="fu">aes</span>(<span class="at">fill=</span>cond2),   <span class="co"># 填充依赖于cond2</span></span>
<span id="cb460-5"><a href="ggplot2.html#cb460-5" aria-hidden="true" tabindex="-1"></a>             <span class="at">stat=</span><span class="st">&quot;identity&quot;</span>,</span>
<span id="cb460-6"><a href="ggplot2.html#cb460-6" aria-hidden="true" tabindex="-1"></a>             <span class="at">colour=</span><span class="st">&quot;black&quot;</span>,    <span class="co"># 所有都是黑色轮廓线</span></span>
<span id="cb460-7"><a href="ggplot2.html#cb460-7" aria-hidden="true" tabindex="-1"></a>             <span class="at">position=</span><span class="fu">position_dodge</span>()) <span class="co"># 把线条并排放置而非堆叠</span></span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-348-2.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb461"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb461-1"><a href="ggplot2.html#cb461-1" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb461-2"><a href="ggplot2.html#cb461-2" aria-hidden="true" tabindex="-1"></a><span class="co"># 线和点；颜色依赖于cond2</span></span>
<span id="cb461-3"><a href="ggplot2.html#cb461-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df2, <span class="fu">aes</span>(<span class="at">x=</span>cond1, <span class="at">y=</span>yval)) <span class="sc">+</span> </span>
<span id="cb461-4"><a href="ggplot2.html#cb461-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">colour=</span>cond2, <span class="at">group=</span>cond2)) <span class="sc">+</span> <span class="co"># 颜色分组都依赖于cond2</span></span>
<span id="cb461-5"><a href="ggplot2.html#cb461-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">colour=</span>cond2),               <span class="co"># 颜色依赖于cond2</span></span>
<span id="cb461-6"><a href="ggplot2.html#cb461-6" aria-hidden="true" tabindex="-1"></a>               <span class="at">size=</span><span class="dv">3</span>)                          <span class="co"># 更大的点，不同的形状</span></span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-348-3.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb462"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb462-1"><a href="ggplot2.html#cb462-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 以上操作等价; 但把 &quot;colour=cond2&quot; 移到全局的映射用aes() </span></span>
<span id="cb462-2"><a href="ggplot2.html#cb462-2" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot(df2, aes(x=cond1, y=yval, colour=cond2)) + </span></span>
<span id="cb462-3"><a href="ggplot2.html#cb462-3" aria-hidden="true" tabindex="-1"></a><span class="co">#    geom_line(aes(group=cond2)) +</span></span>
<span id="cb462-4"><a href="ggplot2.html#cb462-4" aria-hidden="true" tabindex="-1"></a><span class="co">#    geom_point(size=3)</span></span></code></pre></div>
</div>
<div id="colorblind-friendly" class="section level4" number="9.11.2.4">
<h4><span class="header-section-number">9.11.2.4</span> 对色盲友好的颜色</h4>
<p>下面这些是对色盲友好的颜色色板，一个用灰色，一个用黑色：</p>
<p><img src="http://www.cookbook-r.com/Graphs/Colors_(ggplot2)/figure/unnamed-chunk-5-1.png" /><img src="http://www.cookbook-r.com/Graphs/Colors_(ggplot2)/figure/unnamed-chunk-5-2.png" /></p>
<p>为了用 <strong>ggplot2</strong>, 我们在一个变量里储存颜色色板，然后之后调用。</p>
<div class="sourceCode" id="cb463"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb463-1"><a href="ggplot2.html#cb463-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 灰色的颜色色板:</span></span>
<span id="cb463-2"><a href="ggplot2.html#cb463-2" aria-hidden="true" tabindex="-1"></a>cbPalette <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;#999999&quot;</span>, <span class="st">&quot;#E69F00&quot;</span>, <span class="st">&quot;#56B4E9&quot;</span>, <span class="st">&quot;#009E73&quot;</span>,</span>
<span id="cb463-3"><a href="ggplot2.html#cb463-3" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;#F0E442&quot;</span>, <span class="st">&quot;#0072B2&quot;</span>, <span class="st">&quot;#D55E00&quot;</span>, <span class="st">&quot;#CC79A7&quot;</span>)</span>
<span id="cb463-4"><a href="ggplot2.html#cb463-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 黑色的颜色色板k:</span></span>
<span id="cb463-5"><a href="ggplot2.html#cb463-5" aria-hidden="true" tabindex="-1"></a>cbbPalette <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;#000000&quot;</span>, <span class="st">&quot;#E69F00&quot;</span>, <span class="st">&quot;#56B4E9&quot;</span>, <span class="st">&quot;#009E73&quot;</span>,</span>
<span id="cb463-6"><a href="ggplot2.html#cb463-6" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;#F0E442&quot;</span>, <span class="st">&quot;#0072B2&quot;</span>, <span class="st">&quot;#D55E00&quot;</span>, <span class="st">&quot;#CC79A7&quot;</span>)</span>
<span id="cb463-7"><a href="ggplot2.html#cb463-7" aria-hidden="true" tabindex="-1"></a><span class="co"># 为了填充颜色，加</span></span>
<span id="cb463-8"><a href="ggplot2.html#cb463-8" aria-hidden="true" tabindex="-1"></a><span class="fu">scale_fill_manual</span>(<span class="at">values =</span> cbPalette)</span>
<span id="cb463-9"><a href="ggplot2.html#cb463-9" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &lt;ggproto object: Class ScaleDiscrete, Scale, gg&gt;</span></span>
<span id="cb463-10"><a href="ggplot2.html#cb463-10" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     aesthetics: fill</span></span>
<span id="cb463-11"><a href="ggplot2.html#cb463-11" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     axis_order: function</span></span>
<span id="cb463-12"><a href="ggplot2.html#cb463-12" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     break_info: function</span></span>
<span id="cb463-13"><a href="ggplot2.html#cb463-13" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     break_positions: function</span></span>
<span id="cb463-14"><a href="ggplot2.html#cb463-14" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     breaks: waiver</span></span>
<span id="cb463-15"><a href="ggplot2.html#cb463-15" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     call: call</span></span>
<span id="cb463-16"><a href="ggplot2.html#cb463-16" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     clone: function</span></span>
<span id="cb463-17"><a href="ggplot2.html#cb463-17" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     dimension: function</span></span>
<span id="cb463-18"><a href="ggplot2.html#cb463-18" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     drop: TRUE</span></span>
<span id="cb463-19"><a href="ggplot2.html#cb463-19" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     expand: waiver</span></span>
<span id="cb463-20"><a href="ggplot2.html#cb463-20" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     get_breaks: function</span></span>
<span id="cb463-21"><a href="ggplot2.html#cb463-21" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     get_breaks_minor: function</span></span>
<span id="cb463-22"><a href="ggplot2.html#cb463-22" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     get_labels: function</span></span>
<span id="cb463-23"><a href="ggplot2.html#cb463-23" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     get_limits: function</span></span>
<span id="cb463-24"><a href="ggplot2.html#cb463-24" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     guide: legend</span></span>
<span id="cb463-25"><a href="ggplot2.html#cb463-25" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     is_discrete: function</span></span>
<span id="cb463-26"><a href="ggplot2.html#cb463-26" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     is_empty: function</span></span>
<span id="cb463-27"><a href="ggplot2.html#cb463-27" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     labels: waiver</span></span>
<span id="cb463-28"><a href="ggplot2.html#cb463-28" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     limits: NULL</span></span>
<span id="cb463-29"><a href="ggplot2.html#cb463-29" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     make_sec_title: function</span></span>
<span id="cb463-30"><a href="ggplot2.html#cb463-30" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     make_title: function</span></span>
<span id="cb463-31"><a href="ggplot2.html#cb463-31" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     map: function</span></span>
<span id="cb463-32"><a href="ggplot2.html#cb463-32" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     map_df: function</span></span>
<span id="cb463-33"><a href="ggplot2.html#cb463-33" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     n.breaks.cache: NULL</span></span>
<span id="cb463-34"><a href="ggplot2.html#cb463-34" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     na.translate: TRUE</span></span>
<span id="cb463-35"><a href="ggplot2.html#cb463-35" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     na.value: grey50</span></span>
<span id="cb463-36"><a href="ggplot2.html#cb463-36" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     name: waiver</span></span>
<span id="cb463-37"><a href="ggplot2.html#cb463-37" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     palette: function</span></span>
<span id="cb463-38"><a href="ggplot2.html#cb463-38" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     palette.cache: NULL</span></span>
<span id="cb463-39"><a href="ggplot2.html#cb463-39" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     position: left</span></span>
<span id="cb463-40"><a href="ggplot2.html#cb463-40" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     range: &lt;ggproto object: Class RangeDiscrete, Range, gg&gt;</span></span>
<span id="cb463-41"><a href="ggplot2.html#cb463-41" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         range: NULL</span></span>
<span id="cb463-42"><a href="ggplot2.html#cb463-42" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         reset: function</span></span>
<span id="cb463-43"><a href="ggplot2.html#cb463-43" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         train: function</span></span>
<span id="cb463-44"><a href="ggplot2.html#cb463-44" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         super:  &lt;ggproto object: Class RangeDiscrete, Range, gg&gt;</span></span>
<span id="cb463-45"><a href="ggplot2.html#cb463-45" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     rescale: function</span></span>
<span id="cb463-46"><a href="ggplot2.html#cb463-46" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     reset: function</span></span>
<span id="cb463-47"><a href="ggplot2.html#cb463-47" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     scale_name: manual</span></span>
<span id="cb463-48"><a href="ggplot2.html#cb463-48" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     train: function</span></span>
<span id="cb463-49"><a href="ggplot2.html#cb463-49" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     train_df: function</span></span>
<span id="cb463-50"><a href="ggplot2.html#cb463-50" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     transform: function</span></span>
<span id="cb463-51"><a href="ggplot2.html#cb463-51" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     transform_df: function</span></span>
<span id="cb463-52"><a href="ggplot2.html#cb463-52" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     super:  &lt;ggproto object: Class ScaleDiscrete, Scale, gg&gt;</span></span>
<span id="cb463-53"><a href="ggplot2.html#cb463-53" aria-hidden="true" tabindex="-1"></a><span class="co"># 为了在点线中使用颜色，加</span></span>
<span id="cb463-54"><a href="ggplot2.html#cb463-54" aria-hidden="true" tabindex="-1"></a><span class="fu">scale_colour_manual</span>(<span class="at">values =</span> cbPalette)</span>
<span id="cb463-55"><a href="ggplot2.html#cb463-55" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt; &lt;ggproto object: Class ScaleDiscrete, Scale, gg&gt;</span></span>
<span id="cb463-56"><a href="ggplot2.html#cb463-56" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     aesthetics: colour</span></span>
<span id="cb463-57"><a href="ggplot2.html#cb463-57" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     axis_order: function</span></span>
<span id="cb463-58"><a href="ggplot2.html#cb463-58" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     break_info: function</span></span>
<span id="cb463-59"><a href="ggplot2.html#cb463-59" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     break_positions: function</span></span>
<span id="cb463-60"><a href="ggplot2.html#cb463-60" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     breaks: waiver</span></span>
<span id="cb463-61"><a href="ggplot2.html#cb463-61" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     call: call</span></span>
<span id="cb463-62"><a href="ggplot2.html#cb463-62" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     clone: function</span></span>
<span id="cb463-63"><a href="ggplot2.html#cb463-63" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     dimension: function</span></span>
<span id="cb463-64"><a href="ggplot2.html#cb463-64" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     drop: TRUE</span></span>
<span id="cb463-65"><a href="ggplot2.html#cb463-65" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     expand: waiver</span></span>
<span id="cb463-66"><a href="ggplot2.html#cb463-66" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     get_breaks: function</span></span>
<span id="cb463-67"><a href="ggplot2.html#cb463-67" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     get_breaks_minor: function</span></span>
<span id="cb463-68"><a href="ggplot2.html#cb463-68" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     get_labels: function</span></span>
<span id="cb463-69"><a href="ggplot2.html#cb463-69" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     get_limits: function</span></span>
<span id="cb463-70"><a href="ggplot2.html#cb463-70" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     guide: legend</span></span>
<span id="cb463-71"><a href="ggplot2.html#cb463-71" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     is_discrete: function</span></span>
<span id="cb463-72"><a href="ggplot2.html#cb463-72" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     is_empty: function</span></span>
<span id="cb463-73"><a href="ggplot2.html#cb463-73" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     labels: waiver</span></span>
<span id="cb463-74"><a href="ggplot2.html#cb463-74" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     limits: NULL</span></span>
<span id="cb463-75"><a href="ggplot2.html#cb463-75" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     make_sec_title: function</span></span>
<span id="cb463-76"><a href="ggplot2.html#cb463-76" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     make_title: function</span></span>
<span id="cb463-77"><a href="ggplot2.html#cb463-77" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     map: function</span></span>
<span id="cb463-78"><a href="ggplot2.html#cb463-78" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     map_df: function</span></span>
<span id="cb463-79"><a href="ggplot2.html#cb463-79" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     n.breaks.cache: NULL</span></span>
<span id="cb463-80"><a href="ggplot2.html#cb463-80" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     na.translate: TRUE</span></span>
<span id="cb463-81"><a href="ggplot2.html#cb463-81" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     na.value: grey50</span></span>
<span id="cb463-82"><a href="ggplot2.html#cb463-82" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     name: waiver</span></span>
<span id="cb463-83"><a href="ggplot2.html#cb463-83" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     palette: function</span></span>
<span id="cb463-84"><a href="ggplot2.html#cb463-84" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     palette.cache: NULL</span></span>
<span id="cb463-85"><a href="ggplot2.html#cb463-85" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     position: left</span></span>
<span id="cb463-86"><a href="ggplot2.html#cb463-86" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     range: &lt;ggproto object: Class RangeDiscrete, Range, gg&gt;</span></span>
<span id="cb463-87"><a href="ggplot2.html#cb463-87" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         range: NULL</span></span>
<span id="cb463-88"><a href="ggplot2.html#cb463-88" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         reset: function</span></span>
<span id="cb463-89"><a href="ggplot2.html#cb463-89" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         train: function</span></span>
<span id="cb463-90"><a href="ggplot2.html#cb463-90" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;         super:  &lt;ggproto object: Class RangeDiscrete, Range, gg&gt;</span></span>
<span id="cb463-91"><a href="ggplot2.html#cb463-91" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     rescale: function</span></span>
<span id="cb463-92"><a href="ggplot2.html#cb463-92" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     reset: function</span></span>
<span id="cb463-93"><a href="ggplot2.html#cb463-93" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     scale_name: manual</span></span>
<span id="cb463-94"><a href="ggplot2.html#cb463-94" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     train: function</span></span>
<span id="cb463-95"><a href="ggplot2.html#cb463-95" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     train_df: function</span></span>
<span id="cb463-96"><a href="ggplot2.html#cb463-96" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     transform: function</span></span>
<span id="cb463-97"><a href="ggplot2.html#cb463-97" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     transform_df: function</span></span>
<span id="cb463-98"><a href="ggplot2.html#cb463-98" aria-hidden="true" tabindex="-1"></a><span class="co">#&gt;     super:  &lt;ggproto object: Class ScaleDiscrete, Scale, gg&gt;</span></span></code></pre></div>
<p>这个颜色集来源于网站： <a href="http://jfly.iam.u-tokyo.ac.jp/color/" class="uri">http://jfly.iam.u-tokyo.ac.jp/color/</a>。</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-350"></span>
<img src="https://kaopubear-1254299507.cos.ap-shanghai.myqcloud.com/picgo/202108181124226.png" alt="色盲友好调色板"  />
<p class="caption">
图 9.1: 色盲友好调色板
</p>
</div>
</div>
<div id="颜色选择" class="section level4" number="9.11.2.5">
<h4><span class="header-section-number">9.11.2.5</span> 颜色选择</h4>
<p>默认情况下，离散比例的颜色围绕 HSL 色环均匀分布。例如，如果有两种颜色，那么它们将从圆圈上的相对点中选择; 如果有三种颜色，它们在色环上将相隔 120° 等等。用于不同级别的颜色如下所示：</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-351"></span>
<img src="https://kaopubear-1254299507.cos.ap-shanghai.myqcloud.com/picgo/202108181126387.png" alt="均匀色环"  />
<p class="caption">
图 9.2: 均匀色环
</p>
</div>
<p>默认颜色选择使用 <code>scale_fill_hue()</code> 和 <code>scale_colour_hue()</code>。 例如，在以下情况下添加这些命令是多余的：</p>
<div class="sourceCode" id="cb464"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb464-1"><a href="ggplot2.html#cb464-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 这两个是等价的; 默认使用scale_fill_hue()</span></span>
<span id="cb464-2"><a href="ggplot2.html#cb464-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> cond, <span class="at">y =</span> yval, <span class="at">fill =</span> cond)) <span class="sc">+</span> <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>)</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-352-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb465"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb465-1"><a href="ggplot2.html#cb465-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot(df, aes(x=cond, y=yval, fill=cond)) +</span></span>
<span id="cb465-2"><a href="ggplot2.html#cb465-2" aria-hidden="true" tabindex="-1"></a><span class="co"># geom_bar(stat=&#39;identity&#39;) + scale_fill_hue()</span></span>
<span id="cb465-3"><a href="ggplot2.html#cb465-3" aria-hidden="true" tabindex="-1"></a><span class="co"># 这两个是等价的; 默认使用scale_colour_hue()</span></span>
<span id="cb465-4"><a href="ggplot2.html#cb465-4" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> cond, <span class="at">y =</span> yval, <span class="at">colour =</span> cond)) <span class="sc">+</span> <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>)</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-352-2.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb466"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb466-1"><a href="ggplot2.html#cb466-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ggplot(df, aes(x=cond, y=yval, colour=cond)) +</span></span>
<span id="cb466-2"><a href="ggplot2.html#cb466-2" aria-hidden="true" tabindex="-1"></a><span class="co"># geom_point(size=2) + scale_colour_hue()</span></span></code></pre></div>
</div>
<div id="设置亮度和饱和度色度" class="section level4" number="9.11.2.6">
<h4><span class="header-section-number">9.11.2.6</span> 设置亮度和饱和度（色度）</h4>
<p>虽然 <code>scale_fill_hue()</code> 和 <code>scale_colour_hue()</code> 在上面是多余的，但是当你想要改变默认值时，可以使用它们，比如改变亮度或色度。</p>
<div class="sourceCode" id="cb467"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb467-1"><a href="ggplot2.html#cb467-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 使用 luminance = 45, 而不是默认 65</span></span>
<span id="cb467-2"><a href="ggplot2.html#cb467-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> cond, <span class="at">y =</span> yval, <span class="at">fill =</span> cond)) <span class="sc">+</span> <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="sc">+</span></span>
<span id="cb467-3"><a href="ggplot2.html#cb467-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_hue</span>(<span class="at">l =</span> <span class="dv">40</span>)</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-353-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb468"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb468-1"><a href="ggplot2.html#cb468-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 从 100 到 50 减少饱和度（亮度）, 增加亮度</span></span>
<span id="cb468-2"><a href="ggplot2.html#cb468-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> cond, <span class="at">y =</span> yval, <span class="at">fill =</span> cond)) <span class="sc">+</span> <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="sc">+</span></span>
<span id="cb468-3"><a href="ggplot2.html#cb468-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_hue</span>(<span class="at">c =</span> <span class="dv">45</span>, <span class="at">l =</span> <span class="dv">80</span>)</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-353-2.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb469"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb469-1"><a href="ggplot2.html#cb469-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 注意：使用 scale_colour_hue() 设置线和点</span></span></code></pre></div>
<p>亮度为 45 时的颜色图表:</p>
<p><img src="http://www.cookbook-r.com/Graphs/Colors_(ggplot2)/figure/unnamed-chunk-10-1.png" style="display: block; margin: auto;" /></p>
</div>
<div id="调色板color-brewer" class="section level4" number="9.11.2.7">
<h4><span class="header-section-number">9.11.2.7</span> 调色板：Color Brewer</h4>
<p>你还可以使用其他颜色标度，例如从 <strong>RColorBrewer</strong> 包中获取。 请参阅下面的 <strong>RColorBrewer</strong>s 调色板图表。</p>
<div class="sourceCode" id="cb470"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb470-1"><a href="ggplot2.html#cb470-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> cond, <span class="at">y =</span> yval, <span class="at">fill =</span> cond)) <span class="sc">+</span> <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="sc">+</span></span>
<span id="cb470-2"><a href="ggplot2.html#cb470-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>()</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-355-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb471"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb471-1"><a href="ggplot2.html#cb471-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> cond, <span class="at">y =</span> yval, <span class="at">fill =</span> cond)) <span class="sc">+</span> <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="sc">+</span></span>
<span id="cb471-2"><a href="ggplot2.html#cb471-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">&quot;Set1&quot;</span>)</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-355-2.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb472"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb472-1"><a href="ggplot2.html#cb472-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> cond, <span class="at">y =</span> yval, <span class="at">fill =</span> cond)) <span class="sc">+</span> <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="sc">+</span></span>
<span id="cb472-2"><a href="ggplot2.html#cb472-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_brewer</span>(<span class="at">palette =</span> <span class="st">&quot;Spectral&quot;</span>)</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-355-3.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb473"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb473-1"><a href="ggplot2.html#cb473-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 注意: 使用 scale_colour_brewer() 设置点和线条</span></span></code></pre></div>
</div>
<div id="调色板手动定义" class="section level4" number="9.11.2.8">
<h4><span class="header-section-number">9.11.2.8</span> 调色板：手动定义</h4>
<p>最后，你可以使用 <code>scale_fill_manual()</code> 定义自己的颜色集。 有关选择特定颜色的帮助，请参阅下面的十六进制代码表。</p>
<div class="sourceCode" id="cb474"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb474-1"><a href="ggplot2.html#cb474-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> cond, <span class="at">y =</span> yval, <span class="at">fill =</span> cond)) <span class="sc">+</span> <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="sc">+</span></span>
<span id="cb474-2"><a href="ggplot2.html#cb474-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;red&quot;</span>, <span class="st">&quot;blue&quot;</span>, <span class="st">&quot;green&quot;</span>))</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-356-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb475"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb475-1"><a href="ggplot2.html#cb475-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> cond, <span class="at">y =</span> yval, <span class="at">fill =</span> cond)) <span class="sc">+</span> <span class="fu">geom_bar</span>(<span class="at">stat =</span> <span class="st">&quot;identity&quot;</span>) <span class="sc">+</span></span>
<span id="cb475-2"><a href="ggplot2.html#cb475-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_fill_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;#CC6666&quot;</span>, <span class="st">&quot;#9999CC&quot;</span>, <span class="st">&quot;#66CC99&quot;</span>))</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-356-2.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb476"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb476-1"><a href="ggplot2.html#cb476-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 注意：使用 scale_colour_manual() 设置线条和点</span></span></code></pre></div>
</div>
<div id="连续颜色" class="section level4" number="9.11.2.9">
<h4><span class="header-section-number">9.11.2.9</span> 连续颜色</h4>
<div class="sourceCode" id="cb477"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb477-1"><a href="ggplot2.html#cb477-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 产生一些数据</span></span>
<span id="cb477-2"><a href="ggplot2.html#cb477-2" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">133</span>)</span>
<span id="cb477-3"><a href="ggplot2.html#cb477-3" aria-hidden="true" tabindex="-1"></a>df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">xval =</span> <span class="fu">rnorm</span>(<span class="dv">50</span>), <span class="at">yval =</span> <span class="fu">rnorm</span>(<span class="dv">50</span>))</span>
<span id="cb477-4"><a href="ggplot2.html#cb477-4" aria-hidden="true" tabindex="-1"></a><span class="co"># 依赖 yval设置颜色</span></span>
<span id="cb477-5"><a href="ggplot2.html#cb477-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> xval, <span class="at">y =</span> yval, <span class="at">colour =</span> yval)) <span class="sc">+</span> <span class="fu">geom_point</span>()</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-357-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="sourceCode" id="cb478"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb478-1"><a href="ggplot2.html#cb478-1" aria-hidden="true" tabindex="-1"></a><span class="co"># 使用不同的渐变</span></span>
<span id="cb478-2"><a href="ggplot2.html#cb478-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(df, <span class="fu">aes</span>(<span class="at">x =</span> xval, <span class="at">y =</span> yval, <span class="at">colour =</span> yval)) <span class="sc">+</span> <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb478-3"><a href="ggplot2.html#cb478-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_colour_gradientn</span>(<span class="at">colours =</span> <span class="fu">rainbow</span>(<span class="dv">4</span>))</span></code></pre></div>
<p><img src="bookdown_files/figure-html/unnamed-chunk-357-2.png" width="672" style="display: block; margin: auto;" /></p>
</div>
<div id="比色图表" class="section level4" number="9.11.2.10">
<h4><span class="header-section-number">9.11.2.10</span> 比色图表</h4>
</div>
<div id="十六进制色码图" class="section level4" number="9.11.2.11">
<h4><span class="header-section-number">9.11.2.11</span> 十六进制色码图</h4>
<p>颜色可以指定为十六进制 RGB 三元组合，例如 <code>#0066CC</code>。 前两位数字是红色，接下来的两位是绿色，最后两位是蓝色。 每个值的范围从 00 到 FF，以十六进制（base-16）表示，在 base-10 中等于 0 和 255。 例如，在下表中，<code>#FFFFFF</code> 为白色，<code>#990000</code> 为深红色。</p>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-358"></span>
<img src="https://kaopubear-1254299507.cos.ap-shanghai.myqcloud.com/picgo/202108181126059.png" alt="色码图"  />
<p class="caption">
图 9.3: 色码图
</p>
</div>
<blockquote>
<p>色码图来源于 <a href="http://www.visibone.com/">http://www.visibone.com</a></p>
</blockquote>
</div>
<div id="rcolorbrewer-调色板图表" class="section level4" number="9.11.2.12">
<h4><span class="header-section-number">9.11.2.12</span> RColorBrewer 调色板图表</h4>
<div class="figure" style="text-align: center"><span style="display:block;" id="fig:unnamed-chunk-359"></span>
<img src="https://kaopubear-1254299507.cos.ap-shanghai.myqcloud.com/picgo/202108181127063.png" alt="调色板图表"  />
<p class="caption">
图 9.4: 调色板图表
</p>
</div>

</div>
</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="标准绘图.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="图形混杂.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook/js/app.min.js"></script>
<script src="libs/gitbook/js/lunr.js"></script>
<script src="libs/gitbook/js/clipboard.min.js"></script>
<script src="libs/gitbook/js/plugin-search.js"></script>
<script src="libs/gitbook/js/plugin-sharing.js"></script>
<script src="libs/gitbook/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook/js/plugin-bookdown.js"></script>
<script src="libs/gitbook/js/jquery.highlight.js"></script>
<script src="libs/gitbook/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/openbiox/Cookbook-for-R-Chinese/edit/master/book/09-graphs-ggplot2.Rmd",
"text": "编辑"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "lunr",
"options": null
},
"toc": {
"collapse": "section"
}
});
});
</script>

</body>

</html>
